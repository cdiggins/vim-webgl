{"version":3,"file":"vim-webgl-viewer.iife.js","sources":["../node_modules/deepmerge/dist/cjs.js","../src/vim-webgl-viewer/viewerSettings.ts","../src/vim-webgl-viewer/camera.ts","../src/vim-webgl-viewer/keyboard.ts","../src/vim-webgl-viewer/touch.ts","../src/vim-webgl-viewer/mouse.ts","../src/vim-webgl-viewer/input.ts","../src/vim-webgl-viewer/selection.ts","../src/vim-webgl-viewer/environment.ts","../src/vim-webgl-viewer/renderer.ts","../src/vim-webgl-viewer/raycaster.ts","../src/vim-webgl-viewer/gizmos.ts","../src/vim-loader/geometry.ts","../src/vim-loader/materials.ts","../src/vim-loader/mesh.ts","../src/vim-loader/scene.ts","../src/vim-webgl-viewer/renderScene.ts","../src/vim-webgl-viewer/viewport.ts","../node_modules/lodash-es/_freeGlobal.js","../node_modules/lodash-es/_root.js","../node_modules/lodash-es/_Symbol.js","../node_modules/lodash-es/_getRawTag.js","../node_modules/lodash-es/_objectToString.js","../node_modules/lodash-es/_baseGetTag.js","../node_modules/lodash-es/isObjectLike.js","../node_modules/lodash-es/isArray.js","../node_modules/lodash-es/isObject.js","../node_modules/lodash-es/isFunction.js","../node_modules/lodash-es/_coreJsData.js","../node_modules/lodash-es/_isMasked.js","../node_modules/lodash-es/_toSource.js","../node_modules/lodash-es/_baseIsNative.js","../node_modules/lodash-es/_getValue.js","../node_modules/lodash-es/_getNative.js","../node_modules/lodash-es/_WeakMap.js","../node_modules/lodash-es/_baseCreate.js","../node_modules/lodash-es/_copyArray.js","../node_modules/lodash-es/_defineProperty.js","../node_modules/lodash-es/_arrayEach.js","../node_modules/lodash-es/_isIndex.js","../node_modules/lodash-es/_baseAssignValue.js","../node_modules/lodash-es/eq.js","../node_modules/lodash-es/_assignValue.js","../node_modules/lodash-es/_copyObject.js","../node_modules/lodash-es/isLength.js","../node_modules/lodash-es/isArrayLike.js","../node_modules/lodash-es/_isPrototype.js","../node_modules/lodash-es/_baseTimes.js","../node_modules/lodash-es/_baseIsArguments.js","../node_modules/lodash-es/isArguments.js","../node_modules/lodash-es/stubFalse.js","../node_modules/lodash-es/isBuffer.js","../node_modules/lodash-es/_baseIsTypedArray.js","../node_modules/lodash-es/_baseUnary.js","../node_modules/lodash-es/_nodeUtil.js","../node_modules/lodash-es/isTypedArray.js","../node_modules/lodash-es/_arrayLikeKeys.js","../node_modules/lodash-es/_overArg.js","../node_modules/lodash-es/_nativeKeys.js","../node_modules/lodash-es/_baseKeys.js","../node_modules/lodash-es/keys.js","../node_modules/lodash-es/_nativeKeysIn.js","../node_modules/lodash-es/_baseKeysIn.js","../node_modules/lodash-es/keysIn.js","../node_modules/lodash-es/_nativeCreate.js","../node_modules/lodash-es/_hashClear.js","../node_modules/lodash-es/_hashDelete.js","../node_modules/lodash-es/_hashGet.js","../node_modules/lodash-es/_hashHas.js","../node_modules/lodash-es/_hashSet.js","../node_modules/lodash-es/_Hash.js","../node_modules/lodash-es/_listCacheClear.js","../node_modules/lodash-es/_assocIndexOf.js","../node_modules/lodash-es/_listCacheDelete.js","../node_modules/lodash-es/_listCacheGet.js","../node_modules/lodash-es/_listCacheHas.js","../node_modules/lodash-es/_listCacheSet.js","../node_modules/lodash-es/_ListCache.js","../node_modules/lodash-es/_Map.js","../node_modules/lodash-es/_mapCacheClear.js","../node_modules/lodash-es/_isKeyable.js","../node_modules/lodash-es/_getMapData.js","../node_modules/lodash-es/_mapCacheDelete.js","../node_modules/lodash-es/_mapCacheGet.js","../node_modules/lodash-es/_mapCacheHas.js","../node_modules/lodash-es/_mapCacheSet.js","../node_modules/lodash-es/_MapCache.js","../node_modules/lodash-es/_arrayPush.js","../node_modules/lodash-es/_getPrototype.js","../node_modules/lodash-es/_stackClear.js","../node_modules/lodash-es/_stackDelete.js","../node_modules/lodash-es/_stackGet.js","../node_modules/lodash-es/_stackHas.js","../node_modules/lodash-es/_stackSet.js","../node_modules/lodash-es/_Stack.js","../node_modules/lodash-es/_baseAssign.js","../node_modules/lodash-es/_baseAssignIn.js","../node_modules/lodash-es/_cloneBuffer.js","../node_modules/lodash-es/_arrayFilter.js","../node_modules/lodash-es/stubArray.js","../node_modules/lodash-es/_getSymbols.js","../node_modules/lodash-es/_copySymbols.js","../node_modules/lodash-es/_getSymbolsIn.js","../node_modules/lodash-es/_copySymbolsIn.js","../node_modules/lodash-es/_baseGetAllKeys.js","../node_modules/lodash-es/_getAllKeys.js","../node_modules/lodash-es/_getAllKeysIn.js","../node_modules/lodash-es/_DataView.js","../node_modules/lodash-es/_Promise.js","../node_modules/lodash-es/_Set.js","../node_modules/lodash-es/_getTag.js","../node_modules/lodash-es/_initCloneArray.js","../node_modules/lodash-es/_Uint8Array.js","../node_modules/lodash-es/_cloneArrayBuffer.js","../node_modules/lodash-es/_cloneDataView.js","../node_modules/lodash-es/_cloneRegExp.js","../node_modules/lodash-es/_cloneSymbol.js","../node_modules/lodash-es/_cloneTypedArray.js","../node_modules/lodash-es/_initCloneByTag.js","../node_modules/lodash-es/_initCloneObject.js","../node_modules/lodash-es/_baseIsMap.js","../node_modules/lodash-es/isMap.js","../node_modules/lodash-es/_baseIsSet.js","../node_modules/lodash-es/isSet.js","../node_modules/lodash-es/_baseClone.js","../node_modules/lodash-es/cloneDeep.js","../src/vim-loader/vimSettings.ts","../src/vim-loader/g3d.ts","../src/vim-loader/document.ts","../src/vim-loader/object.ts","../src/vim-loader/vim.ts","../src/vim-loader/loader.ts","../src/vim-loader/bfast.ts","../src/vim-webgl-viewer/viewer.ts"],"sourcesContent":["'use strict';\n\nvar isMergeableObject = function isMergeableObject(value) {\n\treturn isNonNullObject(value)\n\t\t&& !isSpecial(value)\n};\n\nfunction isNonNullObject(value) {\n\treturn !!value && typeof value === 'object'\n}\n\nfunction isSpecial(value) {\n\tvar stringValue = Object.prototype.toString.call(value);\n\n\treturn stringValue === '[object RegExp]'\n\t\t|| stringValue === '[object Date]'\n\t\t|| isReactElement(value)\n}\n\n// see https://github.com/facebook/react/blob/b5ac963fb791d1298e7f396236383bc955f916c1/src/isomorphic/classic/element/ReactElement.js#L21-L25\nvar canUseSymbol = typeof Symbol === 'function' && Symbol.for;\nvar REACT_ELEMENT_TYPE = canUseSymbol ? Symbol.for('react.element') : 0xeac7;\n\nfunction isReactElement(value) {\n\treturn value.$$typeof === REACT_ELEMENT_TYPE\n}\n\nfunction emptyTarget(val) {\n\treturn Array.isArray(val) ? [] : {}\n}\n\nfunction cloneUnlessOtherwiseSpecified(value, options) {\n\treturn (options.clone !== false && options.isMergeableObject(value))\n\t\t? deepmerge(emptyTarget(value), value, options)\n\t\t: value\n}\n\nfunction defaultArrayMerge(target, source, options) {\n\treturn target.concat(source).map(function(element) {\n\t\treturn cloneUnlessOtherwiseSpecified(element, options)\n\t})\n}\n\nfunction getMergeFunction(key, options) {\n\tif (!options.customMerge) {\n\t\treturn deepmerge\n\t}\n\tvar customMerge = options.customMerge(key);\n\treturn typeof customMerge === 'function' ? customMerge : deepmerge\n}\n\nfunction getEnumerableOwnPropertySymbols(target) {\n\treturn Object.getOwnPropertySymbols\n\t\t? Object.getOwnPropertySymbols(target).filter(function(symbol) {\n\t\t\treturn target.propertyIsEnumerable(symbol)\n\t\t})\n\t\t: []\n}\n\nfunction getKeys(target) {\n\treturn Object.keys(target).concat(getEnumerableOwnPropertySymbols(target))\n}\n\nfunction propertyIsOnObject(object, property) {\n\ttry {\n\t\treturn property in object\n\t} catch(_) {\n\t\treturn false\n\t}\n}\n\n// Protects from prototype poisoning and unexpected merging up the prototype chain.\nfunction propertyIsUnsafe(target, key) {\n\treturn propertyIsOnObject(target, key) // Properties are safe to merge if they don't exist in the target yet,\n\t\t&& !(Object.hasOwnProperty.call(target, key) // unsafe if they exist up the prototype chain,\n\t\t\t&& Object.propertyIsEnumerable.call(target, key)) // and also unsafe if they're nonenumerable.\n}\n\nfunction mergeObject(target, source, options) {\n\tvar destination = {};\n\tif (options.isMergeableObject(target)) {\n\t\tgetKeys(target).forEach(function(key) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(target[key], options);\n\t\t});\n\t}\n\tgetKeys(source).forEach(function(key) {\n\t\tif (propertyIsUnsafe(target, key)) {\n\t\t\treturn\n\t\t}\n\n\t\tif (propertyIsOnObject(target, key) && options.isMergeableObject(source[key])) {\n\t\t\tdestination[key] = getMergeFunction(key, options)(target[key], source[key], options);\n\t\t} else {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(source[key], options);\n\t\t}\n\t});\n\treturn destination\n}\n\nfunction deepmerge(target, source, options) {\n\toptions = options || {};\n\toptions.arrayMerge = options.arrayMerge || defaultArrayMerge;\n\toptions.isMergeableObject = options.isMergeableObject || isMergeableObject;\n\t// cloneUnlessOtherwiseSpecified is added to `options` so that custom arrayMerge()\n\t// implementations can use it. The caller may not replace it.\n\toptions.cloneUnlessOtherwiseSpecified = cloneUnlessOtherwiseSpecified;\n\n\tvar sourceIsArray = Array.isArray(source);\n\tvar targetIsArray = Array.isArray(target);\n\tvar sourceAndTargetTypesMatch = sourceIsArray === targetIsArray;\n\n\tif (!sourceAndTargetTypesMatch) {\n\t\treturn cloneUnlessOtherwiseSpecified(source, options)\n\t} else if (sourceIsArray) {\n\t\treturn options.arrayMerge(target, source, options)\n\t} else {\n\t\treturn mergeObject(target, source, options)\n\t}\n}\n\ndeepmerge.all = function deepmergeAll(array, options) {\n\tif (!Array.isArray(array)) {\n\t\tthrow new Error('first argument should be an array')\n\t}\n\n\treturn array.reduce(function(prev, next) {\n\t\treturn deepmerge(prev, next, options)\n\t}, {})\n};\n\nvar deepmerge_1 = deepmerge;\n\nmodule.exports = deepmerge_1;\n","/**\r\n @module viw-webgl-viewer\r\n*/\r\n\r\nimport * as THREE from 'three'\r\nimport deepmerge from 'deepmerge'\r\nimport { VimOptions } from '../vim-loader/vimSettings'\r\n\r\nexport namespace ViewerOptions {\r\n  export type ColorRGB = {\r\n    r: number\r\n    g: number\r\n    b: number\r\n  }\r\n\r\n  export type ColorHSL = {\r\n    h: number\r\n    s: number\r\n    l: number\r\n  }\r\n\r\n  /**\r\n   * Plane under Scene related options\r\n   */\r\n  export type GroundPlane = {\r\n    /** Enables/Disables plane under scene */\r\n    show: boolean\r\n    /** Local or remote texture url for plane */\r\n    texture: string\r\n    /** Opacity of the plane */\r\n    opacity: number\r\n    /** Color of the plane */\r\n    color: ColorRGB\r\n    /** Actual size is SceneRadius*size */\r\n    size: number\r\n  }\r\n\r\n  /** Dom canvas related options */\r\n  export type Canvas = {\r\n    /** Canvas dom model id. If none provided a new canvas will be created */\r\n    id: string\r\n    /** Limits how often canvas will be resized if window is resized. */\r\n    resizeDelay: number\r\n  }\r\n\r\n  /** Camera controls related options */\r\n  export type CameraControls = {\r\n    /**\r\n     * <p>Set true to start in orbit mode.</p>\r\n     * <p>Camera has two modes: First person and orbit</p>\r\n     * <p>First person allows to moves the camera around freely</p>\r\n     * <p>Orbit rotates the camera around a focus point</p>\r\n     */\r\n    orbit: boolean\r\n    /** Camera speed is scaled according to SceneRadius/sceneReferenceSize */\r\n    vimReferenceSize: number\r\n    /** Camera rotation speed factor */\r\n    rotateSpeed: number\r\n    orbitSpeed: number\r\n    /** Camera movement speed factor */\r\n    moveSpeed: number\r\n  }\r\n\r\n  /** Camera Gizmo related options */\r\n  export type CameraGizmo = {\r\n    enable: boolean\r\n    size: number\r\n    color: ColorRGB\r\n    opacity: number\r\n    opacityAlways: number\r\n  }\r\n\r\n  /** Camera related options */\r\n  export type Camera = {\r\n    /** Near clipping plane distance */\r\n    near: number\r\n    /** Far clipping plane distance */\r\n    far: number\r\n    /** Fov angle in degrees */\r\n    fov: number\r\n    /** Zoom level */\r\n    zoom: number\r\n    /** See ControlOptions */\r\n    controls: Partial<CameraControls>\r\n    /** See CameraGizmo */\r\n    gizmo: Partial<CameraGizmo>\r\n  }\r\n\r\n  export type SunLight = {\r\n    position: VimOptions.Vector3\r\n    color: ColorHSL\r\n    intensity: number\r\n  }\r\n\r\n  export type SkyLight = {\r\n    skyColor: ColorHSL\r\n    groundColor: ColorHSL\r\n    intensity: number\r\n  }\r\n\r\n  export type Highlight = {\r\n    color: ColorRGB\r\n    opacity: number\r\n  }\r\n\r\n  /** Viewer related options independant from vims */\r\n  export type Root = {\r\n    /**\r\n     * Webgl canvas related options\r\n     */\r\n    canvas: Partial<Canvas>\r\n    /**\r\n     * Three.js camera related options\r\n     */\r\n    camera: Partial<Camera>\r\n    // background: Partial<BackgroundOptions>\r\n    /**\r\n     * Plane under scene related options\r\n     */\r\n    groundPlane: Partial<GroundPlane>\r\n    /**\r\n     * Skylight (hemisphere light) options\r\n     */\r\n    skylight: Partial<SkyLight>\r\n    /**\r\n     * Sunlight (directional light) options\r\n     */\r\n    sunLight: Partial<SunLight>\r\n\r\n    /**\r\n     * Object highlight on click options\r\n     */\r\n    highlight: Partial<Highlight>\r\n  }\r\n}\r\n\r\n/**\r\n * <p>Wrapper around Viewer Options</p>\r\n * <p>Casts options values into related THREE.js type</p>\r\n * <p>Provides default values for options</p>\r\n */\r\nexport class ViewerSettings {\r\n  public options: ViewerOptions.Root\r\n\r\n  constructor (options?: Partial<ViewerOptions.Root>) {\r\n    const fallback: ViewerOptions.Root = {\r\n      canvas: {\r\n        id: undefined,\r\n        resizeDelay: 200\r\n      },\r\n      camera: {\r\n        near: 0.01,\r\n        far: 15000,\r\n        fov: 50,\r\n        zoom: 1,\r\n        controls: {\r\n          orbit: true,\r\n          vimReferenceSize: 1,\r\n          rotateSpeed: 1,\r\n          orbitSpeed: 1,\r\n          moveSpeed: 1\r\n        },\r\n        gizmo: {\r\n          enable: true,\r\n          size: 0.005,\r\n          color: { r: 0xff, g: 0xff, b: 0xff },\r\n          opacity: 0.5,\r\n          opacityAlways: 0.125\r\n        }\r\n      },\r\n      groundPlane: {\r\n        show: false,\r\n        texture: undefined,\r\n        opacity: 1,\r\n        color: { r: 0xff, g: 0xff, b: 0xff },\r\n        size: 3\r\n      },\r\n      skylight: {\r\n        // skyColor: { h: 1, s: 1, l: 1 },\r\n        skyColor: { h: 0.6, s: 1, l: 0.6 },\r\n        groundColor: { h: 0.095, s: 1, l: 0.75 },\r\n        // groundColor: { h: 1, s: 1, l: 1 },\r\n        intensity: 0.6\r\n        // intensity: 1\r\n      },\r\n      sunLight: {\r\n        position: { x: -47.0, y: 22, z: -45 },\r\n        // position: { x: 0, y: 0, z: -1000 },\r\n        color: { h: 0.1, s: 1, l: 0.95 },\r\n        // color: { h: 1, s: 1, l: 1 },\r\n        intensity: 1\r\n      },\r\n      highlight: {\r\n        color: { r: 0x6a, g: 0xd2, b: 0xff },\r\n        opacity: 0.5\r\n      }\r\n    }\r\n\r\n    this.options = options ? deepmerge(fallback, options, undefined) : fallback\r\n  }\r\n\r\n  // Canvas\r\n  getCanvasResizeDelay = () => this.options.canvas.resizeDelay\r\n  getCanvasId = () => this.options.canvas.id\r\n\r\n  // Plane\r\n  getGroundPlaneShow = () => this.options.groundPlane.show\r\n  getGroundPlaneColor = () => toRGBColor(this.options.groundPlane.color!)\r\n  getGroundPlaneTextureUrl = () => this.options.groundPlane.texture\r\n  getGroundPlaneOpacity = () => this.options.groundPlane.opacity\r\n  getGroundPlaneSize = () => this.options.groundPlane.size\r\n\r\n  // Skylight\r\n  getSkylightColor = () => toHSLColor(this.options.skylight.skyColor!)\r\n  getSkylightGroundColor = () => toHSLColor(this.options.skylight.groundColor!)\r\n\r\n  getSkylightIntensity = () => this.options.skylight.intensity\r\n\r\n  // Sunlight\r\n  getSunlightColor = () => toHSLColor(this.options.sunLight.color!)\r\n  getSunlightPosition = () => toVec(this.options.sunLight.position!)\r\n  getSunlightIntensity = () => this.options.sunLight.intensity\r\n\r\n  getHighlightColor = () => toRGBColor(this.options.highlight.color)\r\n  getHighlightOpacity = () => this.options.highlight.opacity\r\n\r\n  // Camera\r\n  private get camera () {\r\n    return this.options.camera\r\n  }\r\n\r\n  getCameraNear = () => this.camera.near\r\n  getCameraFar = () => this.camera.far\r\n  getCameraFov = () => this.camera.fov\r\n  getCameraZoom = () => this.camera.zoom\r\n  getCameraGizmoEnable = () => this.camera.gizmo.enable\r\n  getCameraGizmoSize = () => this.camera.gizmo.size\r\n  getCameraGizmoColor = () => toRGBColor(this.camera.gizmo.color)\r\n  getCameraGizmoOpacity = () => this.camera.gizmo.opacity\r\n  getCameraGizmoOpacityAlways = () => this.camera.gizmo.opacityAlways\r\n\r\n  // Camera Controls\r\n  private get cameraControls () {\r\n    return this.camera.controls!\r\n  }\r\n\r\n  getCameraIsOrbit = () => this.cameraControls.orbit\r\n  getCameraMoveSpeed = () => this.cameraControls.moveSpeed\r\n  getCameraRotateSpeed = () => this.cameraControls.rotateSpeed\r\n  getCameraOrbitSpeed = () => this.cameraControls.orbitSpeed\r\n  getCameraReferenceVimSize = () => this.cameraControls.vimReferenceSize\r\n}\r\n\r\nfunction toRGBColor (c: ViewerOptions.ColorRGB): THREE.Color {\r\n  return new THREE.Color(c.r / 255, c.g / 255, c.b / 255)\r\n}\r\n\r\nfunction toHSLColor (obj: ViewerOptions.ColorHSL): THREE.Color {\r\n  return new THREE.Color().setHSL(obj.h, obj.s, obj.l)\r\n}\r\n\r\nfunction toVec (obj: VimOptions.Vector3): THREE.Vector3 {\r\n  return new THREE.Vector3(obj.x, obj.y, obj.z)\r\n}\r\n","/**\r\n @module viw-webgl-viewer\r\n*/\r\n\r\nimport * as THREE from 'three'\r\nimport { CameraGizmo } from './gizmos'\r\nimport { Viewport } from './viewport'\r\nimport { ViewerSettings } from './viewerSettings'\r\nimport { Object } from '../vim'\r\nimport { RenderScene } from './renderScene'\r\n\r\nexport const DIRECTIONS = {\r\n  forward: new THREE.Vector3(0, 0, -1),\r\n  back: new THREE.Vector3(0, 0, 1),\r\n  left: new THREE.Vector3(-1, 0, 0),\r\n  right: new THREE.Vector3(1, 0, 0),\r\n  up: new THREE.Vector3(0, 1, 0),\r\n  down: new THREE.Vector3(0, -1, 0)\r\n}\r\n\r\nexport interface ICamera {\r\n  /**\r\n   * Wrapped Three.js camera\r\n   */\r\n  camera: THREE.Camera\r\n  /**\r\n   * Multiplier for camera movements.\r\n   */\r\n  speed: number\r\n\r\n  /**\r\n   * True: Camera orbit around target mode.\r\n   * False: First person free camera mode.\r\n   */\r\n  orbitMode: boolean\r\n\r\n  /**\r\n   * True: Orthographic camera.\r\n   * False: Perspective camera.\r\n   */\r\n  orthographic: boolean\r\n\r\n  /**\r\n   * Current local velocity\r\n   */\r\n  localVelocity: THREE.Vector3\r\n  /**\r\n   * Rotates the camera around the X or Y axis or both\r\n   * @param vector where coordinates are in relative screen size. ie [-1, 1]\r\n   */\r\n\r\n  /**\r\n   * Nudges the camera in given direction for a short distance.\r\n   * @param impulse impulse vector in camera local space.\r\n   */\r\n  addImpulse(impulse: THREE.Vector3): void\r\n\r\n  /**\r\n   * Moves the camera closer or farther away from orbit target.\r\n   * @param amount movement size.\r\n   */\r\n  zoom(amount: number): void\r\n\r\n  /**\r\n   * Moves the camera along all three axes.\r\n   */\r\n  move3(vector: THREE.Vector3): void\r\n\r\n  /**\r\n   * Moves the camera along two axes.\r\n   */\r\n  move2(vector: THREE.Vector2, axes: 'XY' | 'XZ'): void\r\n\r\n  /**\r\n   * Moves the camera along one axis.\r\n   */\r\n  move1(amount: number, axis: 'X' | 'Y' | 'Z'): void\r\n\r\n  /**\r\n   * Rotates the camera around the X or Y axis or both\r\n   * @param vector where coordinates in range [-1, 1] for rotations of [-180, 180] degrees\r\n   */\r\n  rotate(vector: THREE.Vector2): void\r\n\r\n  /**\r\n   * Sets orbit mode target and moves camera accordingly\r\n   */\r\n  target(target: Object | THREE.Vector3): void\r\n\r\n  /**\r\n   * Rotates the camera to look at target\r\n   */\r\n  lookAt(target: Object | THREE.Vector3)\r\n\r\n  /**\r\n   * Moves and rotates the camera so that target is well framed.\r\n   * if center is true -> camera.y = target.y\r\n   */\r\n  frame(target: Object | THREE.Sphere | 'all', center?: boolean): void\r\n}\r\n\r\n/**\r\n * Manages viewer camera movement and position\r\n */\r\nexport class Camera implements ICamera {\r\n  camera: THREE.PerspectiveCamera | THREE.OrthographicCamera\r\n  gizmo: CameraGizmo\r\n  private _viewport: Viewport\r\n  private _scene: RenderScene\r\n\r\n  private _inputVelocity: THREE.Vector3\r\n  private _velocity: THREE.Vector3\r\n  private _impulse: THREE.Vector3\r\n  speed: number\r\n\r\n  private _orbitalTarget: THREE.Vector3\r\n  private _minOrbitalDistance: number = 0.05\r\n  private _currentOrbitalDistance: number\r\n  private _orbitalTargetDistance: number\r\n\r\n  private _lerpSecondsDuration: number\r\n  private _lerpMsEndtime: number\r\n\r\n  private _orbitMode: boolean = false\r\n\r\n  // Settings\r\n  private _vimReferenceSize: number\r\n  private _sceneSizeMultiplier: number = 1\r\n  private _velocityBlendFactor: number = 0.0001\r\n  private _moveSpeed: number = 0.8\r\n  private _rotateSpeed: number = 1\r\n  private _orbitSpeed: number = 1\r\n  private _zoomSpeed: number = 0.2\r\n\r\n  constructor (\r\n    scene: RenderScene,\r\n    viewport: Viewport,\r\n    settings: ViewerSettings\r\n  ) {\r\n    this.camera = new THREE.PerspectiveCamera()\r\n    this.camera.position.set(0, 0, -1000)\r\n    this.camera.lookAt(0, 0, 0)\r\n    this._scene = scene\r\n    this._viewport = viewport\r\n    this._viewport.onResize(() => {\r\n      this.updateProjection(this._scene.getBoundingSphere())\r\n    })\r\n    this.applySettings(settings)\r\n\r\n    this._inputVelocity = new THREE.Vector3(0, 0, 0)\r\n    this._velocity = new THREE.Vector3(0, 0, 0)\r\n    this._impulse = new THREE.Vector3(0, 0, 0)\r\n    this.speed = 0\r\n    this._sceneSizeMultiplier = 1\r\n    this._orbitalTarget = new THREE.Vector3(0, 0, 0)\r\n    this._currentOrbitalDistance = this.camera.position\r\n      .clone()\r\n      .sub(this._orbitalTarget)\r\n      .length()\r\n    this._orbitalTargetDistance = this._currentOrbitalDistance\r\n  }\r\n\r\n  dispose () {\r\n    this.gizmo?.dispose()\r\n    this.gizmo = undefined\r\n  }\r\n\r\n  /**\r\n   * Resets camera to default state.\r\n   */\r\n  reset () {\r\n    this.camera.position.set(0, 0, -5)\r\n    this.camera.lookAt(0, 0, 1)\r\n\r\n    this._inputVelocity.set(0, 0, 0)\r\n    this._velocity.set(0, 0, 0)\r\n    this._impulse.set(0, 0, 0)\r\n\r\n    this._currentOrbitalDistance = 5\r\n    this._orbitalTarget.set(0, 0, 0)\r\n    this._orbitalTargetDistance = this._currentOrbitalDistance\r\n  }\r\n\r\n  get localVelocity () {\r\n    const result = this._velocity.clone()\r\n    result.applyQuaternion(this.camera.quaternion.clone().invert())\r\n    result.setZ(-result.z)\r\n    result.multiplyScalar((1 / this.getSpeedMultiplier()) * this._moveSpeed)\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * Set current velocity of the camera.\r\n   */\r\n  set localVelocity (vector: THREE.Vector3) {\r\n    const move = vector.clone()\r\n    move.setZ(-move.z)\r\n    move.applyQuaternion(this.camera.quaternion)\r\n    move.multiplyScalar(this.getSpeedMultiplier() * this._moveSpeed)\r\n\r\n    this._inputVelocity.copy(move)\r\n  }\r\n\r\n  /**\r\n   * True: Camera orbit around target mode.\r\n   * False: First person free camera mode.\r\n   */\r\n  public get orbitMode () {\r\n    return this._orbitMode\r\n  }\r\n\r\n  /**\r\n   * True: Camera orbit around target mode.\r\n   * False: First person free camera mode.\r\n   */\r\n  public set orbitMode (value: boolean) {\r\n    this._orbitMode = value\r\n    this.gizmo?.show(value)\r\n  }\r\n\r\n  /**\r\n   * Sets Orbit mode target and moves camera accordingly\r\n   */\r\n  target (target: Object | THREE.Vector3) {\r\n    const position =\r\n      target instanceof THREE.Vector3 ? target : target.getCenter()\r\n    this._orbitalTarget = position\r\n    this.startLerp(0.4)\r\n    this.gizmo?.show(true)\r\n  }\r\n\r\n  frame (target: Object | THREE.Sphere | 'all', center: boolean = false) {\r\n    if (target === 'all') {\r\n      this.frameSphere(this._scene.getBoundingSphere(), center)\r\n    }\r\n    if (target instanceof Object) {\r\n      this.frameSphere(target.getBoundingSphere(), center)\r\n    }\r\n    if (target instanceof THREE.Sphere) {\r\n      this.frameSphere(target, center)\r\n    }\r\n    this.gizmo?.show(true)\r\n  }\r\n\r\n  /**\r\n   * Rotates the camera to look at target\r\n   */\r\n  lookAt (target: Object | THREE.Vector3) {\r\n    const position =\r\n      target instanceof THREE.Vector3 ? target : target.getCenter()\r\n    this.camera.lookAt(position)\r\n  }\r\n\r\n  applySettings (settings: ViewerSettings) {\r\n    // Mode\r\n    this.orbitMode = settings.getCameraIsOrbit()\r\n\r\n    // Camera\r\n    if (this.camera instanceof THREE.PerspectiveCamera) {\r\n      this.camera.fov = settings.getCameraFov()\r\n      this.camera.zoom = settings.getCameraZoom()\r\n      this.camera.near = settings.getCameraNear()\r\n      this.camera.far = settings.getCameraFar()\r\n      this.camera.updateProjectionMatrix()\r\n    }\r\n\r\n    // Controls\r\n    this._moveSpeed = settings.getCameraMoveSpeed()\r\n    this._rotateSpeed = settings.getCameraRotateSpeed()\r\n    this._orbitSpeed = settings.getCameraOrbitSpeed()\r\n\r\n    // Values\r\n    this._vimReferenceSize = settings.getCameraReferenceVimSize()\r\n  }\r\n\r\n  /**\r\n   * Adapts camera speed to be faster for large model and slower for small models.\r\n   */\r\n  adaptToContent () {\r\n    const sphere = this._scene.getBoundingSphere()\r\n    this._sceneSizeMultiplier = sphere\r\n      ? sphere.radius / this._vimReferenceSize\r\n      : 1\r\n  }\r\n\r\n  /**\r\n   * Moves the camera closer or farther away from orbit target.\r\n   * @param amount movement size.\r\n   */\r\n  zoom (amount: number) {\r\n    if (this.camera instanceof THREE.PerspectiveCamera) {\r\n      const multiplier =\r\n        this._zoomSpeed *\r\n        this.getBaseMultiplier() *\r\n        (this._orbitalTargetDistance / this._vimReferenceSize)\r\n\r\n      const next = this._orbitalTargetDistance + amount * multiplier\r\n      this._orbitalTargetDistance = Math.max(next, this._minOrbitalDistance)\r\n      this.gizmo?.show()\r\n    } else {\r\n      const multiplier = this._zoomSpeed * this.getBaseMultiplier()\r\n      const padX = (this.camera.right - this.camera.left) * amount * multiplier\r\n      const padY = (this.camera.top - this.camera.bottom) * amount * multiplier\r\n\r\n      this.camera.left -= padX\r\n      this.camera.right += padX\r\n      this.camera.bottom -= padY\r\n      this.camera.top += padY\r\n      this.camera.updateProjectionMatrix()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Smoothly moves the camera in given direction for a short distance.\r\n   */\r\n  addImpulse (impulse: THREE.Vector3) {\r\n    const localImpulse = impulse\r\n      .clone()\r\n      .multiplyScalar(this.getSpeedMultiplier() * this._zoomSpeed)\r\n    localImpulse.applyQuaternion(this.camera.quaternion)\r\n    this._impulse.add(localImpulse)\r\n  }\r\n\r\n  /**\r\n   * Moves the camera along all three axes.\r\n   */\r\n  move3 (vector: THREE.Vector3) {\r\n    const v = vector.clone()\r\n    v.applyQuaternion(this.camera.quaternion)\r\n    v.multiplyScalar(this.getSpeedMultiplier() * this._moveSpeed)\r\n\r\n    this._orbitalTarget.add(v)\r\n    this.gizmo?.show()\r\n    if (!this.orbitMode) {\r\n      this.camera.position.add(v)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Moves the camera along two axis\r\n   */\r\n  move2 (vector: THREE.Vector2, axes: 'XY' | 'XZ') {\r\n    const direction =\r\n      axes === 'XY'\r\n        ? new THREE.Vector3(-vector.x, vector.y, 0)\r\n        : axes === 'XZ'\r\n          ? new THREE.Vector3(-vector.x, 0, vector.y)\r\n          : undefined\r\n\r\n    this.move3(direction)\r\n  }\r\n\r\n  /**\r\n   * Moves the camera along one axis\r\n   */\r\n  move1 (amount: number, axis: 'X' | 'Y' | 'Z') {\r\n    const direction = new THREE.Vector3(\r\n      axis === 'X' ? -amount : 0,\r\n      axis === 'Y' ? amount : 0,\r\n      axis === 'Z' ? amount : 0\r\n    )\r\n\r\n    this._currentOrbitalDistance += direction.z\r\n\r\n    this.move3(direction)\r\n  }\r\n\r\n  /**\r\n   * Rotates the camera around the X or Y axis or both\r\n   * @param vector where coordinates in range [-1, 1] for rotations of [-180, 180] degrees\r\n   */\r\n  rotate (vector: THREE.Vector2) {\r\n    if (this.isLerping()) return\r\n    const euler = new THREE.Euler(0, 0, 0, 'YXZ')\r\n    euler.setFromQuaternion(this.camera.quaternion)\r\n\r\n    // When moving the mouse one full sreen\r\n    // Orbit will rotate 180 degree around the scene\r\n    // Basic will rotate 180 degrees on itself\r\n    const factor = this.orbitMode\r\n      ? Math.PI * this._orbitSpeed\r\n      : Math.PI * this._rotateSpeed\r\n\r\n    euler.y -= vector.x * factor\r\n    euler.x -= vector.y * factor\r\n    euler.z = 0\r\n\r\n    // Clamp X rotation to prevent performing a loop.\r\n    const max = Math.PI * 0.48\r\n    euler.x = Math.max(-max, Math.min(max, euler.x))\r\n\r\n    this.camera.quaternion.setFromEuler(euler)\r\n\r\n    if (!this.orbitMode) {\r\n      const offset = new THREE.Vector3(0, 0, 1)\r\n        .applyQuaternion(this.camera.quaternion)\r\n        .multiplyScalar(this._currentOrbitalDistance)\r\n\r\n      this._orbitalTarget = this.camera.position.clone().sub(offset)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply the camera frame update\r\n   */\r\n  update (deltaTime: number) {\r\n    const targetVelocity = this._inputVelocity.clone()\r\n\r\n    // Update the camera velocity and position\r\n    const invBlendFactor = Math.pow(this._velocityBlendFactor, deltaTime)\r\n    const blendFactor = 1.0 - invBlendFactor\r\n\r\n    this._velocity.multiplyScalar(invBlendFactor)\r\n    targetVelocity.multiplyScalar(blendFactor)\r\n    this._velocity.add(targetVelocity)\r\n\r\n    this._currentOrbitalDistance =\r\n      this._currentOrbitalDistance * invBlendFactor +\r\n      this._orbitalTargetDistance * blendFactor\r\n\r\n    const positionDelta = this._velocity.clone().multiplyScalar(deltaTime)\r\n    const impulse = this._impulse.clone().multiplyScalar(blendFactor)\r\n    positionDelta.add(impulse)\r\n\r\n    const orbitDelta = positionDelta.clone()\r\n\r\n    this._impulse.multiplyScalar(invBlendFactor)\r\n    this.camera.position.add(positionDelta)\r\n    this._orbitalTarget.add(orbitDelta)\r\n\r\n    if (this.orbitMode) {\r\n      const target = new THREE.Vector3(0, 0, this._currentOrbitalDistance)\r\n      target.applyQuaternion(this.camera.quaternion)\r\n      target.add(this._orbitalTarget)\r\n\r\n      if (this.isLerping()) {\r\n        const frames = this._lerpSecondsDuration / deltaTime\r\n        const alpha = 1 - Math.pow(0.01, 1 / frames)\r\n        this.camera.position.lerp(target, alpha)\r\n      } else {\r\n        this.camera.position.copy(target)\r\n        if (this.isSignificant(positionDelta)) {\r\n          this.gizmo?.show()\r\n        }\r\n      }\r\n    }\r\n\r\n    this.gizmo?.setPosition(this._orbitalTarget)\r\n  }\r\n\r\n  /**\r\n   * Rotates the camera so that it looks at sphere\r\n   * Adjusts distance so that the sphere is well framed\r\n   */\r\n  private frameSphere (sphere: THREE.Sphere, center: boolean) {\r\n    if (!sphere) {\r\n      this.reset()\r\n      return\r\n    }\r\n\r\n    if (center) {\r\n      this.camera.position.setY(sphere.center.y)\r\n    }\r\n\r\n    this.camera.lookAt(sphere.center)\r\n    this._currentOrbitalDistance = sphere.radius * 3\r\n    this._orbitalTargetDistance = sphere.radius * 3\r\n    this._orbitalTarget = sphere.center\r\n    this.updateProjection(sphere)\r\n  }\r\n\r\n  updateProjection (sphere: THREE.Sphere) {\r\n    const aspect = this._viewport.getAspectRatio()\r\n    if (this.camera instanceof THREE.PerspectiveCamera) {\r\n      this.camera.aspect = aspect\r\n    } else {\r\n      this.camera.left = -sphere.radius * aspect\r\n      this.camera.right = sphere.radius * aspect\r\n      this.camera.top = sphere.radius\r\n      this.camera.bottom = -sphere.radius\r\n      this.camera.near = 0.1\r\n      this.camera.far = sphere.radius * 10\r\n    }\r\n    this.camera.updateProjectionMatrix()\r\n  }\r\n\r\n  get orthographic () {\r\n    return this.camera instanceof THREE.OrthographicCamera\r\n  }\r\n\r\n  set orthographic (value: boolean) {\r\n    if (value === this.orthographic) return\r\n\r\n    const cam = value\r\n      ? new THREE.OrthographicCamera(-1, 1, 1, -1, -1, 1)\r\n      : new THREE.PerspectiveCamera()\r\n\r\n    cam.position.copy(this.camera.position)\r\n    cam.rotation.copy(this.camera.rotation)\r\n    this.camera = cam\r\n\r\n    this.updateProjection(this._scene.getBoundingSphere())\r\n  }\r\n\r\n  private getBaseMultiplier () {\r\n    return Math.pow(1.25, this.speed)\r\n  }\r\n\r\n  private getSpeedMultiplier () {\r\n    return (\r\n      this.getBaseMultiplier() *\r\n      // (dist / size) * (size / ref). Size gets canceled.\r\n      (this._orbitalTargetDistance / this._vimReferenceSize)\r\n    )\r\n  }\r\n\r\n  private getDistanceMultiplier () {}\r\n\r\n  private isLerping () {\r\n    return new Date().getTime() < this._lerpMsEndtime\r\n  }\r\n\r\n  private startLerp (seconds: number) {\r\n    this._lerpMsEndtime = new Date().getTime() + seconds * 1000\r\n    this._lerpSecondsDuration = seconds\r\n  }\r\n\r\n  private isSignificant (vector: THREE.Vector3) {\r\n    // One hundreth of standard scene size per frame\r\n    const min = (0.01 * this._sceneSizeMultiplier) / 60\r\n    return (\r\n      Math.abs(vector.x) > min ||\r\n      Math.abs(vector.y) > min ||\r\n      Math.abs(vector.z) > min\r\n    )\r\n  }\r\n}\r\n","/**\r\n * @module viw-webgl-viewer\r\n */\r\n\r\nimport * as THREE from 'three'\r\nimport { Viewer } from './viewer'\r\n\r\nexport const KEYS = {\r\n  KEY_0: 48,\r\n  KEY_1: 49,\r\n  KEY_2: 50,\r\n  KEY_3: 51,\r\n  KEY_4: 52,\r\n  KEY_5: 53,\r\n  KEY_6: 54,\r\n  KEY_7: 55,\r\n  KEY_8: 56,\r\n  KEY_9: 57,\r\n\r\n  KEY_LEFT: 0x25,\r\n  KEY_RIGHT: 0x27,\r\n  KEY_UP: 0x26,\r\n  KEY_DOWN: 0x28,\r\n  KEY_CTRL: 0x11,\r\n  KEY_SHIFT: 0x10,\r\n  KEY_ENTER: 0x0d,\r\n  KEY_SPACE: 0x20,\r\n  KEY_TAB: 0x09,\r\n  KEY_ESCAPE: 0x1b,\r\n  KEY_BACKSPACE: 0x08,\r\n  KEY_HOME: 0x24,\r\n  KEY_END: 0x23,\r\n  KEY_INSERT: 0x2d,\r\n  KEY_DELETE: 0x2e,\r\n  KEY_ALT: 0x12,\r\n\r\n  KEY_F1: 0x70,\r\n  KEY_F2: 0x71,\r\n  KEY_F3: 0x72,\r\n  KEY_F4: 0x73,\r\n  KEY_F5: 0x74,\r\n  KEY_F6: 0x75,\r\n  KEY_F7: 0x76,\r\n  KEY_F8: 0x77,\r\n  KEY_F9: 0x78,\r\n  KEY_F10: 0x79,\r\n  KEY_F11: 0x7a,\r\n  KEY_F12: 0x7b,\r\n\r\n  KEY_NUMPAD0: 0x60,\r\n  KEY_NUMPAD1: 0x61,\r\n  KEY_NUMPAD2: 0x62,\r\n  KEY_NUMPAD3: 0x63,\r\n  KEY_NUMPAD4: 0x64,\r\n  KEY_NUMPAD5: 0x65,\r\n  KEY_NUMPAD6: 0x66,\r\n  KEY_NUMPAD7: 0x67,\r\n  KEY_NUMPAD8: 0x68,\r\n  KEY_NUMPAD9: 0x69,\r\n\r\n  KEY_ADD: 0x6b,\r\n  KEY_SUBTRACT: 0x6d,\r\n  KEY_MULTIPLY: 0x6a,\r\n  KEY_DIVIDE: 0x6f,\r\n  KEY_SEPARATOR: 0x6c,\r\n  KEY_DECIMAL: 0x6e,\r\n\r\n  KEY_OEM_PLUS: 0xbb,\r\n  KEY_OEM_MINUS: 0xbd,\r\n\r\n  KEY_A: 65,\r\n  KEY_B: 66,\r\n  KEY_C: 67,\r\n  KEY_D: 68,\r\n  KEY_E: 69,\r\n  KEY_F: 70,\r\n  KEY_G: 71,\r\n  KEY_H: 72,\r\n  KEY_I: 73,\r\n  KEY_J: 74,\r\n  KEY_K: 75,\r\n  KEY_L: 76,\r\n  KEY_M: 77,\r\n  KEY_N: 78,\r\n  KEY_O: 79,\r\n  KEY_P: 80,\r\n  KEY_Q: 81,\r\n  KEY_R: 82,\r\n  KEY_S: 83,\r\n  KEY_T: 84,\r\n  KEY_U: 85,\r\n  KEY_V: 86,\r\n  KEY_W: 87,\r\n  KEY_X: 88,\r\n  KEY_Y: 89,\r\n  KEY_Z: 90\r\n}\r\n\r\n/**\r\n * Manages keyboard user inputs\r\n */\r\nexport class Keyboard {\r\n  // Settings\r\n  private SHIFT_MULTIPLIER: number = 3.0\r\n\r\n  // Dependencies\r\n  private _viewer: Viewer\r\n\r\n  private get camera () {\r\n    return this._viewer.camera\r\n  }\r\n\r\n  private get selection () {\r\n    return this._viewer.selection\r\n  }\r\n\r\n  // State\r\n  isUpPressed: boolean\r\n  isDownPressed: boolean\r\n  isLeftPressed: boolean\r\n  isRightPressed: boolean\r\n  isEPressed: boolean\r\n  isQPressed: boolean\r\n  isShiftPressed: boolean = false\r\n  isCtrlPressed: boolean\r\n\r\n  constructor (viewer: Viewer) {\r\n    this._viewer = viewer\r\n  }\r\n\r\n  reset = () => {\r\n    this.isUpPressed = false\r\n    this.isDownPressed = false\r\n    this.isLeftPressed = false\r\n    this.isRightPressed = false\r\n    this.isEPressed = false\r\n    this.isQPressed = false\r\n    this.isShiftPressed = false\r\n    this.isCtrlPressed = false\r\n  }\r\n\r\n  onKeyUp = (event: any) => {\r\n    this.onKey(event, false)\r\n  }\r\n\r\n  onKeyDown = (event: any) => {\r\n    this.onKey(event, true)\r\n  }\r\n\r\n  onKey = (event: any, keyDown: boolean) => {\r\n    // Buttons that activate once on key up\r\n    if (!keyDown) {\r\n      switch (event.keyCode) {\r\n        case KEYS.KEY_ADD:\r\n        case KEYS.KEY_OEM_PLUS:\r\n          this.camera.speed += 1\r\n          event.preventDefault()\r\n          break\r\n        case KEYS.KEY_SUBTRACT:\r\n        case KEYS.KEY_OEM_MINUS:\r\n          this.camera.speed -= 1\r\n          event.preventDefault()\r\n          break\r\n        case KEYS.KEY_F8:\r\n        case KEYS.KEY_SPACE:\r\n          this.camera.orbitMode = !this.camera.orbitMode\r\n          event.preventDefault()\r\n          break\r\n        case KEYS.KEY_HOME:\r\n          this.camera.frame('all', true)\r\n          event.preventDefault()\r\n          break\r\n        // Selection\r\n        case KEYS.KEY_ESCAPE:\r\n          this.selection.clear()\r\n          event.preventDefault()\r\n          break\r\n        case KEYS.KEY_Z:\r\n        case KEYS.KEY_F:\r\n          this.camera.frame(this.selection.object)\r\n          event.preventDefault()\r\n          break\r\n      }\r\n    }\r\n\r\n    // Camera Movement, Buttons that need constant state refresh\r\n    switch (event.keyCode) {\r\n      case KEYS.KEY_W:\r\n      case KEYS.KEY_UP:\r\n        this.isUpPressed = keyDown\r\n        this.applyMove()\r\n        event.preventDefault()\r\n        break\r\n      case KEYS.KEY_S:\r\n      case KEYS.KEY_DOWN:\r\n        this.isDownPressed = keyDown\r\n        this.applyMove()\r\n        event.preventDefault()\r\n        break\r\n      case KEYS.KEY_D:\r\n      case KEYS.KEY_RIGHT:\r\n        this.isRightPressed = keyDown\r\n        this.applyMove()\r\n        event.preventDefault()\r\n        break\r\n      case KEYS.KEY_A:\r\n      case KEYS.KEY_LEFT:\r\n        this.isLeftPressed = keyDown\r\n        this.applyMove()\r\n        event.preventDefault()\r\n        break\r\n      case KEYS.KEY_E:\r\n        this.isEPressed = keyDown\r\n        this.applyMove()\r\n        event.preventDefault()\r\n        break\r\n      case KEYS.KEY_Q:\r\n        this.isQPressed = keyDown\r\n        this.applyMove()\r\n        event.preventDefault()\r\n        break\r\n      case KEYS.KEY_SHIFT:\r\n        this.isShiftPressed = keyDown\r\n        this.applyMove()\r\n        event.preventDefault()\r\n        break\r\n      case KEYS.KEY_CTRL:\r\n        this.isCtrlPressed = keyDown\r\n        console.log('Control:' + keyDown)\r\n        event.preventDefault()\r\n        break\r\n    }\r\n  }\r\n\r\n  private applyMove = () => {\r\n    const move = new THREE.Vector3(\r\n      (this.isRightPressed ? 1 : 0) - (this.isLeftPressed ? 1 : 0),\r\n      (this.isEPressed ? 1 : 0) - (this.isQPressed ? 1 : 0),\r\n      (this.isUpPressed ? 1 : 0) - (this.isDownPressed ? 1 : 0)\r\n    )\r\n    const speed = this.isShiftPressed ? this.SHIFT_MULTIPLIER : 1\r\n    move.multiplyScalar(speed)\r\n    this.camera.localVelocity = move\r\n  }\r\n}\r\n","/**\r\n * @module viw-webgl-viewer\r\n */\r\n\r\nimport * as THREE from 'three'\r\nimport { Mouse } from './mouse'\r\nimport { Viewer } from './viewer'\r\n\r\n/**\r\n * Manages user touch inputs.\r\n */\r\nexport class Touch {\r\n  TAP_DURATION_MS: number = 500\r\n\r\n  // Dependencies\r\n  private _viewer: Viewer\r\n  private _mouse: Mouse\r\n\r\n  private get camera () {\r\n    return this._viewer.camera\r\n  }\r\n\r\n  private get viewport () {\r\n    return this._viewer.viewport\r\n  }\r\n\r\n  // State\r\n  private _touchStart: THREE.Vector2 | undefined = undefined // When one touch occurs this is the value, when two or more touches occur it is the average of the first two.\r\n  private _touchStart1: THREE.Vector2 | undefined = undefined // The first touch when multiple touches occur, otherwise left undefined\r\n  private _touchStart2: THREE.Vector2 | undefined = undefined // The second touch when multiple touches occur, otherwise left undefined\r\n  private _touchStartTime: number | undefined = undefined // In ms since epoch\r\n\r\n  constructor (viewer: Viewer, mouse: Mouse) {\r\n    this._viewer = viewer\r\n    this._mouse = mouse\r\n  }\r\n\r\n  reset = () => {\r\n    this._touchStart =\r\n      this._touchStart1 =\r\n      this._touchStart2 =\r\n      this._touchStartTime =\r\n        undefined\r\n  }\r\n\r\n  private onTap = (position: THREE.Vector2) => {\r\n    this._mouse.onMouseClick(position, false)\r\n  }\r\n\r\n  onTouchStart = (event: any) => {\r\n    event.preventDefault() // prevent scrolling\r\n    if (!event || !event.touches || !event.touches.length) {\r\n      return\r\n    }\r\n    this._touchStartTime = new Date().getTime()\r\n\r\n    if (event.touches.length === 1) {\r\n      this._touchStart = this.touchToVector(event.touches[0])\r\n      this._touchStart1 = this._touchStart2 = undefined\r\n    } else if (event.touches.length === 2) {\r\n      this._touchStart1 = this.touchToVector(event.touches[0])\r\n      this._touchStart2 = this.touchToVector(event.touches[1])\r\n      this._touchStart = this.average(this._touchStart1, this._touchStart2)\r\n    }\r\n  }\r\n\r\n  onDrag = (delta: THREE.Vector2) => {\r\n    this.camera.rotate(delta)\r\n  }\r\n\r\n  onDoubleDrag = (delta: THREE.Vector2) => {\r\n    this.camera.move2(delta, 'XY')\r\n  }\r\n\r\n  onPinchOrSpread = (delta: number) => {\r\n    this.camera.move1(delta, 'Z')\r\n  }\r\n\r\n  onTouchMove = (event: any) => {\r\n    event.preventDefault()\r\n    if (!event || !event.touches || !event.touches.length) return\r\n    if (!this._touchStart) return\r\n\r\n    if (event.touches.length === 1) {\r\n      const pos = this.touchToVector(event.touches[0])\r\n      const [width, height] = this.viewport.getSize()\r\n      const delta = pos\r\n        .clone()\r\n        .sub(this._touchStart)\r\n        .multiply(new THREE.Vector2(1 / width, 1 / height))\r\n\r\n      this._touchStart = pos\r\n      this.onDrag(delta)\r\n      return\r\n    }\r\n\r\n    if (!this._touchStart1 || !this._touchStart2) return\r\n    if (event.touches.length >= 2) {\r\n      const p1 = this.touchToVector(event.touches[0])\r\n      const p2 = this.touchToVector(event.touches[1])\r\n      const p = this.average(p1, p2)\r\n      const [width, height] = this.viewport.getSize()\r\n      const moveDelta = this._touchStart\r\n        .clone()\r\n        .sub(p)\r\n        .multiply(\r\n          // -1 to invert movement\r\n          new THREE.Vector2(-1 / width, -1 / height)\r\n        )\r\n\r\n      const zoom = p1.distanceTo(p2)\r\n      const prevZoom = this._touchStart1.distanceTo(this._touchStart2)\r\n      const min = Math.min(width, height)\r\n      // -1 to invert movement\r\n      const zoomDelta = (zoom - prevZoom) / -min\r\n\r\n      this._touchStart = p\r\n      this._touchStart1 = p1\r\n      this._touchStart2 = p2\r\n\r\n      if (moveDelta.length() > Math.abs(zoomDelta)) {\r\n        this.onDoubleDrag(moveDelta)\r\n      } else {\r\n        this.onPinchOrSpread(zoomDelta)\r\n      }\r\n    }\r\n  }\r\n\r\n  onTouchEnd = (_: any) => {\r\n    if (this.isSingleTouch()) {\r\n      const touchDurationMs = new Date().getTime() - this._touchStartTime!\r\n      if (touchDurationMs < this.TAP_DURATION_MS) {\r\n        this.onTap(this._touchStart!)\r\n      }\r\n    }\r\n    this.reset()\r\n  }\r\n\r\n  private isSingleTouch (): boolean {\r\n    return (\r\n      this._touchStart !== undefined &&\r\n      this._touchStartTime !== undefined &&\r\n      this._touchStart1 === undefined &&\r\n      this._touchStart2 === undefined\r\n    )\r\n  }\r\n\r\n  private touchToVector (touch: any) {\r\n    return new THREE.Vector2(touch.pageX, touch.pageY)\r\n  }\r\n\r\n  private average (p1: THREE.Vector2, p2: THREE.Vector2): THREE.Vector2 {\r\n    return p1.clone().lerp(p2, 0.5)\r\n  }\r\n}\r\n","/**\r\n * @module viw-webgl-viewer\r\n */\r\n\r\nimport * as THREE from 'three'\r\nimport { Viewer } from './viewer'\r\nimport { Raycaster } from './raycaster'\r\nimport { Keyboard } from './keyboard'\r\n\r\n/**\r\n * Manages mouse user inputs\r\n */\r\nexport class Mouse {\r\n  // Dependencies\r\n  private _viewer: Viewer\r\n  private _raycaster: Raycaster\r\n  private _inputKeyboard: Keyboard\r\n\r\n  private get camera () {\r\n    return this._viewer.camera\r\n  }\r\n\r\n  private get viewport () {\r\n    return this._viewer.viewport\r\n  }\r\n\r\n  // State\r\n  isMouseDown: Boolean = false\r\n  hasMouseMoved: Boolean = false\r\n\r\n  constructor (viewer: Viewer, keyboard: Keyboard) {\r\n    this._viewer = viewer\r\n    this._raycaster = this._viewer.raycaster\r\n    this._inputKeyboard = keyboard\r\n  }\r\n\r\n  reset = () => {\r\n    this.isMouseDown = this.hasMouseMoved = false\r\n  }\r\n\r\n  onMouseOut = (_: any) => {\r\n    this.isMouseDown = this.hasMouseMoved = false\r\n  }\r\n\r\n  onMouseMove = (event: any) => {\r\n    if (!this.isMouseDown) {\r\n      return\r\n    }\r\n\r\n    event.preventDefault()\r\n\r\n    // https://github.com/mrdoob/three.js/blob/master/examples/jsm/controls/PointerLockControls.js\r\n    const deltaX =\r\n      event.movementX || event.mozMovementX || event.webkitMovementX || 0\r\n    const deltaY =\r\n      event.movementY || event.mozMovementY || event.webkitMovementY || 0\r\n    const [width, height] = this.viewport.getSize()\r\n    const delta = new THREE.Vector2(deltaX / width, deltaY / height)\r\n\r\n    this.hasMouseMoved =\r\n      this.hasMouseMoved || Math.abs(deltaX) + Math.abs(deltaY) > 3\r\n\r\n    if (event.buttons & 2) {\r\n      // right button\r\n      this.camera.move2(delta, 'XY')\r\n    } else if (event.buttons & 4) {\r\n      // Midle button\r\n      this.camera.move2(delta, 'XZ')\r\n    } else {\r\n      // left button\r\n      this.camera.rotate(delta)\r\n    }\r\n  }\r\n\r\n  onMouseWheel = (event: any) => {\r\n    event.preventDefault()\r\n    event.stopPropagation()\r\n\r\n    // Value of event.deltaY will change from browser to browser\r\n    // https://stackoverflow.com/questions/38942821/wheel-event-javascript-give-inconsistent-values\r\n    // Thus we only use the direction of the value\r\n    const scrollValue = Math.sign(event.deltaY)\r\n\r\n    if (this._inputKeyboard.isCtrlPressed) {\r\n      this.camera.speed -= scrollValue\r\n    } else if (this.camera.orbitMode) {\r\n      this.camera.zoom(scrollValue)\r\n    } else {\r\n      const impulse = new THREE.Vector3(0, 0, scrollValue)\r\n      this.camera.addImpulse(impulse)\r\n    }\r\n  }\r\n\r\n  onMouseDown = (event: any) => {\r\n    event.preventDefault()\r\n    this.isMouseDown = true\r\n    this.hasMouseMoved = false\r\n\r\n    // Manually set the focus since calling preventDefault above\r\n    // prevents the browser from setting it automatically.\r\n    this.viewport.canvas.focus()\r\n  }\r\n\r\n  onMouseUp = (event: any) => {\r\n    if (this.isMouseDown && !this.hasMouseMoved) {\r\n      this.onMouseClick(new THREE.Vector2(event.offsetX, event.offsetY), false)\r\n    }\r\n    this.isMouseDown = false\r\n    event.preventDefault()\r\n  }\r\n\r\n  onDoubleClick = (event: any) => {\r\n    this.onMouseClick(new THREE.Vector2(event.offsetX, event.offsetY), true)\r\n  }\r\n\r\n  onMouseClick = (position: THREE.Vector2, doubleClick: boolean) => {\r\n    const result = this._raycaster.screenRaycast(position)\r\n    result.doubleClick = doubleClick\r\n    this._viewer.onMouseClick(result)\r\n  }\r\n}\r\n","/**\r\n * @module viw-webgl-viewer\r\n */\r\n\r\nimport { Viewer } from './viewer'\r\nimport { Keyboard } from './keyboard'\r\nimport { Touch } from './touch'\r\nimport { Mouse } from './mouse'\r\n\r\n/**\r\n * Manages and registers all viewer user inputs for mouse, keyboard and touch\r\n */\r\nexport class Input {\r\n  // Dependencies\r\n  private _canvas: HTMLCanvasElement\r\n\r\n  // State\r\n  private _unregisters: Function[]\r\n  private _touch: Touch\r\n  private _mouse: Mouse\r\n  private _keyboard: Keyboard\r\n\r\n  constructor (viewer: Viewer) {\r\n    this._canvas = viewer.viewport.canvas\r\n    this._unregisters = []\r\n\r\n    this._keyboard = new Keyboard(viewer)\r\n    this._mouse = new Mouse(viewer, this._keyboard)\r\n    this._touch = new Touch(viewer, this._mouse)\r\n  }\r\n\r\n  private reg = (\r\n    // eslint-disable-next-line no-undef\r\n    handler: DocumentAndElementEventHandlers,\r\n    type: string,\r\n    listener: (event: any) => void\r\n  ) => {\r\n    handler.addEventListener(type, listener)\r\n    this._unregisters.push(() => handler.removeEventListener(type, listener))\r\n  }\r\n\r\n  /**\r\n   * Register inputs handlers for default viewer behavior\r\n   */\r\n  register () {\r\n    // mouse\r\n    this.reg(this._canvas, 'mousedown', this._mouse.onMouseDown)\r\n    this.reg(this._canvas, 'wheel', this._mouse.onMouseWheel)\r\n    this.reg(this._canvas, 'mousemove', this._mouse.onMouseMove)\r\n    this.reg(this._canvas, 'mouseup', this._mouse.onMouseUp)\r\n    this.reg(this._canvas, 'mouseout', this._mouse.onMouseOut)\r\n    this.reg(this._canvas, 'dblclick', this._mouse.onDoubleClick)\r\n\r\n    // touch\r\n    this.reg(this._canvas, 'touchstart', this._touch.onTouchStart)\r\n    this.reg(this._canvas, 'touchend', this._touch.onTouchEnd)\r\n    this.reg(this._canvas, 'touchmove', this._touch.onTouchMove)\r\n\r\n    // keys\r\n    this.reg(document, 'keydown', this._keyboard.onKeyDown)\r\n    this.reg(document, 'keyup', this._keyboard.onKeyUp)\r\n\r\n    // Disable right click menu\r\n    this.reg(this._canvas, 'contextmenu', (e) => e.preventDefault())\r\n  }\r\n\r\n  /**\r\n   * Unregisters all input handlers\r\n   */\r\n  unregister = () => {\r\n    this._unregisters.forEach((f) => f())\r\n    this.reset()\r\n  }\r\n\r\n  /**\r\n   * Resets all input state\r\n   */\r\n  reset () {\r\n    this._mouse.reset()\r\n    this._keyboard.reset()\r\n    this._touch.reset()\r\n  }\r\n}\r\n","/**\r\n * @module viw-webgl-viewer\r\n */\r\n\r\nimport * as THREE from 'three'\r\nimport { Object } from '../vim-loader/object'\r\nimport { Renderer } from './renderer'\r\n\r\n// TODO: Fix circular dependency\r\n/**\r\n * Provides basic selection mechanic in viewer\r\n */\r\nexport class Selection {\r\n  // Dependencies\r\n  private _renderer: Renderer\r\n\r\n  // State\r\n  private _object: Object | undefined\r\n\r\n  // Disposable State\r\n  private _highligt: THREE.LineSegments | undefined\r\n\r\n  constructor (renderer: Renderer) {\r\n    this._renderer = renderer\r\n  }\r\n\r\n  /**\r\n   * Returns selected object.\r\n   */\r\n  get object () {\r\n    return this._object\r\n  }\r\n\r\n  /**\r\n   * Select given object\r\n   */\r\n  select (object: Object) {\r\n    this.clear()\r\n    if (object) {\r\n      this._object = object\r\n      this._highligt = object.createWireframe()\r\n      this._renderer.add(this._highligt)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear selection and related highlights\r\n   */\r\n  clear () {\r\n    this._object = undefined\r\n\r\n    if (this._highligt) {\r\n      this._highligt.geometry.dispose()\r\n      this._renderer.remove(this._highligt)\r\n      this._highligt = undefined\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @module viw-webgl-viewer\r\n */\r\n\r\nimport * as THREE from 'three'\r\nimport { ViewerSettings } from './viewerSettings'\r\nimport { Box3 } from 'three'\r\n\r\n/**\r\n * Manages the THREE.Mesh for the ground plane under the vims\r\n */\r\nexport class GroundPlane {\r\n  mesh: THREE.Mesh\r\n\r\n  private _source: string\r\n\r\n  private _size: number\r\n\r\n  // disposable\r\n  private _geometry: THREE.PlaneBufferGeometry\r\n  private _material: THREE.MeshBasicMaterial\r\n  private _texture: THREE.Texture\r\n\r\n  constructor () {\r\n    this._geometry = new THREE.PlaneBufferGeometry()\r\n    this._material = new THREE.MeshBasicMaterial({ transparent: true })\r\n    this.mesh = new THREE.Mesh(this._geometry, this._material)\r\n  }\r\n\r\n  applyViewerSettings (settings: ViewerSettings) {\r\n    this._size = settings.getGroundPlaneSize()\r\n    // Visibily\r\n    this.mesh.visible = settings.getGroundPlaneShow()\r\n\r\n    // Looks\r\n    this.applyTexture(settings.getGroundPlaneTextureUrl())\r\n    this._material.color.copy(settings.getGroundPlaneColor())\r\n    this._material.opacity = settings.getGroundPlaneOpacity()\r\n  }\r\n\r\n  adaptToContent (box: THREE.Box3) {\r\n    // Position\r\n    const center = box.getCenter(new THREE.Vector3())\r\n    const position = new THREE.Vector3(\r\n      center.x,\r\n      box.min.y - Math.abs(box.min.y) * 0.01,\r\n      center.z\r\n    )\r\n    this.mesh.position.copy(position)\r\n    // Rotation\r\n    // Face up, rotate by 270 degrees around x\r\n    this.mesh.quaternion.copy(\r\n      new THREE.Quaternion().setFromEuler(new THREE.Euler(1.5 * Math.PI, 0, 0))\r\n    )\r\n\r\n    // Scale\r\n    const sphere = box?.getBoundingSphere(new THREE.Sphere())\r\n    const size = (sphere?.radius ?? 1) * this._size\r\n    const scale = new THREE.Vector3(1, 1, 1).multiplyScalar(size)\r\n    this.mesh.scale.copy(scale)\r\n  }\r\n\r\n  applyTexture (texUrl: string) {\r\n    // Check for changes\r\n    if (texUrl === this._source) return\r\n    this._source = texUrl\r\n\r\n    // dispose previous texture\r\n    this._texture?.dispose()\r\n    this._texture = undefined\r\n\r\n    // Bail if new texture url, is no texture\r\n    if (!texUrl) return\r\n\r\n    // load texture\r\n    const loader = new THREE.TextureLoader()\r\n    this._texture = loader.load(texUrl)\r\n    if (!this._texture) {\r\n      console.error('Failed to load texture: ' + texUrl)\r\n      return\r\n    }\r\n\r\n    // Apply texture\r\n    this._material.map = this._texture\r\n  }\r\n\r\n  dispose () {\r\n    this._geometry?.dispose()\r\n    this._material?.dispose()\r\n    this._texture?.dispose()\r\n\r\n    this._geometry = undefined\r\n    this._material = undefined\r\n    this._texture = undefined\r\n  }\r\n}\r\n\r\n/**\r\n * Manages ground plane and lights that are part of the THREE.Scene to render but not part of the Vims.\r\n */\r\nexport class Environment {\r\n  skyLight: THREE.HemisphereLight\r\n  sunLight: THREE.DirectionalLight\r\n  private _groundPlane: GroundPlane\r\n\r\n  get groundPlane () {\r\n    return this._groundPlane.mesh\r\n  }\r\n\r\n  constructor (settings: ViewerSettings) {\r\n    this._groundPlane = new GroundPlane()\r\n    this.skyLight = new THREE.HemisphereLight()\r\n    this.sunLight = new THREE.DirectionalLight()\r\n    this.applySettings(settings)\r\n  }\r\n\r\n  /**\r\n   * Returns all three objects composing the environment\r\n   */\r\n  getObjects (): THREE.Object3D[] {\r\n    return [this._groundPlane.mesh, this.skyLight, this.sunLight]\r\n  }\r\n\r\n  applySettings (settings: ViewerSettings) {\r\n    // Plane\r\n    this._groundPlane.applyViewerSettings(settings)\r\n\r\n    // Skylight\r\n    this.skyLight.color.copy(settings.getSkylightColor())\r\n    this.skyLight.groundColor.copy(settings.getSkylightGroundColor())\r\n    this.skyLight.intensity = settings.getSkylightIntensity()\r\n\r\n    // Sunlight\r\n    this.sunLight.color.copy(settings.getSunlightColor())\r\n    this.sunLight.position.copy(settings.getSunlightPosition())\r\n    this.sunLight.intensity = settings.getSunlightIntensity()\r\n  }\r\n\r\n  /**\r\n   * Adjust scale so that it matches box dimensions.\r\n   */\r\n  adaptToContent (box: Box3) {\r\n    // Plane\r\n    this._groundPlane.adaptToContent(box)\r\n  }\r\n\r\n  dispose () {\r\n    this.sunLight.dispose()\r\n    this.skyLight.dispose()\r\n    this._groundPlane.dispose()\r\n\r\n    this.sunLight = undefined\r\n    this.skyLight = undefined\r\n    this._groundPlane = undefined\r\n  }\r\n}\r\n\r\nexport interface IEnvironment {\r\n  skyLight: THREE.HemisphereLight\r\n  sunLight: THREE.DirectionalLight\r\n  groundPlane: THREE.Mesh\r\n}\r\n","/**\r\n * @module viw-webgl-viewer\r\n */\r\n\r\nimport * as THREE from 'three'\r\nimport { Scene } from '../vim-loader/scene'\r\nimport { Viewport } from './viewport'\r\nimport { RenderScene } from './renderScene'\r\n\r\n/**\r\n * Manages how vim objects are added and removed from the THREE.Scene to be rendered\r\n */\r\nexport class Renderer {\r\n  renderer: THREE.WebGLRenderer\r\n  viewport: Viewport\r\n  scene: RenderScene\r\n\r\n  constructor (scene: RenderScene, viewport: Viewport) {\r\n    this.viewport = viewport\r\n\r\n    this.scene = scene\r\n    this.renderer = new THREE.WebGLRenderer({\r\n      canvas: viewport.canvas,\r\n      antialias: true,\r\n      precision: 'highp', // 'lowp', 'mediump', 'highp'\r\n      alpha: true,\r\n      stencil: false,\r\n      powerPreference: 'high-performance',\r\n      logarithmicDepthBuffer: true\r\n    })\r\n\r\n    this.fitViewport()\r\n    this.viewport.onResize(() => this.fitViewport())\r\n\r\n    this.renderer.setPixelRatio(window.devicePixelRatio)\r\n    this.renderer.shadowMap.enabled = false\r\n  }\r\n\r\n  dispose () {\r\n    this.clear()\r\n\r\n    this.renderer.clear()\r\n    this.renderer.forceContextLoss()\r\n    this.renderer.dispose()\r\n    this.renderer = undefined\r\n  }\r\n\r\n  /**\r\n   * Returns the bounding sphere encompasing all rendererd objects.\r\n   * @param target sphere in which to copy result, a new instance is created if undefined.\r\n   */\r\n  getBoundingSphere (target: THREE.Sphere = new THREE.Sphere()) {\r\n    return this.scene.getBoundingSphere(target)\r\n  }\r\n\r\n  /**\r\n   * Returns the bounding box encompasing all rendererd objects.\r\n   * @param target box in which to copy result, a new instance is created if undefined.\r\n   */\r\n  getBoundingBox (target: THREE.Box3 = new THREE.Box3()) {\r\n    return this.scene.getBoundingBox(target)\r\n  }\r\n\r\n  /**\r\n   * Render what is in camera.\r\n   */\r\n  render (camera: THREE.Camera) {\r\n    this.renderer.render(this.scene.scene, camera)\r\n  }\r\n\r\n  /**\r\n   * Add object to be rendered\r\n   */\r\n  add (target: Scene | THREE.Object3D) {\r\n    this.scene.add(target)\r\n  }\r\n\r\n  /**\r\n   * Remove object from rendering\r\n   */\r\n  remove (target: Scene | THREE.Object3D) {\r\n    this.scene.remove(target)\r\n  }\r\n\r\n  /**\r\n   * Removes all rendered objects\r\n   */\r\n  clear () {\r\n    this.scene.clear()\r\n  }\r\n\r\n  private fitViewport = () => {\r\n    const [width, height] = this.viewport.getParentSize()\r\n    this.renderer.setSize(width, height)\r\n  }\r\n}\r\n","/**\r\n * @module viw-webgl-viewer\r\n */\r\n\r\nimport * as THREE from 'three'\r\nimport { Object } from '../vim-loader/object'\r\nimport { Vim } from '../vim-loader/vim'\r\nimport { RenderScene } from './renderScene'\r\nimport { Viewport } from './viewport'\r\nimport { Camera } from './camera'\r\n\r\ntype ThreeIntersectionList = THREE.Intersection<THREE.Object3D<THREE.Event>>[]\r\n\r\n/**\r\n * Highlevel aggregate of information about a raycast result\r\n */\r\nexport class RaycastResult {\r\n  mousePosition: THREE.Vector2\r\n  doubleClick: boolean\r\n  object: Object\r\n  intersections: ThreeIntersectionList\r\n  firstHit: THREE.Intersection\r\n\r\n  constructor (\r\n    mousePosition: THREE.Vector2,\r\n    intersections: ThreeIntersectionList\r\n  ) {\r\n    this.mousePosition = mousePosition\r\n    this.intersections = intersections\r\n    const [hit, obj] = this.GetFirstVimHit(intersections)\r\n    this.firstHit = hit\r\n    this.object = obj\r\n  }\r\n\r\n  private GetFirstVimHit (\r\n    intersections: ThreeIntersectionList\r\n  ): [THREE.Intersection, Object] {\r\n    for (let i = 0; i < intersections.length; i++) {\r\n      const obj = this.getVimObjectFromHit(intersections[i])\r\n      if (obj?.visible) return [intersections[i], obj]\r\n    }\r\n    return [undefined, undefined]\r\n  }\r\n\r\n  private getVimObjectFromHit (hit: THREE.Intersection) {\r\n    const vim = hit.object.userData.vim as Vim\r\n    if (!vim) return\r\n\r\n    if (hit.object.userData.merged) {\r\n      const index = this.binarySearch(\r\n        hit.object.userData.submeshes,\r\n        hit.faceIndex * 3\r\n      )\r\n      const instance = hit.object.userData.instances[index]\r\n      return vim.getObjectFromInstance(instance)\r\n    } else if (hit.instanceId !== undefined) {\r\n      return vim.getObjectFromMesh(\r\n        hit.object as THREE.InstancedMesh,\r\n        hit.instanceId\r\n      )\r\n    }\r\n  }\r\n\r\n  private binarySearch (array: number[], element: number) {\r\n    let m = 0\r\n    let n = array.length - 1\r\n    while (m <= n) {\r\n      const k = (n + m) >> 1\r\n      const cmp = element - array[k]\r\n      if (cmp > 0) {\r\n        m = k + 1\r\n      } else if (cmp < 0) {\r\n        n = k - 1\r\n      } else {\r\n        return k\r\n      }\r\n    }\r\n    return m - 1\r\n  }\r\n\r\n  // Convenience functions and mnemonics\r\n  get isHit (): boolean {\r\n    return !!this.firstHit\r\n  }\r\n\r\n  get distance (): number {\r\n    return this.firstHit.distance\r\n  }\r\n\r\n  get position (): THREE.Vector3 {\r\n    return this.firstHit.point\r\n  }\r\n\r\n  get threeId (): number {\r\n    return this.firstHit.object.id\r\n  }\r\n\r\n  get faceIndex (): number {\r\n    return this.firstHit.faceIndex\r\n  }\r\n}\r\n\r\nexport class Raycaster {\r\n  private _viewport: Viewport\r\n  private _camera: Camera\r\n  private _scene: RenderScene\r\n\r\n  private _raycaster = new THREE.Raycaster()\r\n\r\n  constructor (viewport: Viewport, camera: Camera, scene: RenderScene) {\r\n    this._viewport = viewport\r\n    this._camera = camera\r\n    this._scene = scene\r\n  }\r\n\r\n  /**\r\n   * Raycast projecting a ray from camera position to screen position\r\n   */\r\n  screenRaycast (position: THREE.Vector2): RaycastResult {\r\n    console.time('raycast')\r\n    const intersections = this.raycast(position)\r\n    console.timeEnd('raycast')\r\n    const r = new RaycastResult(position, intersections)\r\n\r\n    const hit = r.firstHit\r\n\r\n    if (hit) {\r\n      const vim = hit.object.userData.vim as Vim\r\n\r\n      // Merged meshes have g3d intance index of each face encoded in uvs\r\n      if (hit.object.userData.merged && hit.uv !== undefined) {\r\n        const instance = Math.round(hit.uv.x)\r\n        r.object = vim.getObjectFromInstance(instance)\r\n      } else if (hit.instanceId !== undefined) {\r\n        r.object = vim.getObjectFromMesh(\r\n          hit.object as THREE.InstancedMesh,\r\n          hit.instanceId\r\n        )\r\n      }\r\n    }\r\n    return r\r\n  }\r\n\r\n  private raycast (position: THREE.Vector2): ThreeIntersectionList {\r\n    const [width, height] = this._viewport.getSize()\r\n    const x = (position.x / width) * 2 - 1\r\n    const y = -(position.y / height) * 2 + 1\r\n    this._raycaster.setFromCamera(new THREE.Vector2(x, y), this._camera.camera)\r\n    return this._raycaster.intersectObjects(this._scene.scene.children)\r\n  }\r\n}\r\n","/**\r\n * @module viw-webgl-viewer\r\n */\r\n\r\nimport * as THREE from 'three'\r\nimport { MathUtils } from 'three'\r\nimport { Renderer } from './renderer'\r\nimport { Camera } from './camera'\r\nimport { ViewerSettings } from './viewerSettings'\r\n\r\n/**\r\n * Manages the camera target gizmo\r\n */\r\nexport class CameraGizmo {\r\n  // Dependencies\r\n  private _renderer: Renderer\r\n  private _camera: Camera\r\n\r\n  // Settings\r\n  private _size: number = 0.01\r\n  private _fov: number = 50\r\n  private _color: THREE.Color = new THREE.Color('blue')\r\n  private _opacity: number\r\n  private _opacityAlways: number\r\n  private _fadeDurationMs: number = 200\r\n  private _showDurationMs: number = 1000\r\n\r\n  // Resources\r\n  private _box: THREE.BufferGeometry\r\n  private _wireframe: THREE.BufferGeometry\r\n  private _material: THREE.LineBasicMaterial\r\n  private _materialAlways: THREE.LineBasicMaterial\r\n  private _gizmos: THREE.Group\r\n\r\n  // State\r\n  private _timeout: ReturnType<typeof setTimeout>\r\n  private _fadeEnd: number\r\n  private _active: boolean\r\n\r\n  constructor (renderer: Renderer, camera: Camera, settings: ViewerSettings) {\r\n    this._renderer = renderer\r\n    this._camera = camera\r\n    this.applySettings(settings)\r\n  }\r\n\r\n  dispose () {\r\n    clearTimeout(this._timeout)\r\n\r\n    this._box.dispose()\r\n    this._wireframe.dispose()\r\n    this._material.dispose()\r\n    this._materialAlways.dispose()\r\n    this._box = undefined\r\n    this._wireframe = undefined\r\n    this._material = undefined\r\n    this._materialAlways = undefined\r\n\r\n    this._renderer.remove(this._gizmos)\r\n    this._gizmos = undefined\r\n  }\r\n\r\n  show (show: boolean = true) {\r\n    if (!this._active) return\r\n\r\n    if (!this._gizmos) {\r\n      this.createGizmo()\r\n    }\r\n\r\n    clearTimeout(this._timeout)\r\n    this._gizmos.visible = show\r\n    // Hide after one second since last request\r\n    if (show) {\r\n      this._timeout = setTimeout(() => this.fadeOut(), this._showDurationMs)\r\n    }\r\n  }\r\n\r\n  fadeOut (fading?: boolean) {\r\n    const now = new Date().getTime()\r\n\r\n    if (!fading) {\r\n      this._fadeEnd = now + this._fadeDurationMs\r\n    }\r\n\r\n    if (now > this._fadeEnd) {\r\n      // restore opacity values and hide for good\r\n      this._gizmos.visible = false\r\n      this._material.opacity = this._opacity\r\n      this._materialAlways.opacity = this._opacityAlways\r\n    } else {\r\n      // lerp and loop until fade is over\r\n      requestAnimationFrame(() => this.fadeOut(true))\r\n      const t = Math.pow((this._fadeEnd - now) / this._fadeDurationMs, 4)\r\n      this._material.opacity = MathUtils.lerp(0, this._opacity, t)\r\n      this._materialAlways.opacity = MathUtils.lerp(0, this._opacityAlways, t)\r\n    }\r\n  }\r\n\r\n  setPosition (position: THREE.Vector3) {\r\n    if (!this._gizmos) return\r\n    this._gizmos.position.copy(position)\r\n    this.updateScale()\r\n  }\r\n\r\n  setSize (size: number) {\r\n    this._size = size\r\n  }\r\n\r\n  setOpacity (opacity: number, opacityAlways: number) {\r\n    this._opacity = opacity\r\n    this._opacityAlways = opacityAlways\r\n    if (!this._gizmos) return\r\n    this._material.opacity = opacity\r\n    this._materialAlways.opacity = opacityAlways\r\n  }\r\n\r\n  setColor (color: THREE.Color) {\r\n    this._color = color\r\n    if (!this._gizmos) return\r\n    this._material.color = color\r\n    this._materialAlways.color = color\r\n  }\r\n\r\n  applySettings (settings: ViewerSettings) {\r\n    this._active = settings.getCameraGizmoEnable()\r\n    this._fov = settings.getCameraFov()\r\n    this.setColor(settings.getCameraGizmoColor())\r\n    this.setSize(settings.getCameraGizmoSize())\r\n    this.setOpacity(\r\n      settings.getCameraGizmoOpacity(),\r\n      settings.getCameraGizmoOpacityAlways()\r\n    )\r\n  }\r\n\r\n  private updateScale () {\r\n    const dist = this._camera.camera.position\r\n      .clone()\r\n      .distanceTo(this._gizmos.position)\r\n    // computes scale such that gizmo screen size remains constant\r\n    const h = dist * Math.tan(MathUtils.degToRad(this._fov) * this._size)\r\n    this._gizmos?.scale.set(h, h, h)\r\n  }\r\n\r\n  private createGizmo () {\r\n    this._box = new THREE.SphereGeometry(1)\r\n    this._wireframe = new THREE.WireframeGeometry(this._box)\r\n\r\n    this._material = new THREE.LineBasicMaterial({\r\n      depthTest: true,\r\n      opacity: this._opacity,\r\n      color: this._color,\r\n      transparent: true\r\n    })\r\n    this._materialAlways = new THREE.LineBasicMaterial({\r\n      depthTest: false,\r\n      opacity: this._opacityAlways,\r\n      color: this._color,\r\n      transparent: true\r\n    })\r\n\r\n    // Add to scene as group\r\n    this._gizmos = new THREE.Group()\r\n    this._gizmos.add(new THREE.LineSegments(this._wireframe, this._material))\r\n    this._gizmos.add(\r\n      new THREE.LineSegments(this._wireframe, this._materialAlways)\r\n    )\r\n    this._renderer.add(this._gizmos)\r\n    this.updateScale()\r\n  }\r\n}\r\n","/**\r\n * @module vim-loader\r\n */\r\n\r\nimport * as THREE from 'three'\r\nimport { G3d } from './g3d'\r\n\r\nexport namespace Transparency {\r\n  /**\r\n   * Determines how to draw (or not) transparent and opaque objects\r\n   */\r\n  export type Mode = 'opaqueOnly' | 'transparentOnly' | 'allAsOpaque' | 'all'\r\n\r\n  /**\r\n   * Returns true if the transparency mode is one of the valid values\r\n   */\r\n  export function isValid (value: string): value is Mode {\r\n    return ['all', 'opaqueOnly', 'transparentOnly', 'allAsOpaque'].includes(\r\n      value\r\n    )\r\n  }\r\n\r\n  /**\r\n   * Returns true if the transparency mode requires to use RGBA colors\r\n   */\r\n  export function requiresAlpha (mode: Mode) {\r\n    return mode === 'all' || mode === 'transparentOnly'\r\n  }\r\n\r\n  /**\r\n   * Returns true if the transparency mode requires using meshes of given opacity\r\n   */\r\n  export function match (mode: Mode, transparent: boolean) {\r\n    return (\r\n      mode === 'allAsOpaque' ||\r\n      mode === 'all' ||\r\n      (!transparent && mode === 'opaqueOnly') ||\r\n      (transparent && mode === 'transparentOnly')\r\n    )\r\n  }\r\n}\r\n\r\nexport namespace Geometry {\r\n  /**\r\n   * Creates a BufferGeometry with all given instances merged\r\n   * @param instances indices of the instances from the g3d to merge\r\n   * @returns a BufferGeometry\r\n   */\r\n  export function createGeometryFromInstances (g3d: G3d, instances: number[]) {\r\n    const merger = Merger.createFromInstances(g3d, instances, 'all')\r\n    return merger.toBufferGeometry()\r\n  }\r\n\r\n  /**\r\n   * Creates a BufferGeometry from a given mesh index in the g3d\r\n   * @param mesh g3d mesh index\r\n   * @param useAlpha specify to use RGB or RGBA for colors\r\n   */\r\n  export function createGeometryFromMesh (\r\n    g3d: G3d,\r\n    mesh: number,\r\n    useAlpha: boolean\r\n  ): THREE.BufferGeometry {\r\n    const colors = createVertexColors(g3d, mesh, useAlpha)\r\n\r\n    return createGeometryFromArrays(\r\n      g3d.positions.subarray(\r\n        g3d.getMeshVertexStart(mesh) * 3,\r\n        g3d.getMeshVertexEnd(mesh) * 3\r\n      ),\r\n      g3d.indices.subarray(\r\n        g3d.getMeshIndexStart(mesh),\r\n        g3d.getMeshIndexEnd(mesh)\r\n      ),\r\n      colors,\r\n      useAlpha ? 4 : 3\r\n    )\r\n  }\r\n  /**\r\n   * Expands submesh colors into vertex colors as RGB or RGBA\r\n   */\r\n  function createVertexColors (\r\n    g3d: G3d,\r\n    mesh: number,\r\n    useAlpha: boolean\r\n  ): Float32Array {\r\n    const colorSize = useAlpha ? 4 : 3\r\n    const result = new Float32Array(g3d.getMeshVertexCount(mesh) * colorSize)\r\n\r\n    const subStart = g3d.getMeshSubmeshStart(mesh)\r\n    const subEnd = g3d.getMeshSubmeshEnd(mesh)\r\n\r\n    for (let submesh = subStart; submesh < subEnd; submesh++) {\r\n      const color = g3d.getSubmeshColor(submesh)\r\n      const start = g3d.getSubmeshIndexStart(submesh)\r\n      const end = g3d.getSubmeshIndexEnd(submesh)\r\n\r\n      for (let i = start; i < end; i++) {\r\n        const v = g3d.indices[i] * colorSize\r\n        result[v] = color[0]\r\n        result[v + 1] = color[1]\r\n        result[v + 2] = color[2]\r\n        if (useAlpha) result[v + 3] = color[3]\r\n      }\r\n    }\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * Helper to merge many instances/meshes from a g3d direcly into a BufferGeometry\r\n   */\r\n  export class Merger {\r\n    private _g3d: G3d\r\n    private _colorSize: number\r\n\r\n    private _meshes: number[]\r\n    private _indices: Uint32Array\r\n    private _vertices: Float32Array\r\n    private _colors: Float32Array\r\n    private _instances: number[]\r\n    private _submeshes: number[]\r\n\r\n    constructor (\r\n      g3d: G3d,\r\n      transparency: Transparency.Mode,\r\n      instances: number[],\r\n      meshes: number[],\r\n      indexCount: number,\r\n      vertexCount: number\r\n    ) {\r\n      this._g3d = g3d\r\n      this._colorSize = Transparency.requiresAlpha(transparency) ? 4 : 3\r\n      this._instances = instances\r\n      this._meshes = meshes\r\n\r\n      // allocate all memory required for merge\r\n      this._indices = new Uint32Array(indexCount)\r\n      this._vertices = new Float32Array(vertexCount * this._g3d.POSITION_SIZE)\r\n      this._colors = new Float32Array(vertexCount * this._colorSize)\r\n      this._submeshes = new Array(this._instances.length)\r\n    }\r\n\r\n    getInstances = () => this._instances\r\n    getSubmeshes = () => this._submeshes\r\n\r\n    /**\r\n     * Prepares a merge of all meshes referenced by only one instance.\r\n     */\r\n    static createFromUniqueMeshes (g3d: G3d, transparency: Transparency.Mode) {\r\n      let vertexCount = 0\r\n      let indexCount = 0\r\n      const instances = []\r\n      const meshes = []\r\n\r\n      const meshCount = g3d.getMeshCount()\r\n      for (let mesh = 0; mesh < meshCount; mesh++) {\r\n        const meshInstances = g3d.meshInstances[mesh]\r\n        if (!meshInstances || meshInstances.length !== 1) continue\r\n        if (!Transparency.match(transparency, g3d.meshTransparent[mesh])) {\r\n          continue\r\n        }\r\n\r\n        vertexCount += g3d.getMeshVertexCount(mesh)\r\n        indexCount += g3d.getMeshIndexCount(mesh)\r\n        instances.push(meshInstances[0])\r\n        meshes.push(mesh)\r\n      }\r\n      return new Merger(\r\n        g3d,\r\n        transparency,\r\n        instances,\r\n        meshes,\r\n        indexCount,\r\n        vertexCount\r\n      )\r\n    }\r\n\r\n    /**\r\n     * Prepares a merge of all meshes referenced by given instances.\r\n     */\r\n    static createFromInstances (\r\n      g3d: G3d,\r\n      instances: number[],\r\n      transparency: Transparency.Mode\r\n    ) {\r\n      let vertexCount = 0\r\n      let indexCount = 0\r\n      const instancesFiltered = []\r\n      const meshes = []\r\n      for (let i = 0; i < instances.length; i++) {\r\n        const instance = instances[i]\r\n        const mesh = g3d.instanceMeshes[instance]\r\n        if (mesh < 0) continue\r\n        if (!Transparency.match(transparency, g3d.meshTransparent[mesh])) {\r\n          continue\r\n        }\r\n\r\n        vertexCount += g3d.getMeshVertexCount(mesh)\r\n        indexCount += g3d.getMeshIndexCount(mesh)\r\n        instancesFiltered.push(instance)\r\n        meshes.push(mesh)\r\n      }\r\n\r\n      return new Merger(\r\n        g3d,\r\n        transparency,\r\n        instancesFiltered,\r\n        meshes,\r\n        indexCount,\r\n        vertexCount\r\n      )\r\n    }\r\n\r\n    /**\r\n     * Concatenates the arrays of each of the (instance,matrix) pairs into large arrays\r\n     * Vertex position is transformed with the relevent matrix at it is copied\r\n     * Index is offset to match the vertices in the concatenated vertex buffer\r\n     * Color is expanded from submehes to vertex color into a concatenated array\r\n     * Returns a BufferGeometry from the concatenated array\r\n     */\r\n    private merge () {\r\n      let index = 0\r\n      let vertex = 0\r\n      let offset = 0\r\n\r\n      // matrix and vector is reused to avoid needless allocations\r\n      const matrix = new THREE.Matrix4()\r\n      const vector = new THREE.Vector3()\r\n\r\n      for (let i = 0; i < this._instances.length; i++) {\r\n        const mesh = this._meshes[i]\r\n        const instance = this._instances[i]\r\n        this._submeshes[i] = index\r\n\r\n        // Copy all indices to merge array\r\n        const indexStart = this._g3d.getMeshIndexStart(mesh)\r\n        const indexEnd = this._g3d.getMeshIndexEnd(mesh)\r\n        for (let i = indexStart; i < indexEnd; i++) {\r\n          this._indices[index++] = this._g3d.indices[i] + offset\r\n        }\r\n\r\n        // Copy all colors to merged array\r\n        const subStart = this._g3d.getMeshSubmeshStart(mesh)\r\n        const subEnd = this._g3d.getMeshSubmeshEnd(mesh)\r\n        for (let sub = subStart; sub < subEnd; sub++) {\r\n          const startIndex = this._g3d.getSubmeshIndexStart(sub)\r\n          const endIndex = this._g3d.getSubmeshIndexEnd(sub)\r\n\r\n          const subColor = this._g3d.getSubmeshColor(sub)\r\n          for (let i = startIndex; i < endIndex; i++) {\r\n            const v = (this._g3d.indices[i] + offset) * this._colorSize\r\n            this._colors[v] = subColor[0]\r\n            this._colors[v + 1] = subColor[1]\r\n            this._colors[v + 2] = subColor[2]\r\n            if (this._colorSize > 3) {\r\n              this._colors[v + 3] = subColor[3]\r\n            }\r\n          }\r\n        }\r\n\r\n        // Apply Matrices and copy vertices to merged array\r\n        getInstanceMatrix(this._g3d, instance, matrix)\r\n        const vertexStart = this._g3d.getMeshVertexStart(mesh)\r\n        const vertexEnd = this._g3d.getMeshVertexEnd(mesh)\r\n\r\n        for (let p = vertexStart; p < vertexEnd; p++) {\r\n          vector.fromArray(this._g3d.positions, p * this._g3d.POSITION_SIZE)\r\n          vector.applyMatrix4(matrix)\r\n          vector.toArray(this._vertices, vertex)\r\n\r\n          vertex += this._g3d.POSITION_SIZE\r\n        }\r\n\r\n        // Keep offset for next mesh\r\n        offset += vertexEnd - vertexStart\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Runs the merge process and return the resulting BufferGeometry\r\n     */\r\n    toBufferGeometry () {\r\n      this.merge()\r\n\r\n      const geometry = createGeometryFromArrays(\r\n        this._vertices,\r\n        this._indices,\r\n        this._colors,\r\n        this._colorSize\r\n      )\r\n      return geometry\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a BufferGeometry from given geometry data arrays\r\n   * @param vertices vertex data with 3 number per vertex (XYZ)\r\n   * @param indices index data with 3 indices per face\r\n   * @param vertexColors color data with 3 or 4 number per vertex. RBG or RGBA\r\n   * @param colorSize specify whether to treat colors as RGB or RGBA\r\n   * @returns a BufferGeometry\r\n   */\r\n  export function createGeometryFromArrays (\r\n    vertices: Float32Array,\r\n    indices: Uint32Array,\r\n    vertexColors: Float32Array | undefined = undefined,\r\n    colorSize: number = 3\r\n  ): THREE.BufferGeometry {\r\n    const geometry = new THREE.BufferGeometry()\r\n\r\n    // Vertices\r\n    geometry.setAttribute('position', new THREE.BufferAttribute(vertices, 3))\r\n\r\n    // Indices\r\n    geometry.setIndex(new THREE.Uint32BufferAttribute(indices, 1))\r\n\r\n    // Colors with alpha if transparent\r\n    if (vertexColors) {\r\n      geometry.setAttribute(\r\n        'color',\r\n        new THREE.BufferAttribute(vertexColors, colorSize)\r\n      )\r\n    }\r\n\r\n    return geometry\r\n  }\r\n\r\n  /**\r\n   * Returns a THREE.Matrix4 from the g3d for given instance\r\n   * @param instance g3d instance index\r\n   * @param target matrix where the data will be copied, a new matrix will be created if none provided.\r\n   */\r\n  export function getInstanceMatrix (\r\n    g3d: G3d,\r\n    instance: number,\r\n    target: THREE.Matrix4 = new THREE.Matrix4()\r\n  ): THREE.Matrix4 {\r\n    const matrixAsArray = g3d.getInstanceMatrix(instance)\r\n    target.fromArray(matrixAsArray)\r\n    return target\r\n  }\r\n}\r\n","/**\r\n * @module vim-loader\r\n */\r\n\r\nimport * as THREE from 'three'\r\n\r\nexport namespace Materials {\r\n  /**\r\n   * Defines the materials to be used by the vim loader and allows for material injection.\r\n   */\r\n  export class Library {\r\n    opaque: THREE.Material\r\n    transparent: THREE.Material | undefined\r\n    wireframe: THREE.LineBasicMaterial | undefined\r\n\r\n    constructor (\r\n      opaque?: THREE.Material,\r\n      transparent?: THREE.Material,\r\n      wireframe?: THREE.LineBasicMaterial\r\n    ) {\r\n      this.opaque = opaque ?? createOpaque()\r\n      this.transparent = transparent ?? createTransparent()\r\n      this.wireframe = wireframe ?? createWireframe()\r\n    }\r\n\r\n    dispose () {\r\n      this.opaque.dispose()\r\n      this.transparent.dispose()\r\n      this.wireframe.dispose()\r\n\r\n      this.opaque = undefined\r\n      this.transparent = undefined\r\n      this.wireframe = undefined\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a non-custom instance of phong material as used by the vim loader\r\n   * @returns a THREE.MeshPhongMaterial\r\n   */\r\n  export function createBase () {\r\n    return new THREE.MeshPhongMaterial({\r\n      color: 0x999999,\r\n      vertexColors: true,\r\n      flatShading: true,\r\n      side: THREE.DoubleSide,\r\n      shininess: 70\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of the default opaque material used by the vim-loader\r\n   * @returns a THREE.MeshPhongMaterial\r\n   */\r\n  export function createOpaque () {\r\n    const mat = createBase()\r\n    patchMaterial(mat)\r\n    return mat\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of the default loader transparent material\r\n   * @returns a THREE.MeshPhongMaterial\r\n   */\r\n  export function createTransparent () {\r\n    const mat = createBase()\r\n    mat.transparent = true\r\n    patchMaterial(mat)\r\n    return mat\r\n  }\r\n\r\n  /**\r\n   * Adds feature to default three material to support color change.\r\n   * Developed and tested for Phong material, but might work for other materials.\r\n   */\r\n  export function patchMaterial (material: THREE.Material) {\r\n    material.onBeforeCompile = (shader) => {\r\n      patchShader(shader)\r\n      material.userData.shader = shader\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Patches phong shader to be able to control when lighting should be applied to resulting color.\r\n   * Instanced meshes ignore light when InstanceColor is defined\r\n   * Instanced meshes ignore vertex color when instance attribute useVertexColor is 0\r\n   * Regular meshes ignore light in favor of vertex color when uv.y = 0\r\n   */\r\n  export function patchShader (shader: THREE.Shader) {\r\n    shader.vertexShader = shader.vertexShader\r\n      // Adding declarations for attributes and varying for visibility and coloring.\r\n      .replace(\r\n        '#include <color_pars_vertex>',\r\n        `\r\n        #include <color_pars_vertex>\r\n        \r\n        // COLORING\r\n\r\n        // attribute for color override\r\n        // merged meshes use it as vertex attribute\r\n        // instanced meshes use it as an instance attribute\r\n        attribute float colored;\r\n\r\n        // There seems to be an issue where setting mehs.instanceColor\r\n        // doesn't properly set USE_INSTANCING_COLOR\r\n        // so we always use it as a fix\r\n        #ifndef USE_INSTANCING_COLOR\r\n        attribute vec3 instanceColor;\r\n        #endif\r\n\r\n        // Passed to fragment to ignore phong model\r\n        varying float vColored;\r\n        \r\n        // VISIBILITY\r\n\r\n        // Instance or vertex attribute to hide objects \r\n        #ifdef USE_INSTANCING\r\n          attribute float ignoreInstance;\r\n        #else\r\n          attribute float ignoreVertex;\r\n        #endif\r\n\r\n        // Passed to fragment to discard them\r\n        varying float vIgnore;\r\n\r\n        `\r\n      )\r\n      // Adding vertex shader logic for visility and coloring\r\n      .replace(\r\n        '#include <color_vertex>',\r\n        `\r\n          vColor = color;\r\n          vColored = colored;\r\n\r\n          // COLORING\r\n\r\n          // colored == 1 -> instance color\r\n          // colored == 0 -> vertex color\r\n          #ifdef USE_INSTANCING\r\n            vColor.xyz = colored * instanceColor.xyz + (1.0f - colored) * color.xyz;\r\n          #endif\r\n\r\n\r\n          // VISIBILITY\r\n\r\n          // Set frag ignore from instance or vertex attribute\r\n          #ifdef USE_INSTANCING\r\n            vIgnore = ignoreInstance;\r\n          #else\r\n            vIgnore = ignoreVertex;\r\n          #endif\r\n\r\n        `\r\n      )\r\n\r\n    shader.fragmentShader = shader.fragmentShader\r\n      // Adding declarations for varying defined in vertex shader\r\n      .replace(\r\n        '#include <clipping_planes_pars_fragment>',\r\n        `\r\n        #include <clipping_planes_pars_fragment>\r\n        varying float vIgnore;\r\n        varying float vColored;\r\n        `\r\n      )\r\n      // Adding fragment shader logic for visibility and coloring.\r\n      .replace(\r\n        '#include <output_fragment>',\r\n        `\r\n          // VISIBILITY\r\n          if (vIgnore > 0.0f)\r\n            discard;\r\n         \r\n          // COLORING\r\n          // vColored == 1 -> Vertex Color * light \r\n          // vColored == 0 -> Phong Color \r\n          float d = length(outgoingLight);\r\n          gl_FragColor = vec4(vColored * vColor.xyz * d + (1.0f - vColored) * outgoingLight.xyz, diffuseColor.a);\r\n        `\r\n      )\r\n    return shader\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of the default wireframe material\r\n   * @returns a THREE.LineBasicMaterial\r\n   */\r\n  export function createWireframe () {\r\n    const material = new THREE.LineBasicMaterial({\r\n      depthTest: false,\r\n      opacity: 1,\r\n      color: new THREE.Color(0x0000ff),\r\n      transparent: true\r\n    })\r\n    return material\r\n  }\r\n  let materials: Library\r\n\r\n  /**\r\n   * Get or create a singleton material library with default materials\r\n   */\r\n  export function getDefaultLibrary () {\r\n    materials = materials ?? new Library()\r\n    return materials\r\n  }\r\n\r\n  /**\r\n   * Disposes the singleton material library\r\n   */\r\n  export function dispose () {\r\n    materials.dispose()\r\n    materials = undefined\r\n  }\r\n}\r\n","/**\r\n * @module vim-loader\r\n */\r\n\r\nimport * as THREE from 'three'\r\nimport { G3d } from './g3d'\r\nimport { Geometry, Transparency } from './geometry'\r\nimport { Materials } from './materials'\r\n\r\nexport namespace Mesh {\r\n  /**\r\n   * Builds meshes from the g3d and BufferGeometry\r\n   * Allows to reuse the same material for all new built meshes\r\n   */\r\n  export class Builder {\r\n    materials: Materials.Library\r\n\r\n    constructor (materials: Materials.Library = undefined) {\r\n      this.materials = materials ?? Materials.getDefaultLibrary()\r\n    }\r\n\r\n    /**\r\n     * Creates Instanced Meshes from the g3d data\r\n     * @param transparency Specify wheter color is RBG or RGBA and whether material is opaque or transparent\r\n     * @param instances instance indices from the g3d for which meshes will be created.\r\n     *  If undefined, all multireferenced meshes will be created.\r\n     * @returns an array of THREE.InstancedMesh\r\n     */\r\n    createInstancedMeshes (\r\n      g3d: G3d,\r\n      transparency: Transparency.Mode,\r\n      instances?: number[]\r\n    ): THREE.InstancedMesh[] {\r\n      const result: THREE.InstancedMesh[] = []\r\n      const set = instances ? new Set(instances) : undefined\r\n      for (let mesh = 0; mesh < g3d.getMeshCount(); mesh++) {\r\n        let meshInstances = g3d.meshInstances[mesh]\r\n        if (!meshInstances) continue\r\n        meshInstances = set\r\n          ? meshInstances.filter((i) => set.has(i))\r\n          : meshInstances\r\n        if (meshInstances.length <= 1) continue\r\n        if (!Transparency.match(transparency, g3d.meshTransparent[mesh])) {\r\n          continue\r\n        }\r\n\r\n        const useAlpha =\r\n          Transparency.requiresAlpha(transparency) && g3d.meshTransparent[mesh]\r\n        const geometry = Geometry.createGeometryFromMesh(g3d, mesh, useAlpha)\r\n        const resultMesh = this.createInstancedMesh(\r\n          geometry,\r\n          g3d,\r\n          meshInstances,\r\n          useAlpha\r\n        )\r\n\r\n        result.push(resultMesh)\r\n      }\r\n\r\n      return result\r\n    }\r\n\r\n    /**\r\n     * Creates a InstancedMesh from g3d data and given instance indices\r\n     * @param geometry Geometry to use in the mesh\r\n     * @param instances Instance indices for which matrices will be applied to the mesh\r\n     * @param useAlpha Specify whether to use RGB or RGBA\r\n     * @returns a THREE.InstancedMesh\r\n     */\r\n    createInstancedMesh (\r\n      geometry: THREE.BufferGeometry,\r\n      g3d: G3d,\r\n      instances: number[],\r\n      useAlpha: boolean\r\n    ) {\r\n      const material = useAlpha\r\n        ? this.materials.transparent\r\n        : this.materials.opaque\r\n\r\n      const result = new THREE.InstancedMesh(\r\n        geometry,\r\n        material,\r\n        instances.length\r\n      )\r\n\r\n      for (let i = 0; i < instances.length; i++) {\r\n        const matrix = Geometry.getInstanceMatrix(g3d, instances[i])\r\n        result.setMatrixAt(i, matrix)\r\n      }\r\n      result.userData.instances = instances\r\n      return result\r\n    }\r\n\r\n    /**\r\n     * Create a merged mesh from g3d instance indices\r\n     * @param transparency Specify wheter color is RBG or RGBA and whether material is opaque or transparent\r\n     * @param instances g3d instance indices to be included in the merged mesh. All mergeable meshes if undefined.\r\n     * @returns a THREE.Mesh\r\n     */\r\n    createMergedMesh (\r\n      g3d: G3d,\r\n      transparency: Transparency.Mode,\r\n      instances?: number[]\r\n    ): THREE.Mesh {\r\n      const merger = instances\r\n        ? Geometry.Merger.createFromInstances(g3d, instances, transparency)\r\n        : Geometry.Merger.createFromUniqueMeshes(g3d, transparency)\r\n\r\n      const geometry = merger.toBufferGeometry()\r\n      const material = Transparency.requiresAlpha(transparency)\r\n        ? this.materials.transparent\r\n        : this.materials.opaque\r\n\r\n      const mesh = new THREE.Mesh(geometry, material)\r\n      mesh.userData.merged = true\r\n      mesh.userData.instances = merger.getInstances()\r\n      mesh.userData.submeshes = merger.getSubmeshes()\r\n\r\n      return mesh\r\n    }\r\n\r\n    /**\r\n     * Create a wireframe mesh from g3d instance indices\r\n     * @param instances g3d instance indices to be included in the merged mesh. All mergeable meshes if undefined.\r\n     * @returns a THREE.Mesh\r\n     */\r\n    createWireframe (g3d: G3d, instances: number[]) {\r\n      const geometry = Geometry.createGeometryFromInstances(g3d, instances)\r\n      const wireframe = new THREE.WireframeGeometry(geometry)\r\n      return new THREE.LineSegments(wireframe, this.materials.wireframe)\r\n    }\r\n  }\r\n\r\n  let defaultBuilder: Builder\r\n  export function getDefaultBuilder () {\r\n    return defaultBuilder ?? (defaultBuilder = new Builder())\r\n  }\r\n\r\n  export function dispose () {\r\n    defaultBuilder = undefined\r\n  }\r\n}\r\n","/**\r\n * @module vim-loader\r\n */\r\n\r\nimport * as THREE from 'three'\r\nimport { G3d } from './g3d'\r\nimport { Transparency } from './geometry'\r\nimport { Mesh } from './mesh'\r\nimport { Vim } from './vim'\r\n\r\n/**\r\n * A Scene regroups many THREE.Meshes\r\n * It keep tracks of the global bounding box as Meshes are added\r\n * It keeps a map from g3d instance indices to THREE.Mesh and vice versa\r\n */\r\nexport class Scene {\r\n  meshes: THREE.Mesh[] = []\r\n  boundingBox: THREE.Box3 = new THREE.Box3()\r\n  private _instanceToThreeMesh: Map<number, [THREE.Mesh, number]> = new Map()\r\n  private _threeMeshIdToInstances: Map<number, number[]> = new Map()\r\n\r\n  /**\r\n   * Returns the THREE.Mesh in which this instance is represented along with index\r\n   * For merged mesh, index refers to submesh index\r\n   * For instanced mesh, index refers to instance index.\r\n   */\r\n  getMeshFromInstance (instance: number) {\r\n    return this._instanceToThreeMesh.has(instance)\r\n      ? this._instanceToThreeMesh.get(instance)\r\n      : []\r\n  }\r\n\r\n  /**\r\n   * Returns the index of the g3d instance that from which this mesh instance was created\r\n   * @param mesh a mesh created by the vim loader\r\n   * @param index if merged mesh the index into the merged mesh, if instance mesh the instance index.\r\n   * @returns a g3d instance index.\r\n   */\r\n  getInstanceFromMesh (mesh: THREE.Mesh, index: number): number {\r\n    if (!mesh || index < 0) return -1\r\n    const instances = this._threeMeshIdToInstances.get(mesh.id)\r\n    if (!instances) return -1\r\n    return instances[index]\r\n  }\r\n\r\n  /**\r\n   * Applies given transform matrix to all THREE.Meshes and bounding box.\r\n   */\r\n  applyMatrix4 (matrix: THREE.Matrix4) {\r\n    for (let m = 0; m < this.meshes.length; m++) {\r\n      this.meshes[m].matrixAutoUpdate = false\r\n      this.meshes[m].matrix.copy(matrix)\r\n    }\r\n    this.boundingBox.applyMatrix4(matrix)\r\n  }\r\n\r\n  /**\r\n   * Sets vim index for this scene and all its THREE.Meshes.\r\n   */\r\n  setVim (vim: Vim) {\r\n    for (let m = 0; m < this.meshes.length; m++) {\r\n      this.meshes[m].userData.vim = vim\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add an instanced mesh to the Scene and recomputes fields as needed.\r\n   * @param mesh Is expected to have userData.instances = number[]\r\n   * where numbers are the indices of the g3d instances that went into creating the mesh\r\n   */\r\n  addMergedMesh (mesh: THREE.Mesh) {\r\n    const instances = mesh.userData.instances\r\n    if (!instances) {\r\n      throw new Error('Expected mesh to have userdata instances : number[]')\r\n    }\r\n\r\n    for (let i = 0; i < instances.length; i++) {\r\n      this._instanceToThreeMesh.set(instances[i], [mesh, i])\r\n    }\r\n\r\n    mesh.geometry.computeBoundingBox()\r\n    const box = mesh.geometry.boundingBox!\r\n    this.boundingBox = this.boundingBox?.union(box) ?? box.clone()\r\n\r\n    this._threeMeshIdToInstances.set(mesh.id, instances)\r\n    this.meshes.push(mesh)\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * Add an instanced mesh to the Scene and recomputes fields as needed.\r\n   * @param mesh Is expected to have userData.instances = number[]\r\n   * where numbers are the indices of the g3d instances that went into creating the mesh\r\n   */\r\n  addInstancedMesh (mesh: THREE.InstancedMesh) {\r\n    this.registerInstancedMesh(mesh)\r\n    this.meshes.push(mesh)\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * Creates a Scene from given mesh array. Keeps a reference to the array.\r\n   * @param meshes members are expected to have userData.instances = number[]\r\n   * where numbers are the indices of the g3d instances that went into creating each mesh\r\n   */\r\n  static createFromInstancedMeshes (meshes: THREE.InstancedMesh[]) {\r\n    const scene = new Scene()\r\n\r\n    for (let m = 0; m < meshes.length; m++) {\r\n      scene.registerInstancedMesh(meshes[m])\r\n    }\r\n    scene.meshes = meshes\r\n    return scene\r\n  }\r\n\r\n  private registerInstancedMesh (mesh: THREE.InstancedMesh) {\r\n    const instances = mesh.userData.instances as number[]\r\n    if (!instances || instances.length === 0) {\r\n      throw new Error(\r\n        'Expected mesh to have userdata instances : number[] with at least one member'\r\n      )\r\n    }\r\n    if (mesh.count === 0) {\r\n      throw new Error('Expected mesh to have at least one instance')\r\n    }\r\n\r\n    for (let i = 0; i < instances.length; i++) {\r\n      this._instanceToThreeMesh.set(instances[i], [mesh, i])\r\n    }\r\n    const box = this.computeIntancedMeshBoundingBox(mesh)!\r\n    this.boundingBox = this.boundingBox?.union(box) ?? box.clone()\r\n    this._threeMeshIdToInstances.set(mesh.id, instances)\r\n  }\r\n\r\n  /**\r\n   * Adds the content of other Scene to this Scene and recomputes fields as needed.\r\n   */\r\n  merge (other: Scene) {\r\n    other.meshes.forEach((mesh) => this.meshes.push(mesh))\r\n    other._instanceToThreeMesh.forEach((value, key) => {\r\n      this._instanceToThreeMesh.set(key, value)\r\n    })\r\n    other._threeMeshIdToInstances.forEach((value, key) => {\r\n      this._threeMeshIdToInstances.set(key, value)\r\n    })\r\n    this.boundingBox =\r\n      this.boundingBox?.union(other.boundingBox) ?? other.boundingBox.clone()\r\n    return this\r\n  }\r\n\r\n  dispose () {\r\n    for (let i = 0; i < this.meshes.length; i++) {\r\n      this.meshes[i].geometry.dispose()\r\n    }\r\n    this.meshes.length = 0\r\n    this._instanceToThreeMesh.clear()\r\n    this._threeMeshIdToInstances.clear()\r\n  }\r\n\r\n  /**\r\n   * Computes the bounding box around all instances in world position of an InstancedMesh.\r\n   */\r\n  private computeIntancedMeshBoundingBox (mesh: THREE.InstancedMesh) {\r\n    let result\r\n    const matrix = new THREE.Matrix4()\r\n    const box = new THREE.Box3()\r\n    mesh.geometry.computeBoundingBox()\r\n    for (let i = 0; i < mesh.count; i++) {\r\n      mesh.getMatrixAt(i, matrix)\r\n      box.copy(mesh.geometry.boundingBox!)\r\n      box.applyMatrix4(matrix)\r\n      result = result ? result.union(box) : box.clone()\r\n    }\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * Creates a new Scene from a g3d by merging mergeble meshes and instancing instantiable meshes\r\n   * @param transparency Specify whether color is RBG or RGBA and whether material is opaque or transparent\r\n   * @param instances g3d instance indices to be included in the Scene. All if undefined.\r\n   */\r\n  static createFromG3d (\r\n    g3d: G3d,\r\n    transparency: Transparency.Mode = 'all',\r\n    instances: number[] | undefined = undefined\r\n  ): Scene {\r\n    const scene = new Scene()\r\n\r\n    // Add shared geometry\r\n    const shared = Scene.createFromInstanciableMeshes(\r\n      g3d,\r\n      transparency,\r\n      instances\r\n    )\r\n    scene.merge(shared)\r\n\r\n    // Add opaque geometry\r\n    if (transparency !== 'transparentOnly') {\r\n      const opaque = Scene.createFromMergeableMeshes(\r\n        g3d,\r\n        transparency === 'allAsOpaque' ? 'allAsOpaque' : 'opaqueOnly',\r\n        instances\r\n      )\r\n      scene.merge(opaque)\r\n    }\r\n\r\n    // Add transparent geometry\r\n    if (Transparency.requiresAlpha(transparency)) {\r\n      const transparent = Scene.createFromMergeableMeshes(\r\n        g3d,\r\n        'transparentOnly',\r\n        instances\r\n      )\r\n      scene.merge(transparent)\r\n    }\r\n\r\n    return scene\r\n  }\r\n\r\n  /**\r\n   * Creates a Scene from instantiable meshes from the g3d\r\n   * @param transparency Specify whether color is RBG or RGBA and whether material is opaque or transparent\r\n   * @param instances g3d instance indices to be included in the Scene. All if undefined.\r\n   * @param builder optional builder to reuse the same materials\r\n   */\r\n  static createFromInstanciableMeshes (\r\n    g3d: G3d,\r\n    transparency: Transparency.Mode,\r\n    instances: number[] | undefined = undefined,\r\n    builder: Mesh.Builder = Mesh.getDefaultBuilder()\r\n  ) {\r\n    const meshes = builder.createInstancedMeshes(g3d, transparency, instances)\r\n    return Scene.createFromInstancedMeshes(meshes)\r\n  }\r\n\r\n  // g3d instance indices to be included in the merged mesh. All mergeable meshes if undefined.\r\n  /**\r\n   * Creates a Scene from mergeable meshes from the g3d\r\n   * @param transparency Specify whether color is RBG or RGBA and whether material is opaque or transparent\r\n   * @param instances g3d instance indices to be included in the Scene. All if undefined.\r\n   * @param builder optional builder to reuse the same materials\r\n   */\r\n  static createFromMergeableMeshes (\r\n    g3d: G3d,\r\n    transparency: Transparency.Mode,\r\n    instances: number[] | undefined = undefined,\r\n    builder: Mesh.Builder = Mesh.getDefaultBuilder()\r\n  ) {\r\n    const mesh = builder.createMergedMesh(g3d, transparency, instances)\r\n    return new Scene().addMergedMesh(mesh)\r\n  }\r\n}\r\n","import * as THREE from 'three'\r\nimport { Scene } from '../vim-loader/scene'\r\n\r\nexport class RenderScene {\r\n  scene: THREE.Scene\r\n\r\n  // state\r\n  private _scenes: Scene[] = []\r\n  private _boundingBox: THREE.Box3\r\n\r\n  constructor () {\r\n    this.scene = new THREE.Scene()\r\n  }\r\n\r\n  /**\r\n   * Returns the bounding sphere encompasing all rendererd objects.\r\n   * @param target sphere in which to copy result, a new instance is created if undefined.\r\n   */\r\n  getBoundingSphere (target: THREE.Sphere = new THREE.Sphere()) {\r\n    return this._boundingBox?.getBoundingSphere(target)\r\n  }\r\n\r\n  /**\r\n   * Returns the bounding box encompasing all rendererd objects.\r\n   * @param target box in which to copy result, a new instance is created if undefined.\r\n   */\r\n  getBoundingBox (target: THREE.Box3 = new THREE.Box3()) {\r\n    return target?.copy(this._boundingBox)\r\n  }\r\n\r\n  /**\r\n   * Add object to be rendered\r\n   */\r\n  add (target: Scene | THREE.Object3D) {\r\n    if (target instanceof Scene) {\r\n      this.addScene(target)\r\n    } else {\r\n      this.scene.add(target)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove object from rendering\r\n   */\r\n  remove (target: Scene | THREE.Object3D) {\r\n    if (target instanceof Scene) {\r\n      this.removeScene(target)\r\n    } else {\r\n      this.scene.remove(target)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes all rendered objects\r\n   */\r\n  clear () {\r\n    this.scene.clear()\r\n    this._boundingBox = undefined\r\n  }\r\n\r\n  private addScene (scene: Scene) {\r\n    this._scenes.push(scene)\r\n    scene.meshes.forEach((m) => {\r\n      this.scene.add(m)\r\n    })\r\n\r\n    // Recompute bounding box\r\n    this._boundingBox = this._boundingBox\r\n      ? this._boundingBox.union(scene.boundingBox)\r\n      : scene.boundingBox.clone()\r\n  }\r\n\r\n  private removeScene (scene: Scene) {\r\n    // Remove from array\r\n    this._scenes = this._scenes.filter((f) => f !== scene)\r\n\r\n    // Remove all meshes from three scene\r\n    for (let i = 0; i < scene.meshes.length; i++) {\r\n      this.scene.remove(scene.meshes[i])\r\n    }\r\n\r\n    // Recompute bounding box\r\n    this._boundingBox =\r\n      this._scenes.length > 0\r\n        ? this._scenes\r\n          .map((s) => s.boundingBox.clone())\r\n          .reduce((b1, b2) => b1.union(b2))\r\n        : undefined\r\n  }\r\n}\r\n","import { ViewerSettings } from './viewerSettings'\r\n\r\nexport class Viewport {\r\n  canvas: HTMLCanvasElement\r\n  private _unregisterResize: Function\r\n  private _ownedCanvas: boolean\r\n  private _resizeCallbacks: (() => void)[] = []\r\n\r\n  constructor (settings: ViewerSettings) {\r\n    const [canvas, owned] = Viewport.getOrCreateCanvas(settings.getCanvasId())\r\n    this.canvas = canvas\r\n    this._ownedCanvas = owned\r\n    this.registerResize(settings.getCanvasResizeDelay())\r\n  }\r\n\r\n  /**\r\n   * Either returns html canvas at provided Id or creates a canvas at root level\r\n   */\r\n  private static getOrCreateCanvas (\r\n    canvasId?: string\r\n  ): [HTMLCanvasElement, boolean] {\r\n    let canvas = canvasId\r\n      ? (document.getElementById(canvasId) as HTMLCanvasElement)\r\n      : undefined\r\n\r\n    if (canvas) return [canvas, false]\r\n\r\n    canvas = document.createElement('canvas')\r\n    document.body.appendChild(canvas)\r\n    return [canvas, true]\r\n  }\r\n\r\n  dispose () {\r\n    this._unregisterResize()\r\n    this._unregisterResize = undefined\r\n\r\n    if (this._ownedCanvas) this.canvas.remove()\r\n  }\r\n\r\n  /**\r\n   * Returns the pixel size of the canvas.\r\n   */\r\n  getParentSize (): [width: number, height: number] {\r\n    return [\r\n      this.canvas.parentElement.clientWidth,\r\n      this.canvas.parentElement.clientHeight\r\n    ]\r\n  }\r\n\r\n  /**\r\n   * Returns the pixel size of the canvas.\r\n   */\r\n  getSize (): [width: number, height: number] {\r\n    return [this.canvas.clientWidth, this.canvas.clientHeight]\r\n  }\r\n\r\n  getAspectRatio () {\r\n    return (\r\n      this.canvas.parentElement.clientWidth /\r\n      this.canvas.parentElement.clientHeight\r\n    )\r\n  }\r\n\r\n  onResize (callback: () => void) {\r\n    console.log('register callbakc')\r\n    this._resizeCallbacks.push(callback)\r\n  }\r\n\r\n  /**\r\n   * Set a callback for canvas resize with debouncing\r\n   * https://stackoverflow.com/questions/5825447/javascript-event-for-canvas-resize/30688151\r\n   * @param callback code to be called\r\n   * @param timeout time after the last resize before code will be called\r\n   */\r\n  private registerResize (timeout) {\r\n    let timerId\r\n    const onResize = () => {\r\n      if (timerId !== undefined) {\r\n        clearTimeout(timerId)\r\n        timerId = undefined\r\n      }\r\n      timerId = setTimeout(() => {\r\n        timerId = undefined\r\n        this._resizeCallbacks.forEach((cb) => cb())\r\n      }, timeout)\r\n    }\r\n    window.addEventListener('resize', onResize)\r\n    this._unregisterResize = () =>\r\n      window.removeEventListener('resize', onResize)\r\n  }\r\n}\r\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nexport default freeGlobal;\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nexport default root;\n","import root from './_root.js';\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nexport default Symbol;\n","import Symbol from './_Symbol.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nexport default getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nexport default objectToString;\n","import Symbol from './_Symbol.js';\nimport getRawTag from './_getRawTag.js';\nimport objectToString from './_objectToString.js';\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nexport default baseGetTag;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nexport default isObjectLike;\n","/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\nexport default isArray;\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nexport default isObject;\n","import baseGetTag from './_baseGetTag.js';\nimport isObject from './isObject.js';\n\n/** `Object#toString` result references. */\nvar asyncTag = '[object AsyncFunction]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    proxyTag = '[object Proxy]';\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  if (!isObject(value)) {\n    return false;\n  }\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 9 which returns 'object' for typed arrays and other constructors.\n  var tag = baseGetTag(value);\n  return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;\n}\n\nexport default isFunction;\n","import root from './_root.js';\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\nexport default coreJsData;\n","import coreJsData from './_coreJsData.js';\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\nexport default isMasked;\n","/** Used for built-in method references. */\nvar funcProto = Function.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to convert.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\nexport default toSource;\n","import isFunction from './isFunction.js';\nimport isMasked from './_isMasked.js';\nimport isObject from './isObject.js';\nimport toSource from './_toSource.js';\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = isFunction(value) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\nexport default baseIsNative;\n","/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\nexport default getValue;\n","import baseIsNative from './_baseIsNative.js';\nimport getValue from './_getValue.js';\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\nexport default getNative;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar WeakMap = getNative(root, 'WeakMap');\n\nexport default WeakMap;\n","import isObject from './isObject.js';\n\n/** Built-in value references. */\nvar objectCreate = Object.create;\n\n/**\n * The base implementation of `_.create` without support for assigning\n * properties to the created object.\n *\n * @private\n * @param {Object} proto The object to inherit from.\n * @returns {Object} Returns the new object.\n */\nvar baseCreate = (function() {\n  function object() {}\n  return function(proto) {\n    if (!isObject(proto)) {\n      return {};\n    }\n    if (objectCreate) {\n      return objectCreate(proto);\n    }\n    object.prototype = proto;\n    var result = new object;\n    object.prototype = undefined;\n    return result;\n  };\n}());\n\nexport default baseCreate;\n","/**\n * Copies the values of `source` to `array`.\n *\n * @private\n * @param {Array} source The array to copy values from.\n * @param {Array} [array=[]] The array to copy values to.\n * @returns {Array} Returns `array`.\n */\nfunction copyArray(source, array) {\n  var index = -1,\n      length = source.length;\n\n  array || (array = Array(length));\n  while (++index < length) {\n    array[index] = source[index];\n  }\n  return array;\n}\n\nexport default copyArray;\n","import getNative from './_getNative.js';\n\nvar defineProperty = (function() {\n  try {\n    var func = getNative(Object, 'defineProperty');\n    func({}, '', {});\n    return func;\n  } catch (e) {}\n}());\n\nexport default defineProperty;\n","/**\n * A specialized version of `_.forEach` for arrays without support for\n * iteratee shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns `array`.\n */\nfunction arrayEach(array, iteratee) {\n  var index = -1,\n      length = array == null ? 0 : array.length;\n\n  while (++index < length) {\n    if (iteratee(array[index], index, array) === false) {\n      break;\n    }\n  }\n  return array;\n}\n\nexport default arrayEach;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/** Used to detect unsigned integer values. */\nvar reIsUint = /^(?:0|[1-9]\\d*)$/;\n\n/**\n * Checks if `value` is a valid array-like index.\n *\n * @private\n * @param {*} value The value to check.\n * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.\n * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.\n */\nfunction isIndex(value, length) {\n  var type = typeof value;\n  length = length == null ? MAX_SAFE_INTEGER : length;\n\n  return !!length &&\n    (type == 'number' ||\n      (type != 'symbol' && reIsUint.test(value))) &&\n        (value > -1 && value % 1 == 0 && value < length);\n}\n\nexport default isIndex;\n","import defineProperty from './_defineProperty.js';\n\n/**\n * The base implementation of `assignValue` and `assignMergeValue` without\n * value checks.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction baseAssignValue(object, key, value) {\n  if (key == '__proto__' && defineProperty) {\n    defineProperty(object, key, {\n      'configurable': true,\n      'enumerable': true,\n      'value': value,\n      'writable': true\n    });\n  } else {\n    object[key] = value;\n  }\n}\n\nexport default baseAssignValue;\n","/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\nexport default eq;\n","import baseAssignValue from './_baseAssignValue.js';\nimport eq from './eq.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Assigns `value` to `key` of `object` if the existing value is not equivalent\n * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * for equality comparisons.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction assignValue(object, key, value) {\n  var objValue = object[key];\n  if (!(hasOwnProperty.call(object, key) && eq(objValue, value)) ||\n      (value === undefined && !(key in object))) {\n    baseAssignValue(object, key, value);\n  }\n}\n\nexport default assignValue;\n","import assignValue from './_assignValue.js';\nimport baseAssignValue from './_baseAssignValue.js';\n\n/**\n * Copies properties of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy properties from.\n * @param {Array} props The property identifiers to copy.\n * @param {Object} [object={}] The object to copy properties to.\n * @param {Function} [customizer] The function to customize copied values.\n * @returns {Object} Returns `object`.\n */\nfunction copyObject(source, props, object, customizer) {\n  var isNew = !object;\n  object || (object = {});\n\n  var index = -1,\n      length = props.length;\n\n  while (++index < length) {\n    var key = props[index];\n\n    var newValue = customizer\n      ? customizer(object[key], source[key], key, object, source)\n      : undefined;\n\n    if (newValue === undefined) {\n      newValue = source[key];\n    }\n    if (isNew) {\n      baseAssignValue(object, key, newValue);\n    } else {\n      assignValue(object, key, newValue);\n    }\n  }\n  return object;\n}\n\nexport default copyObject;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This method is loosely based on\n * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n * @example\n *\n * _.isLength(3);\n * // => true\n *\n * _.isLength(Number.MIN_VALUE);\n * // => false\n *\n * _.isLength(Infinity);\n * // => false\n *\n * _.isLength('3');\n * // => false\n */\nfunction isLength(value) {\n  return typeof value == 'number' &&\n    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\nexport default isLength;\n","import isFunction from './isFunction.js';\nimport isLength from './isLength.js';\n\n/**\n * Checks if `value` is array-like. A value is considered array-like if it's\n * not a function and has a `value.length` that's an integer greater than or\n * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n * @example\n *\n * _.isArrayLike([1, 2, 3]);\n * // => true\n *\n * _.isArrayLike(document.body.children);\n * // => true\n *\n * _.isArrayLike('abc');\n * // => true\n *\n * _.isArrayLike(_.noop);\n * // => false\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value);\n}\n\nexport default isArrayLike;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Checks if `value` is likely a prototype object.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.\n */\nfunction isPrototype(value) {\n  var Ctor = value && value.constructor,\n      proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;\n\n  return value === proto;\n}\n\nexport default isPrototype;\n","/**\n * The base implementation of `_.times` without support for iteratee shorthands\n * or max array length checks.\n *\n * @private\n * @param {number} n The number of times to invoke `iteratee`.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the array of results.\n */\nfunction baseTimes(n, iteratee) {\n  var index = -1,\n      result = Array(n);\n\n  while (++index < n) {\n    result[index] = iteratee(index);\n  }\n  return result;\n}\n\nexport default baseTimes;\n","import baseGetTag from './_baseGetTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]';\n\n/**\n * The base implementation of `_.isArguments`.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n */\nfunction baseIsArguments(value) {\n  return isObjectLike(value) && baseGetTag(value) == argsTag;\n}\n\nexport default baseIsArguments;\n","import baseIsArguments from './_baseIsArguments.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Built-in value references. */\nvar propertyIsEnumerable = objectProto.propertyIsEnumerable;\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nvar isArguments = baseIsArguments(function() { return arguments; }()) ? baseIsArguments : function(value) {\n  return isObjectLike(value) && hasOwnProperty.call(value, 'callee') &&\n    !propertyIsEnumerable.call(value, 'callee');\n};\n\nexport default isArguments;\n","/**\n * This method returns `false`.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {boolean} Returns `false`.\n * @example\n *\n * _.times(2, _.stubFalse);\n * // => [false, false]\n */\nfunction stubFalse() {\n  return false;\n}\n\nexport default stubFalse;\n","import root from './_root.js';\nimport stubFalse from './stubFalse.js';\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Built-in value references. */\nvar Buffer = moduleExports ? root.Buffer : undefined;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeIsBuffer = Buffer ? Buffer.isBuffer : undefined;\n\n/**\n * Checks if `value` is a buffer.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.\n * @example\n *\n * _.isBuffer(new Buffer(2));\n * // => true\n *\n * _.isBuffer(new Uint8Array(2));\n * // => false\n */\nvar isBuffer = nativeIsBuffer || stubFalse;\n\nexport default isBuffer;\n","import baseGetTag from './_baseGetTag.js';\nimport isLength from './isLength.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    funcTag = '[object Function]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    objectTag = '[object Object]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    weakMapTag = '[object WeakMap]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/** Used to identify `toStringTag` values of typed arrays. */\nvar typedArrayTags = {};\ntypedArrayTags[float32Tag] = typedArrayTags[float64Tag] =\ntypedArrayTags[int8Tag] = typedArrayTags[int16Tag] =\ntypedArrayTags[int32Tag] = typedArrayTags[uint8Tag] =\ntypedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] =\ntypedArrayTags[uint32Tag] = true;\ntypedArrayTags[argsTag] = typedArrayTags[arrayTag] =\ntypedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] =\ntypedArrayTags[dataViewTag] = typedArrayTags[dateTag] =\ntypedArrayTags[errorTag] = typedArrayTags[funcTag] =\ntypedArrayTags[mapTag] = typedArrayTags[numberTag] =\ntypedArrayTags[objectTag] = typedArrayTags[regexpTag] =\ntypedArrayTags[setTag] = typedArrayTags[stringTag] =\ntypedArrayTags[weakMapTag] = false;\n\n/**\n * The base implementation of `_.isTypedArray` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n */\nfunction baseIsTypedArray(value) {\n  return isObjectLike(value) &&\n    isLength(value.length) && !!typedArrayTags[baseGetTag(value)];\n}\n\nexport default baseIsTypedArray;\n","/**\n * The base implementation of `_.unary` without support for storing metadata.\n *\n * @private\n * @param {Function} func The function to cap arguments for.\n * @returns {Function} Returns the new capped function.\n */\nfunction baseUnary(func) {\n  return function(value) {\n    return func(value);\n  };\n}\n\nexport default baseUnary;\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Detect free variable `process` from Node.js. */\nvar freeProcess = moduleExports && freeGlobal.process;\n\n/** Used to access faster Node.js helpers. */\nvar nodeUtil = (function() {\n  try {\n    // Use `util.types` for Node.js 10+.\n    var types = freeModule && freeModule.require && freeModule.require('util').types;\n\n    if (types) {\n      return types;\n    }\n\n    // Legacy `process.binding('util')` for Node.js < 10.\n    return freeProcess && freeProcess.binding && freeProcess.binding('util');\n  } catch (e) {}\n}());\n\nexport default nodeUtil;\n","import baseIsTypedArray from './_baseIsTypedArray.js';\nimport baseUnary from './_baseUnary.js';\nimport nodeUtil from './_nodeUtil.js';\n\n/* Node.js helper references. */\nvar nodeIsTypedArray = nodeUtil && nodeUtil.isTypedArray;\n\n/**\n * Checks if `value` is classified as a typed array.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n * @example\n *\n * _.isTypedArray(new Uint8Array);\n * // => true\n *\n * _.isTypedArray([]);\n * // => false\n */\nvar isTypedArray = nodeIsTypedArray ? baseUnary(nodeIsTypedArray) : baseIsTypedArray;\n\nexport default isTypedArray;\n","import baseTimes from './_baseTimes.js';\nimport isArguments from './isArguments.js';\nimport isArray from './isArray.js';\nimport isBuffer from './isBuffer.js';\nimport isIndex from './_isIndex.js';\nimport isTypedArray from './isTypedArray.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Creates an array of the enumerable property names of the array-like `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @param {boolean} inherited Specify returning inherited property names.\n * @returns {Array} Returns the array of property names.\n */\nfunction arrayLikeKeys(value, inherited) {\n  var isArr = isArray(value),\n      isArg = !isArr && isArguments(value),\n      isBuff = !isArr && !isArg && isBuffer(value),\n      isType = !isArr && !isArg && !isBuff && isTypedArray(value),\n      skipIndexes = isArr || isArg || isBuff || isType,\n      result = skipIndexes ? baseTimes(value.length, String) : [],\n      length = result.length;\n\n  for (var key in value) {\n    if ((inherited || hasOwnProperty.call(value, key)) &&\n        !(skipIndexes && (\n           // Safari 9 has enumerable `arguments.length` in strict mode.\n           key == 'length' ||\n           // Node.js 0.10 has enumerable non-index properties on buffers.\n           (isBuff && (key == 'offset' || key == 'parent')) ||\n           // PhantomJS 2 has enumerable non-index properties on typed arrays.\n           (isType && (key == 'buffer' || key == 'byteLength' || key == 'byteOffset')) ||\n           // Skip index properties.\n           isIndex(key, length)\n        ))) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nexport default arrayLikeKeys;\n","/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\nexport default overArg;\n","import overArg from './_overArg.js';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeKeys = overArg(Object.keys, Object);\n\nexport default nativeKeys;\n","import isPrototype from './_isPrototype.js';\nimport nativeKeys from './_nativeKeys.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeys(object) {\n  if (!isPrototype(object)) {\n    return nativeKeys(object);\n  }\n  var result = [];\n  for (var key in Object(object)) {\n    if (hasOwnProperty.call(object, key) && key != 'constructor') {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nexport default baseKeys;\n","import arrayLikeKeys from './_arrayLikeKeys.js';\nimport baseKeys from './_baseKeys.js';\nimport isArrayLike from './isArrayLike.js';\n\n/**\n * Creates an array of the own enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects. See the\n * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n * for more details.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keys(new Foo);\n * // => ['a', 'b'] (iteration order is not guaranteed)\n *\n * _.keys('hi');\n * // => ['0', '1']\n */\nfunction keys(object) {\n  return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);\n}\n\nexport default keys;\n","/**\n * This function is like\n * [`Object.keys`](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n * except that it includes inherited enumerable properties.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction nativeKeysIn(object) {\n  var result = [];\n  if (object != null) {\n    for (var key in Object(object)) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nexport default nativeKeysIn;\n","import isObject from './isObject.js';\nimport isPrototype from './_isPrototype.js';\nimport nativeKeysIn from './_nativeKeysIn.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * The base implementation of `_.keysIn` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeysIn(object) {\n  if (!isObject(object)) {\n    return nativeKeysIn(object);\n  }\n  var isProto = isPrototype(object),\n      result = [];\n\n  for (var key in object) {\n    if (!(key == 'constructor' && (isProto || !hasOwnProperty.call(object, key)))) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nexport default baseKeysIn;\n","import arrayLikeKeys from './_arrayLikeKeys.js';\nimport baseKeysIn from './_baseKeysIn.js';\nimport isArrayLike from './isArrayLike.js';\n\n/**\n * Creates an array of the own and inherited enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keysIn(new Foo);\n * // => ['a', 'b', 'c'] (iteration order is not guaranteed)\n */\nfunction keysIn(object) {\n  return isArrayLike(object) ? arrayLikeKeys(object, true) : baseKeysIn(object);\n}\n\nexport default keysIn;\n","import getNative from './_getNative.js';\n\n/* Built-in method references that are verified to be native. */\nvar nativeCreate = getNative(Object, 'create');\n\nexport default nativeCreate;\n","import nativeCreate from './_nativeCreate.js';\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n  this.size = 0;\n}\n\nexport default hashClear;\n","/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  var result = this.has(key) && delete this.__data__[key];\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\nexport default hashDelete;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\nexport default hashGet;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? (data[key] !== undefined) : hasOwnProperty.call(data, key);\n}\n\nexport default hashHas;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  this.size += this.has(key) ? 0 : 1;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\nexport default hashSet;\n","import hashClear from './_hashClear.js';\nimport hashDelete from './_hashDelete.js';\nimport hashGet from './_hashGet.js';\nimport hashHas from './_hashHas.js';\nimport hashSet from './_hashSet.js';\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\nexport default Hash;\n","/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n  this.size = 0;\n}\n\nexport default listCacheClear;\n","import eq from './eq.js';\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\nexport default assocIndexOf;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype;\n\n/** Built-in value references. */\nvar splice = arrayProto.splice;\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  --this.size;\n  return true;\n}\n\nexport default listCacheDelete;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\nexport default listCacheGet;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\nexport default listCacheHas;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    ++this.size;\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\nexport default listCacheSet;\n","import listCacheClear from './_listCacheClear.js';\nimport listCacheDelete from './_listCacheDelete.js';\nimport listCacheGet from './_listCacheGet.js';\nimport listCacheHas from './_listCacheHas.js';\nimport listCacheSet from './_listCacheSet.js';\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\nexport default ListCache;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Map = getNative(root, 'Map');\n\nexport default Map;\n","import Hash from './_Hash.js';\nimport ListCache from './_ListCache.js';\nimport Map from './_Map.js';\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.size = 0;\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\nexport default mapCacheClear;\n","/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\nexport default isKeyable;\n","import isKeyable from './_isKeyable.js';\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\nexport default getMapData;\n","import getMapData from './_getMapData.js';\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  var result = getMapData(this, key)['delete'](key);\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\nexport default mapCacheDelete;\n","import getMapData from './_getMapData.js';\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\nexport default mapCacheGet;\n","import getMapData from './_getMapData.js';\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\nexport default mapCacheHas;\n","import getMapData from './_getMapData.js';\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  var data = getMapData(this, key),\n      size = data.size;\n\n  data.set(key, value);\n  this.size += data.size == size ? 0 : 1;\n  return this;\n}\n\nexport default mapCacheSet;\n","import mapCacheClear from './_mapCacheClear.js';\nimport mapCacheDelete from './_mapCacheDelete.js';\nimport mapCacheGet from './_mapCacheGet.js';\nimport mapCacheHas from './_mapCacheHas.js';\nimport mapCacheSet from './_mapCacheSet.js';\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\nexport default MapCache;\n","/**\n * Appends the elements of `values` to `array`.\n *\n * @private\n * @param {Array} array The array to modify.\n * @param {Array} values The values to append.\n * @returns {Array} Returns `array`.\n */\nfunction arrayPush(array, values) {\n  var index = -1,\n      length = values.length,\n      offset = array.length;\n\n  while (++index < length) {\n    array[offset + index] = values[index];\n  }\n  return array;\n}\n\nexport default arrayPush;\n","import overArg from './_overArg.js';\n\n/** Built-in value references. */\nvar getPrototype = overArg(Object.getPrototypeOf, Object);\n\nexport default getPrototype;\n","import ListCache from './_ListCache.js';\n\n/**\n * Removes all key-value entries from the stack.\n *\n * @private\n * @name clear\n * @memberOf Stack\n */\nfunction stackClear() {\n  this.__data__ = new ListCache;\n  this.size = 0;\n}\n\nexport default stackClear;\n","/**\n * Removes `key` and its value from the stack.\n *\n * @private\n * @name delete\n * @memberOf Stack\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction stackDelete(key) {\n  var data = this.__data__,\n      result = data['delete'](key);\n\n  this.size = data.size;\n  return result;\n}\n\nexport default stackDelete;\n","/**\n * Gets the stack value for `key`.\n *\n * @private\n * @name get\n * @memberOf Stack\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction stackGet(key) {\n  return this.__data__.get(key);\n}\n\nexport default stackGet;\n","/**\n * Checks if a stack value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Stack\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction stackHas(key) {\n  return this.__data__.has(key);\n}\n\nexport default stackHas;\n","import ListCache from './_ListCache.js';\nimport Map from './_Map.js';\nimport MapCache from './_MapCache.js';\n\n/** Used as the size to enable large array optimizations. */\nvar LARGE_ARRAY_SIZE = 200;\n\n/**\n * Sets the stack `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Stack\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the stack cache instance.\n */\nfunction stackSet(key, value) {\n  var data = this.__data__;\n  if (data instanceof ListCache) {\n    var pairs = data.__data__;\n    if (!Map || (pairs.length < LARGE_ARRAY_SIZE - 1)) {\n      pairs.push([key, value]);\n      this.size = ++data.size;\n      return this;\n    }\n    data = this.__data__ = new MapCache(pairs);\n  }\n  data.set(key, value);\n  this.size = data.size;\n  return this;\n}\n\nexport default stackSet;\n","import ListCache from './_ListCache.js';\nimport stackClear from './_stackClear.js';\nimport stackDelete from './_stackDelete.js';\nimport stackGet from './_stackGet.js';\nimport stackHas from './_stackHas.js';\nimport stackSet from './_stackSet.js';\n\n/**\n * Creates a stack cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Stack(entries) {\n  var data = this.__data__ = new ListCache(entries);\n  this.size = data.size;\n}\n\n// Add methods to `Stack`.\nStack.prototype.clear = stackClear;\nStack.prototype['delete'] = stackDelete;\nStack.prototype.get = stackGet;\nStack.prototype.has = stackHas;\nStack.prototype.set = stackSet;\n\nexport default Stack;\n","import copyObject from './_copyObject.js';\nimport keys from './keys.js';\n\n/**\n * The base implementation of `_.assign` without support for multiple sources\n * or `customizer` functions.\n *\n * @private\n * @param {Object} object The destination object.\n * @param {Object} source The source object.\n * @returns {Object} Returns `object`.\n */\nfunction baseAssign(object, source) {\n  return object && copyObject(source, keys(source), object);\n}\n\nexport default baseAssign;\n","import copyObject from './_copyObject.js';\nimport keysIn from './keysIn.js';\n\n/**\n * The base implementation of `_.assignIn` without support for multiple sources\n * or `customizer` functions.\n *\n * @private\n * @param {Object} object The destination object.\n * @param {Object} source The source object.\n * @returns {Object} Returns `object`.\n */\nfunction baseAssignIn(object, source) {\n  return object && copyObject(source, keysIn(source), object);\n}\n\nexport default baseAssignIn;\n","import root from './_root.js';\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Built-in value references. */\nvar Buffer = moduleExports ? root.Buffer : undefined,\n    allocUnsafe = Buffer ? Buffer.allocUnsafe : undefined;\n\n/**\n * Creates a clone of  `buffer`.\n *\n * @private\n * @param {Buffer} buffer The buffer to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Buffer} Returns the cloned buffer.\n */\nfunction cloneBuffer(buffer, isDeep) {\n  if (isDeep) {\n    return buffer.slice();\n  }\n  var length = buffer.length,\n      result = allocUnsafe ? allocUnsafe(length) : new buffer.constructor(length);\n\n  buffer.copy(result);\n  return result;\n}\n\nexport default cloneBuffer;\n","/**\n * A specialized version of `_.filter` for arrays without support for\n * iteratee shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} predicate The function invoked per iteration.\n * @returns {Array} Returns the new filtered array.\n */\nfunction arrayFilter(array, predicate) {\n  var index = -1,\n      length = array == null ? 0 : array.length,\n      resIndex = 0,\n      result = [];\n\n  while (++index < length) {\n    var value = array[index];\n    if (predicate(value, index, array)) {\n      result[resIndex++] = value;\n    }\n  }\n  return result;\n}\n\nexport default arrayFilter;\n","/**\n * This method returns a new empty array.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {Array} Returns the new empty array.\n * @example\n *\n * var arrays = _.times(2, _.stubArray);\n *\n * console.log(arrays);\n * // => [[], []]\n *\n * console.log(arrays[0] === arrays[1]);\n * // => false\n */\nfunction stubArray() {\n  return [];\n}\n\nexport default stubArray;\n","import arrayFilter from './_arrayFilter.js';\nimport stubArray from './stubArray.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Built-in value references. */\nvar propertyIsEnumerable = objectProto.propertyIsEnumerable;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeGetSymbols = Object.getOwnPropertySymbols;\n\n/**\n * Creates an array of the own enumerable symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of symbols.\n */\nvar getSymbols = !nativeGetSymbols ? stubArray : function(object) {\n  if (object == null) {\n    return [];\n  }\n  object = Object(object);\n  return arrayFilter(nativeGetSymbols(object), function(symbol) {\n    return propertyIsEnumerable.call(object, symbol);\n  });\n};\n\nexport default getSymbols;\n","import copyObject from './_copyObject.js';\nimport getSymbols from './_getSymbols.js';\n\n/**\n * Copies own symbols of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy symbols from.\n * @param {Object} [object={}] The object to copy symbols to.\n * @returns {Object} Returns `object`.\n */\nfunction copySymbols(source, object) {\n  return copyObject(source, getSymbols(source), object);\n}\n\nexport default copySymbols;\n","import arrayPush from './_arrayPush.js';\nimport getPrototype from './_getPrototype.js';\nimport getSymbols from './_getSymbols.js';\nimport stubArray from './stubArray.js';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeGetSymbols = Object.getOwnPropertySymbols;\n\n/**\n * Creates an array of the own and inherited enumerable symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of symbols.\n */\nvar getSymbolsIn = !nativeGetSymbols ? stubArray : function(object) {\n  var result = [];\n  while (object) {\n    arrayPush(result, getSymbols(object));\n    object = getPrototype(object);\n  }\n  return result;\n};\n\nexport default getSymbolsIn;\n","import copyObject from './_copyObject.js';\nimport getSymbolsIn from './_getSymbolsIn.js';\n\n/**\n * Copies own and inherited symbols of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy symbols from.\n * @param {Object} [object={}] The object to copy symbols to.\n * @returns {Object} Returns `object`.\n */\nfunction copySymbolsIn(source, object) {\n  return copyObject(source, getSymbolsIn(source), object);\n}\n\nexport default copySymbolsIn;\n","import arrayPush from './_arrayPush.js';\nimport isArray from './isArray.js';\n\n/**\n * The base implementation of `getAllKeys` and `getAllKeysIn` which uses\n * `keysFunc` and `symbolsFunc` to get the enumerable property names and\n * symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Function} keysFunc The function to get the keys of `object`.\n * @param {Function} symbolsFunc The function to get the symbols of `object`.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction baseGetAllKeys(object, keysFunc, symbolsFunc) {\n  var result = keysFunc(object);\n  return isArray(object) ? result : arrayPush(result, symbolsFunc(object));\n}\n\nexport default baseGetAllKeys;\n","import baseGetAllKeys from './_baseGetAllKeys.js';\nimport getSymbols from './_getSymbols.js';\nimport keys from './keys.js';\n\n/**\n * Creates an array of own enumerable property names and symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction getAllKeys(object) {\n  return baseGetAllKeys(object, keys, getSymbols);\n}\n\nexport default getAllKeys;\n","import baseGetAllKeys from './_baseGetAllKeys.js';\nimport getSymbolsIn from './_getSymbolsIn.js';\nimport keysIn from './keysIn.js';\n\n/**\n * Creates an array of own and inherited enumerable property names and\n * symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction getAllKeysIn(object) {\n  return baseGetAllKeys(object, keysIn, getSymbolsIn);\n}\n\nexport default getAllKeysIn;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar DataView = getNative(root, 'DataView');\n\nexport default DataView;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Promise = getNative(root, 'Promise');\n\nexport default Promise;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Set = getNative(root, 'Set');\n\nexport default Set;\n","import DataView from './_DataView.js';\nimport Map from './_Map.js';\nimport Promise from './_Promise.js';\nimport Set from './_Set.js';\nimport WeakMap from './_WeakMap.js';\nimport baseGetTag from './_baseGetTag.js';\nimport toSource from './_toSource.js';\n\n/** `Object#toString` result references. */\nvar mapTag = '[object Map]',\n    objectTag = '[object Object]',\n    promiseTag = '[object Promise]',\n    setTag = '[object Set]',\n    weakMapTag = '[object WeakMap]';\n\nvar dataViewTag = '[object DataView]';\n\n/** Used to detect maps, sets, and weakmaps. */\nvar dataViewCtorString = toSource(DataView),\n    mapCtorString = toSource(Map),\n    promiseCtorString = toSource(Promise),\n    setCtorString = toSource(Set),\n    weakMapCtorString = toSource(WeakMap);\n\n/**\n * Gets the `toStringTag` of `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nvar getTag = baseGetTag;\n\n// Fallback for data views, maps, sets, and weak maps in IE 11 and promises in Node.js < 6.\nif ((DataView && getTag(new DataView(new ArrayBuffer(1))) != dataViewTag) ||\n    (Map && getTag(new Map) != mapTag) ||\n    (Promise && getTag(Promise.resolve()) != promiseTag) ||\n    (Set && getTag(new Set) != setTag) ||\n    (WeakMap && getTag(new WeakMap) != weakMapTag)) {\n  getTag = function(value) {\n    var result = baseGetTag(value),\n        Ctor = result == objectTag ? value.constructor : undefined,\n        ctorString = Ctor ? toSource(Ctor) : '';\n\n    if (ctorString) {\n      switch (ctorString) {\n        case dataViewCtorString: return dataViewTag;\n        case mapCtorString: return mapTag;\n        case promiseCtorString: return promiseTag;\n        case setCtorString: return setTag;\n        case weakMapCtorString: return weakMapTag;\n      }\n    }\n    return result;\n  };\n}\n\nexport default getTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Initializes an array clone.\n *\n * @private\n * @param {Array} array The array to clone.\n * @returns {Array} Returns the initialized clone.\n */\nfunction initCloneArray(array) {\n  var length = array.length,\n      result = new array.constructor(length);\n\n  // Add properties assigned by `RegExp#exec`.\n  if (length && typeof array[0] == 'string' && hasOwnProperty.call(array, 'index')) {\n    result.index = array.index;\n    result.input = array.input;\n  }\n  return result;\n}\n\nexport default initCloneArray;\n","import root from './_root.js';\n\n/** Built-in value references. */\nvar Uint8Array = root.Uint8Array;\n\nexport default Uint8Array;\n","import Uint8Array from './_Uint8Array.js';\n\n/**\n * Creates a clone of `arrayBuffer`.\n *\n * @private\n * @param {ArrayBuffer} arrayBuffer The array buffer to clone.\n * @returns {ArrayBuffer} Returns the cloned array buffer.\n */\nfunction cloneArrayBuffer(arrayBuffer) {\n  var result = new arrayBuffer.constructor(arrayBuffer.byteLength);\n  new Uint8Array(result).set(new Uint8Array(arrayBuffer));\n  return result;\n}\n\nexport default cloneArrayBuffer;\n","import cloneArrayBuffer from './_cloneArrayBuffer.js';\n\n/**\n * Creates a clone of `dataView`.\n *\n * @private\n * @param {Object} dataView The data view to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the cloned data view.\n */\nfunction cloneDataView(dataView, isDeep) {\n  var buffer = isDeep ? cloneArrayBuffer(dataView.buffer) : dataView.buffer;\n  return new dataView.constructor(buffer, dataView.byteOffset, dataView.byteLength);\n}\n\nexport default cloneDataView;\n","/** Used to match `RegExp` flags from their coerced string values. */\nvar reFlags = /\\w*$/;\n\n/**\n * Creates a clone of `regexp`.\n *\n * @private\n * @param {Object} regexp The regexp to clone.\n * @returns {Object} Returns the cloned regexp.\n */\nfunction cloneRegExp(regexp) {\n  var result = new regexp.constructor(regexp.source, reFlags.exec(regexp));\n  result.lastIndex = regexp.lastIndex;\n  return result;\n}\n\nexport default cloneRegExp;\n","import Symbol from './_Symbol.js';\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolValueOf = symbolProto ? symbolProto.valueOf : undefined;\n\n/**\n * Creates a clone of the `symbol` object.\n *\n * @private\n * @param {Object} symbol The symbol object to clone.\n * @returns {Object} Returns the cloned symbol object.\n */\nfunction cloneSymbol(symbol) {\n  return symbolValueOf ? Object(symbolValueOf.call(symbol)) : {};\n}\n\nexport default cloneSymbol;\n","import cloneArrayBuffer from './_cloneArrayBuffer.js';\n\n/**\n * Creates a clone of `typedArray`.\n *\n * @private\n * @param {Object} typedArray The typed array to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the cloned typed array.\n */\nfunction cloneTypedArray(typedArray, isDeep) {\n  var buffer = isDeep ? cloneArrayBuffer(typedArray.buffer) : typedArray.buffer;\n  return new typedArray.constructor(buffer, typedArray.byteOffset, typedArray.length);\n}\n\nexport default cloneTypedArray;\n","import cloneArrayBuffer from './_cloneArrayBuffer.js';\nimport cloneDataView from './_cloneDataView.js';\nimport cloneRegExp from './_cloneRegExp.js';\nimport cloneSymbol from './_cloneSymbol.js';\nimport cloneTypedArray from './_cloneTypedArray.js';\n\n/** `Object#toString` result references. */\nvar boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    symbolTag = '[object Symbol]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/**\n * Initializes an object clone based on its `toStringTag`.\n *\n * **Note:** This function only supports cloning values with tags of\n * `Boolean`, `Date`, `Error`, `Map`, `Number`, `RegExp`, `Set`, or `String`.\n *\n * @private\n * @param {Object} object The object to clone.\n * @param {string} tag The `toStringTag` of the object to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the initialized clone.\n */\nfunction initCloneByTag(object, tag, isDeep) {\n  var Ctor = object.constructor;\n  switch (tag) {\n    case arrayBufferTag:\n      return cloneArrayBuffer(object);\n\n    case boolTag:\n    case dateTag:\n      return new Ctor(+object);\n\n    case dataViewTag:\n      return cloneDataView(object, isDeep);\n\n    case float32Tag: case float64Tag:\n    case int8Tag: case int16Tag: case int32Tag:\n    case uint8Tag: case uint8ClampedTag: case uint16Tag: case uint32Tag:\n      return cloneTypedArray(object, isDeep);\n\n    case mapTag:\n      return new Ctor;\n\n    case numberTag:\n    case stringTag:\n      return new Ctor(object);\n\n    case regexpTag:\n      return cloneRegExp(object);\n\n    case setTag:\n      return new Ctor;\n\n    case symbolTag:\n      return cloneSymbol(object);\n  }\n}\n\nexport default initCloneByTag;\n","import baseCreate from './_baseCreate.js';\nimport getPrototype from './_getPrototype.js';\nimport isPrototype from './_isPrototype.js';\n\n/**\n * Initializes an object clone.\n *\n * @private\n * @param {Object} object The object to clone.\n * @returns {Object} Returns the initialized clone.\n */\nfunction initCloneObject(object) {\n  return (typeof object.constructor == 'function' && !isPrototype(object))\n    ? baseCreate(getPrototype(object))\n    : {};\n}\n\nexport default initCloneObject;\n","import getTag from './_getTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar mapTag = '[object Map]';\n\n/**\n * The base implementation of `_.isMap` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a map, else `false`.\n */\nfunction baseIsMap(value) {\n  return isObjectLike(value) && getTag(value) == mapTag;\n}\n\nexport default baseIsMap;\n","import baseIsMap from './_baseIsMap.js';\nimport baseUnary from './_baseUnary.js';\nimport nodeUtil from './_nodeUtil.js';\n\n/* Node.js helper references. */\nvar nodeIsMap = nodeUtil && nodeUtil.isMap;\n\n/**\n * Checks if `value` is classified as a `Map` object.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a map, else `false`.\n * @example\n *\n * _.isMap(new Map);\n * // => true\n *\n * _.isMap(new WeakMap);\n * // => false\n */\nvar isMap = nodeIsMap ? baseUnary(nodeIsMap) : baseIsMap;\n\nexport default isMap;\n","import getTag from './_getTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar setTag = '[object Set]';\n\n/**\n * The base implementation of `_.isSet` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a set, else `false`.\n */\nfunction baseIsSet(value) {\n  return isObjectLike(value) && getTag(value) == setTag;\n}\n\nexport default baseIsSet;\n","import baseIsSet from './_baseIsSet.js';\nimport baseUnary from './_baseUnary.js';\nimport nodeUtil from './_nodeUtil.js';\n\n/* Node.js helper references. */\nvar nodeIsSet = nodeUtil && nodeUtil.isSet;\n\n/**\n * Checks if `value` is classified as a `Set` object.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a set, else `false`.\n * @example\n *\n * _.isSet(new Set);\n * // => true\n *\n * _.isSet(new WeakSet);\n * // => false\n */\nvar isSet = nodeIsSet ? baseUnary(nodeIsSet) : baseIsSet;\n\nexport default isSet;\n","import Stack from './_Stack.js';\nimport arrayEach from './_arrayEach.js';\nimport assignValue from './_assignValue.js';\nimport baseAssign from './_baseAssign.js';\nimport baseAssignIn from './_baseAssignIn.js';\nimport cloneBuffer from './_cloneBuffer.js';\nimport copyArray from './_copyArray.js';\nimport copySymbols from './_copySymbols.js';\nimport copySymbolsIn from './_copySymbolsIn.js';\nimport getAllKeys from './_getAllKeys.js';\nimport getAllKeysIn from './_getAllKeysIn.js';\nimport getTag from './_getTag.js';\nimport initCloneArray from './_initCloneArray.js';\nimport initCloneByTag from './_initCloneByTag.js';\nimport initCloneObject from './_initCloneObject.js';\nimport isArray from './isArray.js';\nimport isBuffer from './isBuffer.js';\nimport isMap from './isMap.js';\nimport isObject from './isObject.js';\nimport isSet from './isSet.js';\nimport keys from './keys.js';\nimport keysIn from './keysIn.js';\n\n/** Used to compose bitmasks for cloning. */\nvar CLONE_DEEP_FLAG = 1,\n    CLONE_FLAT_FLAG = 2,\n    CLONE_SYMBOLS_FLAG = 4;\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    objectTag = '[object Object]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    symbolTag = '[object Symbol]',\n    weakMapTag = '[object WeakMap]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/** Used to identify `toStringTag` values supported by `_.clone`. */\nvar cloneableTags = {};\ncloneableTags[argsTag] = cloneableTags[arrayTag] =\ncloneableTags[arrayBufferTag] = cloneableTags[dataViewTag] =\ncloneableTags[boolTag] = cloneableTags[dateTag] =\ncloneableTags[float32Tag] = cloneableTags[float64Tag] =\ncloneableTags[int8Tag] = cloneableTags[int16Tag] =\ncloneableTags[int32Tag] = cloneableTags[mapTag] =\ncloneableTags[numberTag] = cloneableTags[objectTag] =\ncloneableTags[regexpTag] = cloneableTags[setTag] =\ncloneableTags[stringTag] = cloneableTags[symbolTag] =\ncloneableTags[uint8Tag] = cloneableTags[uint8ClampedTag] =\ncloneableTags[uint16Tag] = cloneableTags[uint32Tag] = true;\ncloneableTags[errorTag] = cloneableTags[funcTag] =\ncloneableTags[weakMapTag] = false;\n\n/**\n * The base implementation of `_.clone` and `_.cloneDeep` which tracks\n * traversed objects.\n *\n * @private\n * @param {*} value The value to clone.\n * @param {boolean} bitmask The bitmask flags.\n *  1 - Deep clone\n *  2 - Flatten inherited properties\n *  4 - Clone symbols\n * @param {Function} [customizer] The function to customize cloning.\n * @param {string} [key] The key of `value`.\n * @param {Object} [object] The parent object of `value`.\n * @param {Object} [stack] Tracks traversed objects and their clone counterparts.\n * @returns {*} Returns the cloned value.\n */\nfunction baseClone(value, bitmask, customizer, key, object, stack) {\n  var result,\n      isDeep = bitmask & CLONE_DEEP_FLAG,\n      isFlat = bitmask & CLONE_FLAT_FLAG,\n      isFull = bitmask & CLONE_SYMBOLS_FLAG;\n\n  if (customizer) {\n    result = object ? customizer(value, key, object, stack) : customizer(value);\n  }\n  if (result !== undefined) {\n    return result;\n  }\n  if (!isObject(value)) {\n    return value;\n  }\n  var isArr = isArray(value);\n  if (isArr) {\n    result = initCloneArray(value);\n    if (!isDeep) {\n      return copyArray(value, result);\n    }\n  } else {\n    var tag = getTag(value),\n        isFunc = tag == funcTag || tag == genTag;\n\n    if (isBuffer(value)) {\n      return cloneBuffer(value, isDeep);\n    }\n    if (tag == objectTag || tag == argsTag || (isFunc && !object)) {\n      result = (isFlat || isFunc) ? {} : initCloneObject(value);\n      if (!isDeep) {\n        return isFlat\n          ? copySymbolsIn(value, baseAssignIn(result, value))\n          : copySymbols(value, baseAssign(result, value));\n      }\n    } else {\n      if (!cloneableTags[tag]) {\n        return object ? value : {};\n      }\n      result = initCloneByTag(value, tag, isDeep);\n    }\n  }\n  // Check for circular references and return its corresponding clone.\n  stack || (stack = new Stack);\n  var stacked = stack.get(value);\n  if (stacked) {\n    return stacked;\n  }\n  stack.set(value, result);\n\n  if (isSet(value)) {\n    value.forEach(function(subValue) {\n      result.add(baseClone(subValue, bitmask, customizer, subValue, value, stack));\n    });\n  } else if (isMap(value)) {\n    value.forEach(function(subValue, key) {\n      result.set(key, baseClone(subValue, bitmask, customizer, key, value, stack));\n    });\n  }\n\n  var keysFunc = isFull\n    ? (isFlat ? getAllKeysIn : getAllKeys)\n    : (isFlat ? keysIn : keys);\n\n  var props = isArr ? undefined : keysFunc(value);\n  arrayEach(props || value, function(subValue, key) {\n    if (props) {\n      key = subValue;\n      subValue = value[key];\n    }\n    // Recursively populate clone (susceptible to call stack limits).\n    assignValue(result, key, baseClone(subValue, bitmask, customizer, key, value, stack));\n  });\n  return result;\n}\n\nexport default baseClone;\n","import baseClone from './_baseClone.js';\n\n/** Used to compose bitmasks for cloning. */\nvar CLONE_DEEP_FLAG = 1,\n    CLONE_SYMBOLS_FLAG = 4;\n\n/**\n * This method is like `_.clone` except that it recursively clones `value`.\n *\n * @static\n * @memberOf _\n * @since 1.0.0\n * @category Lang\n * @param {*} value The value to recursively clone.\n * @returns {*} Returns the deep cloned value.\n * @see _.clone\n * @example\n *\n * var objects = [{ 'a': 1 }, { 'b': 2 }];\n *\n * var deep = _.cloneDeep(objects);\n * console.log(deep[0] === objects[0]);\n * // => false\n */\nfunction cloneDeep(value) {\n  return baseClone(value, CLONE_DEEP_FLAG | CLONE_SYMBOLS_FLAG);\n}\n\nexport default cloneDeep;\n","/**\r\n * @module vim-loader\r\n */\r\n\r\nimport deepmerge from 'deepmerge'\r\nimport { cloneDeep } from 'lodash-es'\r\nimport { Transparency } from './geometry'\r\nimport * as THREE from 'three'\r\n\r\nexport namespace VimOptions {\r\n  export type Vector3 = {\r\n    x: number\r\n    y: number\r\n    z: number\r\n  }\r\n\r\n  /**\r\n   * Config object for loading a vim\r\n   */\r\n  export type Root = {\r\n    /**\r\n     * Position offset for the vim\r\n     */\r\n    position?: Vector3\r\n    /**\r\n     * Rotation for the vim\r\n     */\r\n    rotation?: Vector3\r\n    /**\r\n     * Scale factor for the vim\r\n     */\r\n    scale?: number\r\n\r\n    /**\r\n     * Defines how to draw or not to draw objects according to their transparency\r\n     */\r\n    transparency?: Transparency.Mode\r\n\r\n    /**\r\n     * Forces the viewer to download the whole data at once.\r\n     * Otherwise bim data will be requested on per need basis.\r\n     */\r\n    forceDownload?: boolean\r\n  }\r\n}\r\n\r\n/**\r\n * <p>Wrapper around Vim Options.</p>\r\n * <p>Casts options values into related THREE.js type</p>\r\n * <p>Provides default values for options</p>\r\n */\r\nexport class VimSettings {\r\n  private options: VimOptions.Root\r\n\r\n  constructor (options?: Partial<VimOptions.Root>) {\r\n    const fallback: VimOptions.Root = {\r\n      position: { x: 0, y: 0, z: 0 },\r\n      rotation: { x: 0, y: 0, z: 0 },\r\n      scale: 1,\r\n      transparency: 'all',\r\n      forceDownload: false\r\n    }\r\n\r\n    this.options = options ? deepmerge(fallback, options, undefined) : fallback\r\n    this.options.transparency = Transparency.isValid(this.options.transparency!)\r\n      ? this.options.transparency\r\n      : 'all'\r\n  }\r\n\r\n  getOptions = () => cloneDeep(this.options) as VimOptions.Root\r\n\r\n  getPosition = () => toVec(this.options.position)\r\n  getRotation = () => toQuaternion(this.options.rotation)\r\n  getScale = () => scalarToVec(this.options.scale)\r\n  getMatrix = () =>\r\n    new THREE.Matrix4().compose(\r\n      this.getPosition(),\r\n      this.getRotation(),\r\n      this.getScale()\r\n    )\r\n\r\n  getTransparency = () => this.options.transparency!\r\n}\r\n\r\nfunction toVec (obj: VimOptions.Vector3): THREE.Vector3 {\r\n  return new THREE.Vector3(obj.x, obj.y, obj.z)\r\n}\r\n\r\nfunction toQuaternion (rot: VimOptions.Vector3): THREE.Quaternion {\r\n  return new THREE.Quaternion().setFromEuler(toEuler(toVec(rot)))\r\n}\r\n\r\nfunction scalarToVec (x: number): THREE.Vector3 {\r\n  return new THREE.Vector3(x, x, x)\r\n}\r\n\r\nfunction toEuler (rot: THREE.Vector3): THREE.Euler {\r\n  return new THREE.Euler(\r\n    (rot.x * Math.PI) / 180,\r\n    (rot.y * Math.PI) / 180,\r\n    (rot.z * Math.PI) / 180\r\n  )\r\n}\r\n","/**\r\n * @module vim-loader\r\n */\r\n\r\nimport { BFast } from './bfast'\r\n\r\nclass G3dAttributeDescriptor {\r\n  // original descriptor string\r\n  description: string\r\n  // Indicates the part of the geometry that this attribute is associated with\r\n  association: string\r\n  // the role of the attribute\r\n  semantic: string\r\n  // each attribute type should have it's own index ( you can have uv0, uv1, etc. )\r\n  attributeTypeIndex: string\r\n  // the type of individual values (e.g. int32, float64)\r\n  dataType: string\r\n  // how many values associated with each element (e.g. UVs might be 2, geometry might be 3, quaternions 4, matrices 9 or 16)\r\n  dataArity: number\r\n\r\n  constructor (\r\n    description: string,\r\n    association: string,\r\n    semantic: string,\r\n    attributeTypeIndex: string,\r\n    dataType: string,\r\n    dataArity: string\r\n  ) {\r\n    if (!description.startsWith('g3d:')) {\r\n      throw new Error(`${description} must start with 'g3d'`)\r\n    }\r\n\r\n    this.description = description\r\n    this.association = association\r\n    this.semantic = semantic\r\n    this.attributeTypeIndex = attributeTypeIndex\r\n    this.dataType = dataType\r\n    this.dataArity = parseInt(dataArity)\r\n  }\r\n\r\n  static fromString (descriptor: string): G3dAttributeDescriptor {\r\n    const desc = descriptor.split(':')\r\n\r\n    if (desc.length !== 6) {\r\n      throw new Error(`${descriptor}, must have 6 components delimited by ':'`)\r\n    }\r\n\r\n    return new this(descriptor, desc[1], desc[2], desc[3], desc[4], desc[5])\r\n  }\r\n\r\n  matches (other: G3dAttributeDescriptor) {\r\n    const match = (a: string, b: string) => a === '*' || b === '*' || a === b\r\n\r\n    return (\r\n      match(this.association, other.association) &&\r\n      match(this.semantic, other.semantic) &&\r\n      match(this.attributeTypeIndex, other.attributeTypeIndex) &&\r\n      match(this.dataType, other.dataType)\r\n    )\r\n  }\r\n}\r\n\r\nclass G3dAttribute {\r\n  descriptor: G3dAttributeDescriptor\r\n  bytes: Uint8Array\r\n  data: Uint8Array | Int16Array | Int32Array | Float32Array | Float64Array\r\n\r\n  constructor (descriptor: G3dAttributeDescriptor, bytes: Uint8Array) {\r\n    this.descriptor = descriptor\r\n    this.bytes = bytes\r\n    this.data = G3dAttribute.castData(bytes, descriptor.dataType)\r\n  }\r\n\r\n  static fromString (descriptor: string, buffer: Uint8Array): G3dAttribute {\r\n    return new this(G3dAttributeDescriptor.fromString(descriptor), buffer)\r\n  }\r\n\r\n  // Converts a VIM attribute into a typed array from its raw data\r\n  static castData (\r\n    bytes: Uint8Array,\r\n    dataType: string\r\n  ): Uint8Array | Int16Array | Int32Array | Float32Array | Float64Array {\r\n    // This is a UInt8 array\r\n\r\n    switch (dataType) {\r\n      case 'float32':\r\n        return new Float32Array(\r\n          bytes.buffer,\r\n          bytes.byteOffset,\r\n          bytes.byteLength / 4\r\n        )\r\n      case 'float64':\r\n        throw new Float64Array(\r\n          bytes.buffer,\r\n          bytes.byteOffset,\r\n          bytes.byteLength / 8\r\n        )\r\n      case 'int8':\r\n        return bytes\r\n      case 'int16':\r\n        return new Int16Array(\r\n          bytes.buffer,\r\n          bytes.byteOffset,\r\n          bytes.byteLength / 2\r\n        )\r\n      case 'int32':\r\n        return new Int32Array(\r\n          bytes.buffer,\r\n          bytes.byteOffset,\r\n          bytes.byteLength / 4\r\n        )\r\n      // case \"int64\": return new Int64Array(data.buffer, data.byteOffset, data.byteLength / 8);\r\n      default:\r\n        throw new Error('Unrecognized attribute data type ' + dataType)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * G3D is a simple, efficient, generic binary format for storing and transmitting geometry.\r\n * The G3D format is designed to be used either as a serialization format or as an in-memory data structure.\r\n * See https://github.com/vimaec/g3d\r\n */\r\nclass AbstractG3d {\r\n  meta: string\r\n  attributes: G3dAttribute[]\r\n\r\n  constructor (meta: string, attributes: G3dAttribute[]) {\r\n    this.meta = meta\r\n    this.attributes = attributes\r\n  }\r\n\r\n  findAttribute (descriptor: string): G3dAttribute | undefined {\r\n    const filter = G3dAttributeDescriptor.fromString(descriptor)\r\n    for (let i = 0; i < this.attributes.length; ++i) {\r\n      const attribute = this.attributes[i]\r\n      if (attribute.descriptor.matches(filter)) return attribute\r\n    }\r\n  }\r\n\r\n  static createFromBfast (bfast: BFast) {\r\n    const attributes = VimAttributes.all.map((name) => \r\n      new G3dAttribute(G3dAttributeDescriptor.fromString(name), bfast.getBuffer(name)));\r\n    return new AbstractG3d('meta', attributes)\r\n  }\r\n}\r\n\r\n/**\r\n * See https://github.com/vimaec/vim#vim-geometry-attributes\r\n */\r\nclass VimAttributes {\r\n  static positions = 'g3d:vertex:position:0:float32:3'\r\n  static indices = 'g3d:corner:index:0:int32:1'\r\n  static instanceMeshes = 'g3d:instance:mesh:0:int32:1'\r\n  static instanceTransforms = 'g3d:instance:transform:0:float32:16'\r\n  static meshSubmeshes = 'g3d:mesh:submeshoffset:0:int32:1'\r\n  static submeshIndexOffsets = 'g3d:submesh:indexoffset:0:int32:1'\r\n  static submeshMaterials = 'g3d:submesh:material:0:int32:1'\r\n  static materialColors = 'g3d:material:color:0:float32:4'\r\n\r\n  static all = [\r\n    VimAttributes.positions,\r\n    VimAttributes.indices,\r\n    VimAttributes.instanceMeshes,\r\n    VimAttributes.instanceTransforms,\r\n    VimAttributes.meshSubmeshes,\r\n    VimAttributes.submeshIndexOffsets,\r\n    VimAttributes.submeshMaterials,\r\n    VimAttributes.materialColors\r\n  ]\r\n}\r\n\r\n/**\r\n * G3D is a simple, efficient, generic binary format for storing and transmitting geometry.\r\n * The G3D format is designed to be used either as a serialization format or as an in-memory data structure.\r\n * A G3d with specific attributes according to the VIM format specification.\r\n * See https://github.com/vimaec/vim#vim-geometry-attributes for the vim specification.\r\n * See https://github.com/vimaec/g3d for the g3d specification.\r\n */\r\nexport class G3d {\r\n  positions: Float32Array\r\n  indices: Uint32Array\r\n\r\n  instanceMeshes: Int32Array\r\n  instanceTransforms: Float32Array\r\n  meshSubmeshes: Int32Array\r\n  submeshIndexOffset: Int32Array\r\n  submeshMaterial: Int32Array\r\n  materialColors: Float32Array\r\n\r\n  // computed fields\r\n  meshVertexOffsets: Int32Array\r\n  meshInstances: Array<Array<number>>\r\n  meshTransparent: Array<boolean>\r\n\r\n  rawG3d: AbstractG3d\r\n\r\n  MATRIX_SIZE = 16\r\n  COLOR_SIZE = 4\r\n  POSITION_SIZE = 3\r\n  /**\r\n   * Opaque white\r\n   */\r\n  DEFAULT_COLOR = new Float32Array([1, 1, 1, 1])\r\n\r\n  constructor (g3d: AbstractG3d) {\r\n    this.rawG3d = g3d\r\n\r\n    this.positions = g3d.findAttribute(VimAttributes.positions)\r\n      ?.data as Float32Array\r\n\r\n    const tmp = g3d.findAttribute(VimAttributes.indices)?.data\r\n    this.indices = new Uint32Array(tmp.buffer, tmp.byteOffset, tmp.length)\r\n\r\n    this.meshSubmeshes = g3d.findAttribute(VimAttributes.meshSubmeshes)\r\n      ?.data as Int32Array\r\n\r\n    this.submeshIndexOffset = g3d.findAttribute(\r\n      VimAttributes.submeshIndexOffsets\r\n    )?.data as Int32Array\r\n\r\n    this.submeshMaterial = g3d.findAttribute(VimAttributes.submeshMaterials)\r\n      ?.data as Int32Array\r\n\r\n    this.materialColors = g3d.findAttribute(VimAttributes.materialColors)\r\n      ?.data as Float32Array\r\n\r\n    this.instanceMeshes = g3d.findAttribute(VimAttributes.instanceMeshes)\r\n      ?.data as Int32Array\r\n\r\n    this.instanceTransforms = g3d.findAttribute(\r\n      VimAttributes.instanceTransforms\r\n    )?.data as Float32Array\r\n\r\n    this.meshVertexOffsets = this.computeMeshVertexOffsets()\r\n    this.rebaseIndices()\r\n    this.meshInstances = this.computeMeshInstances()\r\n    this.meshTransparent = this.computeMeshIsTransparent()\r\n  }\r\n\r\n  /**\r\n   * Computes the index of the first vertex of each mesh\r\n   */\r\n  private computeMeshVertexOffsets (): Int32Array {\r\n    const result = new Int32Array(this.getMeshCount())\r\n    for (let m = 0; m < result.length; m++) {\r\n      let min = Number.MAX_SAFE_INTEGER\r\n      const start = this.getMeshIndexStart(m)\r\n      const end = this.getMeshIndexEnd(m)\r\n      for (let i = start; i < end; i++) {\r\n        min = Math.min(min, this.indices[i])\r\n      }\r\n      result[m] = min\r\n    }\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * Rebase indices to be relative to its own mesh instead of to the whole g3d\r\n   */\r\n  private rebaseIndices () {\r\n    const count = this.getMeshCount()\r\n    for (let m = 0; m < count; m++) {\r\n      const offset = this.meshVertexOffsets[m]\r\n      const start = this.getMeshIndexStart(m)\r\n      const end = this.getMeshIndexEnd(m)\r\n      for (let i = start; i < end; i++) {\r\n        this.indices[i] -= offset\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Computes all instances pointing to each mesh.\r\n   */\r\n  private computeMeshInstances = (): number[][] => {\r\n    const result: number[][] = []\r\n\r\n    for (let i = 0; i < this.instanceMeshes.length; i++) {\r\n      const mesh = this.instanceMeshes[i]\r\n      if (mesh < 0) continue\r\n      const instanceIndices = result[mesh]\r\n      if (instanceIndices) instanceIndices.push(i)\r\n      else result[mesh] = [i]\r\n    }\r\n\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * Computes an array where true if any of the materials used by a mesh has transparency.\r\n   */\r\n  private computeMeshIsTransparent (): Array<boolean> {\r\n    const result = new Array<boolean>(this.getMeshCount())\r\n    for (let m = 0; m < result.length; m++) {\r\n      const subStart = this.getMeshSubmeshStart(m)\r\n      const subEnd = this.getMeshSubmeshEnd(m)\r\n      // const [subStart, subEnd] = this.getMeshSubmeshRange(m)\r\n      for (let s = subStart; s < subEnd; s++) {\r\n        const material = this.submeshMaterial[s]\r\n        const alpha =\r\n          this.materialColors[material * this.COLOR_SIZE + this.COLOR_SIZE - 1]\r\n        result[m] = result[m] || alpha < 1\r\n      }\r\n    }\r\n    return result\r\n  }\r\n\r\n  // ------------- All -----------------\r\n  getVertexCount = () => this.positions.length / this.POSITION_SIZE\r\n\r\n  // ------------- Meshes -----------------\r\n  getMeshCount = () => this.meshSubmeshes.length\r\n\r\n  getMeshIndexStart (mesh: number): number {\r\n    const subStart = this.getMeshSubmeshStart(mesh)\r\n    return this.getSubmeshIndexStart(subStart)\r\n  }\r\n\r\n  getMeshIndexEnd (mesh: number): number {\r\n    const subEnd = this.getMeshSubmeshEnd(mesh)\r\n    return this.getSubmeshIndexEnd(subEnd - 1)\r\n  }\r\n\r\n  getMeshIndexCount (mesh: number): number {\r\n    return this.getMeshIndexEnd(mesh) - this.getMeshIndexStart(mesh)\r\n  }\r\n\r\n  getMeshVertexStart (mesh: number): number {\r\n    return this.meshVertexOffsets[mesh]\r\n  }\r\n\r\n  getMeshVertexEnd (mesh: number): number {\r\n    return mesh < this.meshVertexOffsets.length - 1\r\n      ? this.meshVertexOffsets[mesh + 1]\r\n      : this.getVertexCount()\r\n  }\r\n\r\n  getMeshVertexCount (mesh: number): number {\r\n    return this.getMeshVertexEnd(mesh) - this.getMeshVertexStart(mesh)\r\n  }\r\n\r\n  getMeshSubmeshStart (mesh: number): number {\r\n    return this.meshSubmeshes[mesh]\r\n  }\r\n\r\n  getMeshSubmeshEnd (mesh: number): number {\r\n    return mesh < this.meshSubmeshes.length - 1\r\n      ? this.meshSubmeshes[mesh + 1]\r\n      : this.submeshIndexOffset.length\r\n  }\r\n\r\n  getMeshSubmeshCount (mesh: number): number {\r\n    return this.getMeshSubmeshEnd(mesh) - this.getMeshSubmeshStart(mesh)\r\n  }\r\n\r\n  // ------------- Submeshes -----------------\r\n\r\n  getSubmeshIndexStart (submesh: number): number {\r\n    return this.submeshIndexOffset[submesh]\r\n  }\r\n\r\n  getSubmeshIndexEnd (submesh: number): number {\r\n    return submesh < this.submeshIndexOffset.length - 1\r\n      ? this.submeshIndexOffset[submesh + 1]\r\n      : this.indices.length\r\n  }\r\n\r\n  getSubmeshIndexCount (submesh: number): number {\r\n    return this.getSubmeshIndexEnd(submesh) - this.getSubmeshIndexStart(submesh)\r\n  }\r\n\r\n  /**\r\n   * Returns color of given submesh as a 4-number array (RGBA)\r\n   * @param submesh g3d submesh index\r\n   */\r\n  getSubmeshColor (submesh: number): Float32Array {\r\n    return this.getMaterialColor(this.submeshMaterial[submesh])\r\n  }\r\n\r\n  // ------------- Instances -----------------\r\n  getInstanceCount = () => this.instanceMeshes.length\r\n\r\n  /**\r\n   * Returns an 16 number array representation of the matrix for given instance\r\n   * @param instance g3d instance index\r\n   */\r\n  getInstanceMatrix (instance: number): Float32Array {\r\n    return this.instanceTransforms.subarray(\r\n      instance * this.MATRIX_SIZE,\r\n      (instance + 1) * this.MATRIX_SIZE\r\n    )\r\n  }\r\n\r\n  // ------------- Material -----------------\r\n\r\n  getMaterialCount = () => this.materialColors.length / this.COLOR_SIZE\r\n\r\n  /**\r\n   * Returns color of given material as a 4-number array (RGBA)\r\n   * @param material g3d material index\r\n   */\r\n  getMaterialColor (material: number): Float32Array {\r\n    if (material < 0) return this.DEFAULT_COLOR\r\n    return this.materialColors.subarray(\r\n      material * this.COLOR_SIZE,\r\n      (material + 1) * this.COLOR_SIZE\r\n    )\r\n  }\r\n\r\n  static createFromBfast (bfast: BFast) {\r\n    return new G3d(AbstractG3d.createFromBfast(bfast));\r\n  }\r\n\r\n  validate () {\r\n    const isPresent = (attribute: any, label: string) => {\r\n      if (!attribute) {\r\n        throw new Error(`Missing Attribute Buffer: ${label}`)\r\n      }\r\n    }\r\n    isPresent(this.positions, 'position')\r\n    isPresent(this.indices, 'indices')\r\n    isPresent(this.instanceMeshes, 'instanceMeshes')\r\n    isPresent(this.instanceTransforms, 'instanceTransforms')\r\n    isPresent(this.meshSubmeshes, 'meshSubmeshes')\r\n    isPresent(this.submeshIndexOffset, 'submeshIndexOffset')\r\n    isPresent(this.submeshMaterial, 'submeshMaterial')\r\n    isPresent(this.materialColors, 'materialColors')\r\n\r\n    // Basic\r\n    if (this.positions.length % this.POSITION_SIZE !== 0) {\r\n      throw new Error(\r\n        'Invalid position buffer, must be divisible by ' + this.POSITION_SIZE\r\n      )\r\n    }\r\n\r\n    if (this.indices.length % 3 !== 0) {\r\n      throw new Error('Invalid Index Count, must be divisible by 3')\r\n    }\r\n\r\n    for (let i = 0; i < this.indices.length; i++) {\r\n      if (this.indices[i] < 0 || this.indices[i] >= this.positions.length) {\r\n        throw new Error('Vertex index out of bound')\r\n      }\r\n    }\r\n\r\n    // Instances\r\n    if (\r\n      this.instanceMeshes.length !==\r\n      this.instanceTransforms.length / this.MATRIX_SIZE\r\n    ) {\r\n      throw new Error('Instance buffers mismatched')\r\n    }\r\n\r\n    if (this.instanceTransforms.length % this.MATRIX_SIZE !== 0) {\r\n      throw new Error(\r\n        'Invalid InstanceTransform buffer, must respect arity ' +\r\n          this.MATRIX_SIZE\r\n      )\r\n    }\r\n\r\n    for (let i = 0; i < this.instanceMeshes.length; i++) {\r\n      if (this.instanceMeshes[i] >= this.meshSubmeshes.length) {\r\n        throw new Error('Instance Mesh Out of range.')\r\n      }\r\n    }\r\n\r\n    // Meshes\r\n    for (let i = 0; i < this.meshSubmeshes.length; i++) {\r\n      if (\r\n        this.meshSubmeshes[i] < 0 ||\r\n        this.meshSubmeshes[i] >= this.submeshIndexOffset.length\r\n      ) {\r\n        throw new Error('MeshSubmeshOffset out of bound at')\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < this.meshSubmeshes.length - 1; i++) {\r\n      if (this.meshSubmeshes[i] >= this.meshSubmeshes[i + 1]) {\r\n        throw new Error('MeshSubmesh out of sequence.')\r\n      }\r\n    }\r\n\r\n    // Submeshes\r\n    if (this.submeshIndexOffset.length !== this.submeshMaterial.length) {\r\n      throw new Error('Mismatched submesh buffers')\r\n    }\r\n\r\n    for (let i = 0; i < this.submeshIndexOffset.length; i++) {\r\n      if (\r\n        this.submeshIndexOffset[i] < 0 ||\r\n        this.submeshIndexOffset[i] >= this.indices.length\r\n      ) {\r\n        throw new Error('SubmeshIndexOffset out of bound')\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < this.submeshIndexOffset.length; i++) {\r\n      if (this.submeshIndexOffset[i] % 3 !== 0) {\r\n        throw new Error('Invalid SubmeshIndexOffset, must be divisible by 3')\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < this.submeshIndexOffset.length - 1; i++) {\r\n      if (this.submeshIndexOffset[i] >= this.submeshIndexOffset[i + 1]) {\r\n        throw new Error('SubmeshIndexOffset out of sequence.')\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < this.submeshMaterial.length; i++) {\r\n      if (this.submeshMaterial[i] >= this.materialColors.length) {\r\n        throw new Error('SubmeshMaterial out of bound')\r\n      }\r\n    }\r\n\r\n    // Materials\r\n    if (this.materialColors.length % this.COLOR_SIZE !== 0) {\r\n      throw new Error(\r\n        'Invalid material color buffer, must be divisible by ' + this.COLOR_SIZE\r\n      )\r\n    }\r\n  }\r\n}\r\n","import { BFast } from './bfast'\r\nimport { G3d } from './g3d'\r\n\r\nconst TypeSizes = { \r\n  byte: 1,\r\n  short: 2,\r\n  int : 4,\r\n  float : 4,\r\n  long : 8,\r\n  double : 8,\r\n  string : 4,\r\n  index : 4,\r\n  numeric : 8,\r\n  default: 4,\r\n}\r\n\r\nfunction getTypeSize(typeName: string): number {\r\n  if (typeName in TypeSizes) \r\n    return TypeSizes[typeName];\r\n  else\r\n    return TypeSizes.default;\r\n}\r\n\r\nconst ArrayConstructors = {\r\n  byte:  Int8Array,\r\n  short: Int16Array,\r\n  int: Int32Array,\r\n  float: Float32Array,\r\n  long: Float64Array,\r\n  double: Float64Array,\r\n  string: Int32Array,\r\n  index: Int32Array,\r\n  numeric: Float64Array,\r\n  default: Uint8Array,\r\n}\r\n\r\nfunction getTypeArrayConstructor(typeName: string): any {\r\n  if (typeName in ArrayConstructors)\r\n    return ArrayConstructors[typeName];\r\n  else\r\n    return ArrayConstructors.default;\r\n}\r\n\r\nfunction invertMap (data: ArrayLike<number>) : Map<number, number[]> {\r\n  const result = new Map<number, number[]>()\r\n  for (let i = 0; i < data.length; i++) {\r\n    const value = data[i];\r\n    if (!result.has(value)) {\r\n      result.set(value, [i]);\r\n    } else {\r\n      result.get(value).push(i);\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nexport class EntityTable \r\n{ \r\n  name: string;\r\n  columns: Map<string, EntityColumn>;  \r\n  numRows: number;\r\n  constructor(bfast: BFast, name: string)\r\n  {\r\n    this.name = name;\r\n    this.columns = new Map<string, EntityColumn>();\r\n    this.numRows = -1;\r\n    for (let i=0; i < bfast.buffers.length; ++i) {\r\n      const name = bfast.names[i];\r\n      const buffer = bfast.buffers[i];\r\n      const column = new EntityColumn(name, buffer);\r\n      if (this.numRows < 0) \r\n        this.numRows = column.data.length; \r\n      if (this.numRows != column.data.length)\r\n        throw new Error(\"Inconsistent number of rows\");\r\n      this.columns.set(column.name, column);\r\n    }\r\n  }\r\n  getColumn(name: string) : EntityColumn {\r\n    return this.columns.get(name);\r\n  }\r\n  getColumnData(name: string) : ArrayLike<any> {\r\n    return this.getColumn(name).data;\r\n  }\r\n  getRowData(n: number): any {\r\n    let r = {};\r\n    for (let [name, col] of this.columns) {\r\n      r[name] = col.data[n];\r\n    }\r\n    return r;  \r\n  }\r\n}\r\n\r\nexport class EntityColumn\r\n{\r\n  name: string;\r\n  type: string;\r\n  typeSize: number;\r\n  data: ArrayLike<any>;\r\n  constructor(name: string, buffer: Uint8Array)\r\n  {\r\n    const split = name.indexOf(':');     \r\n    this.type = name.slice(0, split);    \r\n    this.name = name.slice(split + 1);\r\n    this.typeSize = getTypeSize(this.type);    \r\n    const length = buffer.length / this.typeSize;\r\n    const ctor = getTypeArrayConstructor(this.type);\r\n    this.data = new ctor(buffer.buffer, buffer.byteOffset, length);\r\n  }  \r\n}\r\n\r\nexport class Document \r\n{\r\n  bfast: BFast;\r\n  g3d: G3d;\r\n  entities: BFast;\r\n  tables: Map<string, EntityTable>;\r\n  strings: string[];\r\n  instanceToElement: ArrayLike<number>;\r\n  elementIds: ArrayLike<number>;\r\n  elementToInstances: Map<number, number[]>;\r\n  elementIdToElements: Map<number, number[]>;\r\n\r\n  constructor (bfast: BFast) \r\n  {\r\n    this.g3d = G3d.createFromBfast(bfast.getChild('geometry'));\r\n    this.strings = new TextDecoder('utf-8').decode(bfast.getBuffer('strings')).split('\\0');\r\n    this.entities = bfast.getChild('entities');\r\n    this.tables = new Map<string, EntityTable>();\r\n    for (const [k, child] of this.entities.children.entries()) {\r\n      const table = new EntityTable(child, k);\r\n      this.tables.set(table.name, table);\r\n    }\r\n\r\n    this.instanceToElement = this.getColumnData('Vim.Node', 'Vim.Element:Element');    \r\n    this.elementIds = this.getColumnData('Vim.Element', 'Id');\r\n    this.elementToInstances = invertMap(this.instanceToElement)\r\n    this.elementIdToElements = invertMap(this.elementIds)\r\n  }\r\n\r\n  getTable(name : string): EntityTable {\r\n    return this.tables.get(name);\r\n  }\r\n\r\n  getColumnData(tableName: string, columnName: string) {\r\n    return this.getTable(tableName).getColumnData(columnName);\r\n  }\r\n\r\n  getRowData(tableName: string, row: number) {\r\n    return this.getTable(tableName).getRowData(row);\r\n  }\r\n\r\n  getInstanceFromElement (elementIndex: number) {\r\n    return this.elementToInstances.get(elementIndex);\r\n  }\r\n\r\n  getElementFromInstance (instance: number) {\r\n    return this.instanceToElement[instance];\r\n  }\r\n\r\n  getElementFromElementId (elementId: number) {\r\n    return this.elementIdToElements.get(elementId);\r\n  }\r\n\r\n  getElementId (element: number) {\r\n    return this.elementIds[element];\r\n  }\r\n\r\n  getElementData(element: number) {\r\n    return this.getRowData('Vim.Element', element);\r\n  }\r\n}\r\n","/**\r\n * @module vim-loader\r\n */\r\n\r\n// external\r\nimport * as THREE from 'three'\r\nimport { Mesh } from './mesh'\r\nimport { Geometry } from './geometry'\r\nimport {\r\n  BufferAttribute,\r\n  Float32BufferAttribute,\r\n  InstancedBufferAttribute,\r\n  InstancedMesh\r\n} from 'three'\r\nimport { Vim } from './vim'\r\n\r\n/**\r\n * High level api to interact with the loaded vim geometry and data.\r\n */\r\nexport class Object {\r\n  vim: Vim\r\n  element: number\r\n  instances: number[]\r\n  private _color: THREE.Color | undefined\r\n  private _visible: boolean = true\r\n  private _boundingBox: THREE.Box3 | undefined\r\n  private _meshes: [THREE.Mesh, number][]\r\n\r\n  constructor (\r\n    vim: Vim,\r\n    element: number,\r\n    instances: number[],\r\n    meshes: [THREE.Mesh, number][]\r\n  ) {\r\n    this.vim = vim\r\n    this.element = element\r\n    this.instances = instances\r\n    this._meshes = meshes\r\n  }\r\n\r\n  get hasMesh () {\r\n    return this._meshes?.length!!\r\n  }\r\n\r\n  /**\r\n   * Internal - Replace this object meshes and apply color as needed.\r\n   */\r\n  updateMeshes (meshes: [THREE.Mesh, number][]) {\r\n    this._meshes = meshes\r\n    if (!meshes) return\r\n\r\n    // if there was a color override reapply to new meshes.\r\n    if (this.color) {\r\n      this.color = this._color\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns Bim data for the element associated with this object.\r\n   */\r\n  getBimElement () {\r\n    return this.vim.document.getElementData(this.element)\r\n  }\r\n\r\n  get elementId () {\r\n    return this.vim.document.getElementId(this.element)\r\n  }\r\n\r\n  /**\r\n   * returns the bounding box of the object from cache or computed if needed.\r\n   * Returns undefined if object has no geometry.\r\n   */\r\n  getBoundingBox () {\r\n    if (!this.instances) return\r\n    if (this._boundingBox) return this._boundingBox\r\n\r\n    const geometry = Geometry.createGeometryFromInstances(\r\n      this.vim.document.g3d,\r\n      this.instances\r\n    )\r\n    geometry.applyMatrix4(this.vim.getMatrix())\r\n\r\n    geometry.computeBoundingBox()\r\n    this._boundingBox = geometry.boundingBox\r\n    geometry.dispose()\r\n    return this._boundingBox\r\n  }\r\n\r\n  /**\r\n   * Returns the center position of this object\r\n   * @param target Vector3 where to copy data. A new instance is created if none provided.\r\n   * Returns undefined if object has no geometry.\r\n   */\r\n  public getCenter (target: THREE.Vector3 = new THREE.Vector3()) {\r\n    return this.getBoundingBox()?.getCenter(target)\r\n  }\r\n\r\n  /**\r\n   * returns the bounding sphere of the object from cache or computed if needed.\r\n   * Returns undefined if object has no geometry.\r\n   */\r\n  getBoundingSphere (target: THREE.Sphere = new THREE.Sphere()) {\r\n    return this.getBoundingBox()?.getBoundingSphere(target)\r\n  }\r\n\r\n  /**\r\n   * Creates a new three wireframe Line object from the object geometry\r\n   */\r\n  createWireframe () {\r\n    if (!this.instances) return\r\n\r\n    const wireframe = Mesh.getDefaultBuilder().createWireframe(\r\n      this.vim.document.g3d,\r\n      this.instances\r\n    )\r\n    wireframe.applyMatrix4(this.vim.getMatrix())\r\n    return wireframe\r\n  }\r\n\r\n  /**\r\n   * Creates a new THREE.BufferGeometry for this object\r\n   * Returns undefined if object has no geometry.\r\n   */\r\n  createGeometry () {\r\n    if (!this.instances) return\r\n\r\n    const geometry = Geometry.createGeometryFromInstances(\r\n      this.vim.document.g3d,\r\n      this.instances\r\n    )\r\n    geometry.applyMatrix4(this.vim.getMatrix())\r\n    return geometry\r\n  }\r\n\r\n  /**\r\n   * Changes the display color of this object.\r\n   * @param color Color to apply, undefined to revert to default color.\r\n   */\r\n  get color () {\r\n    return this._color\r\n  }\r\n\r\n  set color (color: THREE.Color | undefined) {\r\n    if (\r\n      !this._color || !color\r\n        ? !this._color && !color\r\n        : this._color.equals(color)\r\n    ) {\r\n      return\r\n    }\r\n    this._color = color\r\n    this.applyColor(color)\r\n  }\r\n\r\n  private applyColor (color: THREE.Color | undefined) {\r\n    if (!this._meshes) return\r\n\r\n    for (let m = 0; m < this._meshes.length; m++) {\r\n      const [mesh, index] = this._meshes[m]\r\n      if (mesh.userData.merged) {\r\n        this.applyMergedColor(mesh, index, color)\r\n      } else {\r\n        this.applyInstancedColor(mesh as THREE.InstancedMesh, index, color)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggles visibility of this object.\r\n   * @param value true to show object, false to hide object.\r\n   */\r\n  get visible () {\r\n    return this._visible\r\n  }\r\n\r\n  set visible (value: boolean) {\r\n    if (this._visible === value) return\r\n    this._visible = value\r\n    this.applyVisible(value)\r\n  }\r\n\r\n  private applyVisible (value: boolean) {\r\n    if (!this._meshes) return\r\n\r\n    for (let m = 0; m < this._meshes.length; m++) {\r\n      const [mesh, index] = this._meshes[m]\r\n      if (mesh.userData.merged) {\r\n        this.applyMergedVisible(mesh, index, value)\r\n      } else {\r\n        this.applyInstancedVisible(mesh as THREE.InstancedMesh, index, value)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param index index of the merged mesh instance\r\n   * @returns inclusive first index of the index buffer related to given merged mesh index\r\n   */\r\n  private getMergedMeshStart (mesh: THREE.Mesh, index: number) {\r\n    return mesh.userData.submeshes[index]\r\n  }\r\n\r\n  /**\r\n   * @param index index of the merged mesh instance\r\n   * @returns return the last+1 index of the index buffer related to given merged mesh index\r\n   */\r\n  private getMergedMeshEnd (mesh: THREE.Mesh, index: number) {\r\n    return index + 1 < mesh.userData.submeshes.length\r\n      ? mesh.userData.submeshes[index + 1]\r\n      : mesh.geometry.getIndex().count\r\n  }\r\n\r\n  /**\r\n   * Writes new color to the appropriate section of merged mesh color buffer.\r\n   * @param index index of the merged mesh instance\r\n   * @param color rgb representation of the color to apply\r\n   */\r\n  private applyMergedVisible (mesh: THREE.Mesh, index: number, show: boolean) {\r\n    const attribute =\r\n      mesh.geometry.getAttribute('ignoreVertex') ??\r\n      new Float32BufferAttribute(\r\n        new Float32Array(mesh.geometry.index.count * 3),\r\n        1\r\n      )\r\n    mesh.geometry.setAttribute('ignoreVertex', attribute)\r\n\r\n    const start = this.getMergedMeshStart(mesh, index)\r\n    const end = this.getMergedMeshEnd(mesh, index)\r\n    const indices = mesh.geometry.getIndex()\r\n\r\n    for (let i = start; i < end; i++) {\r\n      const v = indices.getX(i)\r\n      attribute.setX(v, show ? 0 : 1)\r\n    }\r\n    attribute.needsUpdate = true\r\n  }\r\n\r\n  /**\r\n   * Adds an ignoreInstance buffer to the instanced mesh and sets values to 1 to hide instances\r\n   * @param index index of the instanced instance\r\n   */\r\n  private applyInstancedVisible (\r\n    mesh: THREE.InstancedMesh,\r\n    index: number,\r\n    visible: boolean\r\n  ) {\r\n    let attribute = mesh.geometry.getAttribute('ignoreInstance')\r\n    if (!attribute) {\r\n      attribute = new InstancedBufferAttribute(new Float32Array(mesh.count), 1)\r\n      mesh.geometry.setAttribute('ignoreInstance', attribute)\r\n    }\r\n\r\n    attribute.setX(index, visible ? 0 : 1)\r\n    attribute.needsUpdate = true\r\n  }\r\n\r\n  /**\r\n   * Writes new color to the appropriate section of merged mesh color buffer.\r\n   * @param index index of the merged mesh instance\r\n   * @param color rgb representation of the color to apply\r\n   */\r\n  private applyMergedColor (\r\n    mesh: THREE.Mesh,\r\n    index: number,\r\n    color: THREE.Color | undefined\r\n  ) {\r\n    if (!color) {\r\n      this.resetMergedColor(mesh, index)\r\n      return\r\n    }\r\n\r\n    const start = this.getMergedMeshStart(mesh, index)\r\n    const end = this.getMergedMeshEnd(mesh, index)\r\n\r\n    const colors = mesh.geometry.getAttribute('color')\r\n    const colored = this.getOrAddColoredAttribute(mesh)\r\n    const indices = mesh.geometry.getIndex()\r\n\r\n    for (let i = start; i < end; i++) {\r\n      const v = indices.getX(i)\r\n      // alpha is left to its current value\r\n      colors.setXYZ(v, color.r, color.g, color.b)\r\n      colored.setX(v, 1)\r\n    }\r\n    colors.needsUpdate = true\r\n    colored.needsUpdate = true\r\n  }\r\n\r\n  /**\r\n   * Repopulates the color buffer of the merged mesh from original g3d data.\r\n   * @param index index of the merged mesh instance\r\n   */\r\n  private resetMergedColor (mesh: THREE.Mesh, index: number) {\r\n    const colors = mesh.geometry.getAttribute('color')\r\n    const colored = this.getOrAddColoredAttribute(mesh)\r\n    const indices = mesh.geometry.getIndex()\r\n    let mergedIndex = this.getMergedMeshStart(mesh, index)\r\n\r\n    const instance = this.vim.scene.getInstanceFromMesh(mesh, index)\r\n    const g3d = this.vim.document.g3d\r\n    const g3dMesh = g3d.instanceMeshes[instance]\r\n    const subStart = g3d.getMeshSubmeshStart(g3dMesh)\r\n    const subEnd = g3d.getMeshSubmeshEnd(g3dMesh)\r\n\r\n    for (let sub = subStart; sub < subEnd; sub++) {\r\n      const start = g3d.getSubmeshIndexStart(sub)\r\n      const end = g3d.getSubmeshIndexEnd(sub)\r\n      const color = g3d.getSubmeshColor(sub)\r\n      for (let i = start; i < end; i++) {\r\n        const v = indices.getX(mergedIndex)\r\n        colors.setXYZ(v, color[0], color[1], color[2])\r\n        colored.setX(v, 0)\r\n        mergedIndex++\r\n      }\r\n    }\r\n    colors.needsUpdate = true\r\n    colored.needsUpdate = true\r\n  }\r\n\r\n  /**\r\n   * Adds an instanceColor buffer to the instanced mesh and sets new color for given instance\r\n   * @param index index of the instanced instance\r\n   * @param color rgb representation of the color to apply\r\n   */\r\n  private applyInstancedColor (\r\n    mesh: THREE.InstancedMesh,\r\n    index: number,\r\n    color: THREE.Color\r\n  ) {\r\n    const colors = this.getOrAddInstanceColorAttribute(mesh)\r\n    const colored = this.getOrAddColoredAttribute(mesh)\r\n    if (color) {\r\n      // Set instance to use instance color provided\r\n      colors.setXYZ(index, color.r, color.g, color.b)\r\n      colored.setX(index, 1)\r\n    } else {\r\n      // Revert to vertex color\r\n      colored.setX(index, 0)\r\n    }\r\n\r\n    // Set attributes dirty\r\n    colored.needsUpdate = true\r\n    colors.needsUpdate = true\r\n  }\r\n\r\n  private getOrAddInstanceColorAttribute (mesh: THREE.InstancedMesh) {\r\n    if (mesh.instanceColor) return mesh.instanceColor\r\n    const count = mesh.instanceMatrix.count\r\n    // Add color instance attribute\r\n    const colors = new Float32Array(count * 3)\r\n    const attribute = new THREE.InstancedBufferAttribute(colors, 3)\r\n    mesh.instanceColor = attribute\r\n    return attribute\r\n  }\r\n\r\n  private getOrAddColoredAttribute (mesh: THREE.Mesh) {\r\n    const colored = mesh.geometry.getAttribute('colored')\r\n    if (colored) {\r\n      return colored\r\n    }\r\n\r\n    const count =\r\n      mesh instanceof InstancedMesh\r\n        ? mesh.instanceMatrix.count\r\n        : mesh.geometry.getAttribute('position').count\r\n\r\n    const array = new Float32Array(count)\r\n    const attribute =\r\n      mesh instanceof InstancedMesh\r\n        ? new THREE.InstancedBufferAttribute(array, 1)\r\n        : new BufferAttribute(array, 1)\r\n\r\n    // Add custom colored instance attribute\r\n    mesh.geometry.setAttribute('colored', attribute)\r\n\r\n    return attribute\r\n  }\r\n}\r\n","/**\r\n * @module vim-loader\r\n */\r\n\r\nimport * as THREE from 'three'\r\nimport { Document } from './document'\r\nimport { Scene } from './scene'\r\nimport { VimSettings } from './vimSettings'\r\nimport { Object } from './object'\r\n\r\n/**\r\n * Container for the built three meshes and the vim data from which it was built.\r\n * Dispenses Objects for high level scene manipulation\r\n */\r\nexport class Vim {\r\n  document: Document\r\n  scene: Scene\r\n  settings: VimSettings\r\n  index: number\r\n  private _elementToObject: Map<number, Object> = new Map<number, Object>()\r\n\r\n  constructor (vim: Document, scene: Scene) {\r\n    this.document = vim\r\n    this.scene = scene\r\n    this.scene.setVim(this)\r\n  }\r\n\r\n  dispose () {\r\n    this.scene.dispose()\r\n    this.scene = undefined\r\n  }\r\n\r\n  /**\r\n   * Reloads the vim with only the instances provided\r\n   * @param instances g3d instance indices to keep\r\n   */\r\n  filter (instances?: number[]) {\r\n    this.scene.dispose()\r\n    this.scene = Scene.createFromG3d(\r\n      this.document.g3d,\r\n      this.settings.getTransparency(),\r\n      instances\r\n    )\r\n    this.scene.applyMatrix4(this.settings.getMatrix())\r\n    this.scene.setVim(this)\r\n    for (const [element, object] of this._elementToObject.entries()) {\r\n      object.updateMeshes(this.getMeshesFromElement(element))\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Applies new settings to the vim\r\n   */\r\n  applySettings (settings: VimSettings) {\r\n    this.settings = settings\r\n    this.scene.applyMatrix4(this.settings.getMatrix())\r\n  }\r\n\r\n  /**\r\n   * Returns vim matrix\r\n   */\r\n  getMatrix () {\r\n    return this.settings.getMatrix()\r\n  }\r\n\r\n  /**\r\n   * Returns vim object from given mesh and index\r\n   * @param mesh three mesh\r\n   * @param index instanced mesh index or merged mesh submesh index\r\n   */\r\n  getObjectFromMesh (mesh: THREE.Mesh, index: number) {\r\n    const element = this.getElementFromMesh(mesh, index)\r\n    return this.getObjectFromElementIndex(element)\r\n  }\r\n\r\n  /**\r\n   * Returns vim object from given instance\r\n   * @param instance g3d instance index\r\n   */\r\n  getObjectFromInstance (instance: number) {\r\n    const element = this.document.getElementFromInstance(instance)\r\n    return this.getObjectFromElementIndex(element)\r\n  }\r\n\r\n  /**\r\n   * Returns vim object from given vim element Id\r\n   * @param id vim element Id\r\n   */\r\n  getObjectsFromElementId (id: number) {\r\n    const elements = this.document.getElementFromElementId(id)\r\n    return elements?.map((e) => this.getObjectFromElementIndex(e))\r\n  }\r\n\r\n  /**\r\n   * Returns vim object from given vim element index\r\n   * @param element vim element index\r\n   */\r\n  getObjectFromElementIndex (element: number) {\r\n    if (element === undefined) return\r\n\r\n    if (this._elementToObject.has(element)) {\r\n      return this._elementToObject.get(element)\r\n    }\r\n\r\n    const instances = this.document.getInstanceFromElement(element)\r\n    const meshes = this.getMeshesFromInstances(instances)\r\n\r\n    const result = new Object(this, element, instances, meshes)\r\n    this._elementToObject.set(element, result)\r\n    return result\r\n  }\r\n\r\n  private getMeshesFromElement (index: number) {\r\n    const instances = this.document.getInstanceFromElement(index)\r\n    return this.getMeshesFromInstances(instances)\r\n  }\r\n\r\n  private getMeshesFromInstances (instances: number[]) {\r\n    if (!instances?.length) return\r\n\r\n    const meshes: [THREE.Mesh, number][] = []\r\n    for (let i = 0; i < instances.length; i++) {\r\n      const instance = instances[i]\r\n      if (instance < 0) continue\r\n      const [mesh, index] = this.scene.getMeshFromInstance(instance)\r\n      if (!mesh) continue\r\n      meshes.push([mesh, index])\r\n    }\r\n    if (meshes.length === 0) return\r\n    return meshes\r\n  }\r\n\r\n  /**\r\n   * Get the element index related to given mesh\r\n   * @param mesh instanced mesh\r\n   * @param index index into the instanced mesh\r\n   * @returns index of element\r\n   */\r\n  private getElementFromMesh (mesh: THREE.Mesh, index: number): number {\r\n    if (!mesh || index < 0) return -1\r\n    const instance = this.scene.getInstanceFromMesh(mesh, index)\r\n    return this.document.getElementFromInstance(instance)\r\n  }\r\n}\r\n","/**\r\n * @module vim-loader\r\n */\r\n\r\nimport { Document } from './document'\r\nimport { Scene } from './scene'\r\nimport { Transparency } from './geometry'\r\nimport { BFast } from './bfast'\r\nimport { G3d } from './g3d'\r\nimport { Vim } from './vim'\r\n\r\n/**\r\n * Loader for the Vim File format.\r\n * See https://github.com/vimaec/vim\r\n */\r\nexport class Loader {\r\n  load (bfast: BFast, transparency: Transparency.Mode) {\r\n    let g3d: G3d\r\n    let document: Document\r\n    document = new Document(bfast);\r\n    const scene = Scene.createFromG3d(document.g3d, transparency)\r\n    const vim = new Vim(document, scene)\r\n    return vim\r\n  }\r\n}\r\n","export class BFastHeader {\r\n  magic: number\r\n  dataStart: number\r\n  dataEnd: number\r\n  numArrays: number\r\n  isValid: boolean\r\n  error: string\r\n\r\n  constructor (\r\n    magic: number,\r\n    dataStart: number,\r\n    dataEnd: number,\r\n    numArrays: number,\r\n    byteLength: number\r\n  ) {\r\n    this.isValid = false\r\n    if (magic !== 0xbfa5) \r\n      this.error = 'Not a BFAST file, or endianness is swapped';\r\n    else if (dataStart <= 32 || dataStart > byteLength) \r\n      this.error = 'Data start is out of valid range';\r\n    else if (dataEnd < dataStart || dataEnd > byteLength) \r\n      this.error = 'Data end is out of valid range';\r\n    else if (numArrays < 0 || numArrays > dataEnd) \r\n      this.error = 'Number of arrays is invalid';\r\n    else \r\n      this.isValid = true;\r\n    this.magic = magic;\r\n    this.dataStart = dataStart;\r\n    this.dataEnd = dataEnd;\r\n    this.numArrays = numArrays;\r\n  }\r\n\r\n  static fromBytes (bytes: Uint8Array, byteLength: number): BFastHeader {\r\n    const ints = new Int32Array(bytes.buffer, bytes.byteOffset, bytes.byteLength / 4)\r\n    return BFastHeader.fromArray(ints, byteLength);\r\n  }\r\n\r\n  static fromArray (array: Int32Array, byteLength: number): BFastHeader {\r\n    if (array.length < 8) {\r\n      let r = new this(0,0,0,0,0);\r\n      r.isValid = false;\r\n      r.error = \"Insufficient length\";\r\n    }\r\n    else {\r\n      return new this(array[0], array[2], array[4], array[6], byteLength)\r\n    }\r\n  }\r\n}\r\n\r\nexport class BFast {\r\n  header: BFastHeader\r\n  names: string[]\r\n  buffers: Uint8Array[]\r\n  children: Map<string, BFast>\r\n\r\n  constructor (header: BFastHeader, names: string[], buffers: Uint8Array[]) {\r\n    this.header = header\r\n    this.names = names\r\n    this.buffers = buffers\r\n    if (names.length != buffers.length) throw new Error(\"number of names, and number of buffers must match\");    \r\n    this.children = new Map<string, BFast>()\r\n  }\r\n    \r\n  getBuffer(name: string): Uint8Array {\r\n    const index = this.names.indexOf(name);\r\n    if (index < 0) throw new Error(\"buffer \" + name + \" not found\");\r\n    return this.buffers[index];\r\n  }\r\n\r\n  getChild(name: string): BFast {\r\n    return this.children.get(name);\r\n  }\r\n\r\n  static isBfast(bytes: Uint8Array): boolean {\r\n    const header = BFastHeader.fromBytes(bytes, bytes.length);\r\n    return header && header.isValid;\r\n  }\r\n\r\n  static parseFromArray (bytes: Uint8Array): BFast {\r\n    return this.parseFromBuffer(\r\n      bytes.buffer,\r\n      bytes.byteOffset,\r\n      bytes.byteLength\r\n    )\r\n  }  \r\n\r\n  // BFAST is the container format for an array of binary arrays\r\n  static parseFromBuffer (\r\n    arrayBuffer: ArrayBuffer,\r\n    byteOffset: number = 0,\r\n    byteLength: number = arrayBuffer.byteLength - byteOffset\r\n  ): BFast \r\n  {\r\n    // Cast the input data to 32-bit integers\r\n    // Note that according to the spec they are 64 bit numbers. In JavaScript you can't have 64 bit integers,\r\n    // and it would bust the amount of memory we can work with in most browsers and low-power devices\r\n    const data = new Int32Array(arrayBuffer, byteOffset, byteLength / 4)\r\n\r\n    // Parse the header\r\n    const header = BFastHeader.fromArray(data, byteLength)\r\n    if (!header.isValid)\r\n      throw new Error(header.error);\r\n\r\n    // Compute each buffer\r\n    const buffers: Uint8Array[] = []\r\n    let pos = 8\r\n    for (let i = 0; i < header.numArrays; ++i) {\r\n      const begin = data[pos + 0]\r\n      const end = data[pos + 2]\r\n\r\n      // Check validity of data\r\n      if (data[pos + 1] !== 0) \r\n        throw new Error('Expected 0 in position ' + (pos + 1) * 4);\r\n      if (data[pos + 3] !== 0) \r\n        throw new Error('Expected 0 in position ' + (pos + 3) * 4);\r\n      if (begin < header.dataStart || begin > header.dataEnd) \r\n        throw new Error('Buffer start is out of range');\r\n      if (end < begin || end > header.dataEnd) \r\n        throw new Error('Buffer end is out of range');\r\n\r\n      pos += 4\r\n      const buffer = new Uint8Array(\r\n        arrayBuffer,\r\n        begin + byteOffset,\r\n        end - begin\r\n      )\r\n      buffers.push(buffer)\r\n    }\r\n\r\n    if (buffers.length < 0) \r\n      throw new Error('Expected at least one buffer containing the names')\r\n\r\n    // break the first one up into names\r\n    const joinedNames = new TextDecoder('utf-8').decode(buffers[0])\r\n\r\n    // Removing the trailing '\\0' before spliting the names\r\n    let names = joinedNames.slice(0, -1).split('\\0')\r\n    if (joinedNames.length === 0) names = []\r\n\r\n    // Validate the number of names\r\n    if (names.length !== buffers.length - 1) {\r\n      throw new Error(\r\n        'Expected number of names to be equal to the number of buffers - 1'\r\n      )\r\n    }\r\n\r\n    var slices = buffers.slice(1);\r\n    var result = new BFast(header, names, slices);\r\n\r\n    for (var i=0; i < names.length; ++i)\r\n    {\r\n      var buffer = slices[i];\r\n      if (this.isBfast(buffer))      \r\n      {\r\n        var bfast = BFast.parseFromArray(buffer);\r\n        result.children.set(names[i], bfast);\r\n      }\r\n    }\r\n\r\n    return result; \r\n  }\r\n}","/**\r\n @module viw-webgl-viewer\r\n*/\r\n\r\nimport * as THREE from 'three'\r\n\r\n// internal\r\nimport { ViewerSettings, ViewerOptions } from './viewerSettings'\r\nimport { Camera, ICamera } from './camera'\r\nimport { Input } from './input'\r\nimport { Selection } from './selection'\r\nimport { Environment, IEnvironment } from './environment'\r\nimport { Renderer } from './renderer'\r\nimport { Raycaster, RaycastResult } from './raycaster'\r\nimport { CameraGizmo } from './gizmos'\r\nimport { RenderScene } from './renderScene'\r\nimport { Viewport } from './viewport'\r\n\r\n// loader\r\nimport { VimSettings, VimOptions } from '../vim-loader/vimSettings'\r\nimport { Loader } from '../vim-loader/loader'\r\nimport { Object } from '../vim-loader/object'\r\nimport { BFast } from '../vim-loader/bfast'\r\nimport { Vim } from '../vim-loader/vim'\r\nimport { Materials } from '../vim-loader/materials'\r\n\r\n/**\r\n * Viewer and loader for vim files.\r\n */\r\nexport class Viewer {\r\n  /**\r\n   * Current viewer settings.\r\n   */\r\n  settings: ViewerSettings\r\n\r\n  /**\r\n   * Interface to manage objects to be rendered.\r\n   */\r\n  renderer: Renderer\r\n\r\n  /**\r\n   * Interface to manage html canvas.\r\n   */\r\n  viewport: Viewport\r\n\r\n  /**\r\n   * Interface to manage viewer selection.\r\n   */\r\n  selection: Selection\r\n\r\n  /**\r\n   * Interface to manipulate default viewer inputs.\r\n   */\r\n  inputs: Input\r\n\r\n  /**\r\n   * Interface to raycast into the scene to find objects.\r\n   */\r\n  raycaster: Raycaster\r\n\r\n  private _environment: Environment\r\n  private _camera: Camera\r\n  private _loader: Loader\r\n  private _clock = new THREE.Clock()\r\n\r\n  // State\r\n  private _vims: (Vim | undefined)[] = []\r\n  private _disposed: boolean = false\r\n\r\n  /**\r\n   * Interface to manipulate the viewer camera.\r\n   */\r\n  get camera () {\r\n    return this._camera as ICamera\r\n  }\r\n\r\n  /**\r\n   * Interface to manipulate THREE elements not directly related to vim.\r\n   */\r\n  get environment () {\r\n    return this._environment as IEnvironment\r\n  }\r\n\r\n  /**\r\n   * Callback for on mouse click. Replace it to override or combine\r\n   * default behaviour with your custom logic.\r\n   */\r\n  private _onMouseClick: (hit: RaycastResult) => void\r\n  get onMouseClick () {\r\n    return this._onMouseClick\r\n  }\r\n\r\n  set onMouseClick (callback: (hit: RaycastResult) => void) {\r\n    this._onMouseClick = callback ?? function (hit: RaycastResult) {}\r\n  }\r\n\r\n  constructor (options?: Partial<ViewerOptions.Root>) {\r\n    this._loader = new Loader()\r\n    this.settings = new ViewerSettings(options)\r\n\r\n    const scene = new RenderScene()\r\n    this.viewport = new Viewport(this.settings)\r\n    this._camera = new Camera(scene, this.viewport, this.settings)\r\n    this.renderer = new Renderer(scene, this.viewport)\r\n    this._camera.gizmo = new CameraGizmo(\r\n      this.renderer,\r\n      this._camera,\r\n      this.settings\r\n    )\r\n\r\n    this._environment = new Environment(this.settings)\r\n    this._environment.getObjects().forEach((o) => this.renderer.add(o))\r\n\r\n    // Default mouse click behaviour, can be overriden\r\n    this._onMouseClick = this.defaultOnClick\r\n\r\n    // Input and Selection\r\n    this.selection = new Selection(this.renderer)\r\n    this.raycaster = new Raycaster(this.viewport, this._camera, scene)\r\n    this.inputs = new Input(this)\r\n    this.inputs.register()\r\n\r\n    this.applyMaterialSettings(this.settings)\r\n\r\n    // Start Loop\r\n    this.animate()\r\n  }\r\n\r\n  dispose () {\r\n    this._environment.dispose()\r\n    this.selection.clear()\r\n    this._camera.dispose()\r\n    this.viewport.dispose()\r\n    this.renderer.dispose()\r\n    this.inputs.unregister()\r\n    this._vims.forEach((v) => v?.dispose())\r\n    this._vims = []\r\n    this._disposed = true\r\n  }\r\n\r\n  // Calls render, and asks the framework to prepare the next frame\r\n  private animate () {\r\n    // if viewer was disposed no more animation.\r\n    if (this._disposed) return\r\n\r\n    requestAnimationFrame(() => this.animate())\r\n\r\n    // Camera\r\n    this._camera.update(this._clock.getDelta())\r\n    // Rendering\r\n    if (this._vims.length) this.renderer.render(this.camera.camera)\r\n  }\r\n\r\n  /**\r\n   * Returns an array with all loaded vims.\r\n   */\r\n  get vims () {\r\n    return this._vims.filter((v) => v !== undefined)\r\n  }\r\n\r\n  /**\r\n   * Current loaded vim count\r\n   */\r\n  get vimCount () {\r\n    return this._vims.length\r\n  }\r\n\r\n  /**\r\n   * Adds given vim to the first empty spot of the vims array\r\n   */\r\n  private addVim (vim: Vim) {\r\n    for (let i = 0; i <= this._vims.length; i++) {\r\n      if (this._vims[i] === undefined) {\r\n        this._vims[i] = vim\r\n        vim.index = i\r\n        return\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove given vim from the vims array and leaves an undefined spot.\r\n   */\r\n  private removeVim (vim: Vim) {\r\n    this._vims[vim.index] = undefined\r\n    vim.index = -1\r\n  }\r\n\r\n  /**\r\n   * Loads a vim into the viewer from local or remote location\r\n   * @param source if string downloads the vim from url then loads it, if ArrayBuffer directly loads the vim\r\n   * @param options vim options\r\n   */\r\n  loadVim (\r\n    buffer: ArrayBuffer,\r\n    options: VimOptions.Root,\r\n    onProgress?: (logger) => void\r\n  ) {\r\n    const bfast = BFast.parseFromBuffer(buffer);\r\n    const vim = this._loader.load(bfast, 'all');\r\n    this.onVimLoaded(vim, new VimSettings(options))\r\n    this.camera.frame('all', true)\r\n    return vim\r\n  }\r\n\r\n  private onVimLoaded (vim: Vim, settings: VimSettings) {\r\n    this.addVim(vim)\r\n    vim.applySettings(settings)\r\n\r\n    this.renderer.add(vim.scene)\r\n    this._environment.adaptToContent(this.renderer.getBoundingBox())\r\n    this._camera.adaptToContent()\r\n  }\r\n\r\n  /**\r\n   * Unload given vim from viewer.\r\n   */\r\n  unloadVim (vim: Vim) {\r\n    this.removeVim(vim)\r\n    this.renderer.remove(vim.scene)\r\n    vim.dispose()\r\n    if (this.selection.object?.vim === vim) this.selection.clear()\r\n  }\r\n\r\n  /**\r\n   * Unloads all vim from viewer.\r\n   */\r\n  clear () {\r\n    this._vims.forEach((v) => this.unloadVim(v))\r\n  }\r\n\r\n  /**\r\n   * Reloads the vim with only objects included in the array.\r\n   * @param objects array of objects to keep or undefined to load all objects.\r\n   */\r\n  filterVim (vim: Vim, objects: Object[] | undefined) {\r\n    const instances = objects\r\n      ?.flatMap((o) => o?.instances)\r\n      .filter((i): i is number => i !== undefined)\r\n\r\n    this.renderer.remove(vim.scene)\r\n    vim.filter(instances)\r\n    this.renderer.add(vim.scene)\r\n  }\r\n\r\n  applyMaterialSettings (settings: ViewerSettings) {\r\n    const lib = Materials.getDefaultLibrary()\r\n    lib.wireframe.color = settings.getHighlightColor()\r\n    lib.wireframe.opacity = settings.getHighlightOpacity()\r\n  }\r\n\r\n  private defaultOnClick (hit: RaycastResult) {\r\n    console.log(hit)\r\n    if (!hit?.object) return\r\n    this.selection.select(hit.object)\r\n\r\n    this._camera.target(hit.object.getCenter())\r\n\r\n    if (hit.doubleClick) this._camera.frame(hit.object)\r\n\r\n    const element = hit.object.getBimElement()\r\n    console.log(element)\r\n  }\r\n}\r\n"],"names":["toVec","deepmerge","THREE","Object","MathUtils","Transparency","Geometry","Materials","Mesh","freeGlobal","Symbol","root","objectProto","hasOwnProperty","nativeObjectToString","symToStringTag","funcTag","genTag","coreJsData","funcProto","funcToString","MAX_SAFE_INTEGER","defineProperty","argsTag","propertyIsEnumerable","freeExports","freeModule","moduleExports","Buffer","arrayTag","boolTag","dateTag","errorTag","mapTag","numberTag","objectTag","regexpTag","setTag","stringTag","weakMapTag","arrayBufferTag","dataViewTag","float32Tag","float64Tag","int8Tag","int16Tag","int32Tag","uint8Tag","uint8ClampedTag","uint16Tag","uint32Tag","nodeUtil","isArray","isArguments","isBuffer","isTypedArray","nativeKeys","nativeCreate","HASH_UNDEFINED","Map","nativeGetSymbols","getSymbols","getPrototype","getSymbolsIn","Promise","Set","DataView","WeakMap","Uint8Array","symbolTag","baseCreate","getTag","CLONE_DEEP_FLAG","CLONE_SYMBOLS_FLAG","isSet","isMap","Float32BufferAttribute","InstancedBufferAttribute","InstancedMesh","BufferAttribute"],"mappings":"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"}